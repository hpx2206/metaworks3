<%
if(value){
	
	var instanceTitle = value.name;
	var lastCmnt = value.lastCmnt;
	var lastCmnt2 = value.lastCmnt2;
	var topicName = value.topicName;
	 
	var session = mw3.getAutowiredObject("org.uengine.codi.mw3.model.Session");
	if(session && session.searchKeyword != null && session.searchKeyword.length > 0){
		if(typeof instanceTitle == 'string')
			instanceTitle = instanceTitle.replaceAll(session.searchKeyword, '<b style=\"background:yellow\">' + session.searchKeyword + '</b>');
		 
		if(typeof lastCmnt == 'string')
			lastCmnt = lastCmnt.replaceAll(session.searchKeyword, '<b style=\"background:yellow\">' + session.searchKeyword + '</b>');
			
		if(typeof lastCmnt2 == 'string')
			lastCmnt2 = lastCmnt2.replaceAll(session.searchKeyword, '<b style=\"background:yellow\">' + session.searchKeyword + '</b>');
	}
	 
	if(mw3.how=="instanceNavigator"){
%>
	
<div id="method_<%=objectId%>_flowchart" style="cursor:pointer; margin-bottom:3px;" onclick="<%=methods.flowchart.caller()%>"><img src="images/waveStyle/i_workitem_i.png" border=0  style="position:relative; top:4px;"><%=value.defName%></div>
		
<%
	}else if(mw3.how=="instanceNavigatorWeb"){
%>
	
<div id="method_<%=objectId%>_flowchart" style="cursor:pointer; margin-bottom:3px;" onclick="<%=methods.webflowchart.caller()%>"><img src="images/waveStyle/i_workitem_i.png" border=0  style="position:relative; top:4px;"><%=value.defName%></div>	
	
<%
	
	}else{
			
		var isChat = (value.defId == null && value.secuopt == '1');
		var isOpenCollab = (value.defId == null && value.secuopt=='0');
		var isProcess = (value.defId != null);
		var isSecureProcess = (value.defId != null && value.secuopt == '1');
		/*value.initiator.metaworksContext.how='list';*/
	
	%>
	
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="instanceList tbl_type" <%=(value.status=='Completed') ? "style='background:#eeeeee;position:relative;'":""%> style="position:relative;">						
	<tbody>
	<tr class="q <%=value.firstDueTimeTerm ? (value.firstDueTimeTerm>=0 ? (value.firstDueTimeTerm>=3 ? "" : "plus" + value.firstDueTimeTerm ) : "minus" )  : "" %>" style="cursor:pointer;">
		<td id="newInst"><div class="innerNewInst"></div></td>
		<td class="first_td" valign="top">
			<div class="worklistuser">
					<dl>					                		
						<dd><%=fields.initiator.here() %></dd>
						<div class="clear"></div>					                	
					</dl>	
			</div>				
		</td> 
		<td id="td_<%=objectId%>">
										<% if(mw3.how == 'sns'){ %>
												<div class="instanceBtn instanceBtn_sns">
													<span style="float:left"><%=fields.instanceTooltip.here()%></span>
													<span style="float:left"><%=fields.instanceDrag.here()%></span>
													<div class="clear"></div>
												</div>
											<%}%>									
			<ul class="lst_type">										
				<li class="trigger">					
					<div class="instanceTitle">
						<table width="100%" cellspacing="0" cellpadding="0">
							<tr>
								<td  style="border:none;"><a href="#"><b><font color=204070><%=value.initiator.name%></font>&nbsp;&nbsp;
								
									<font color=#5C5C5C><%=instanceTitle%></font></b></a>
									<div>
										<div  class="instanceType">
											<% if(isChat){ %>
												<!--span class="type_ping"></span--><span class="instanceLock"></span>
											<% }else if(isOpenCollab){ %>
												<!--span class="type_ping"></span--><span class="instanceUnLock"></span>
											<% }else if(isProcess){ %>
												<span class="type_process"></span><span class="instanceUnLock"></span>
											<% }else if(isSecureProcess){ %>
												<span class="type_process"></span><span class="instanceLock"></span>
											<% } %>
											<% if(topicName != null){ %>
												<span class="type_topic"></span>
												<span class="instanceBtn"><%=topicName%></span>
											<% }%>
										</div>										
										<div style="float:left; font-size:11px;  margin:3px 8px 3px 0;"><%=fields.startedDate.here({when: 'timeago'})%></div>
										
										<%if(value.dueDate){ 
											if(value.status=='Completed'){
											%>
										<!--float:right; margin-bottom:4px-->
										<div class="badge" style="float:right;margin-top:2px;background:#98AFC7;">&nbsp;&nbsp;<%=mw3.localize('$Complete')%> &nbsp;&nbsp;</div> 
											<%
											}else if(value.dueDate < new Date()){
											%>
										<div class="badge" style="float:right;margin-top:2px;background:#F52020;">&nbsp;&nbsp;<%=mw3.localize('$Delay')%> &nbsp;&nbsp;</div>
											<%
											}else{
											%>
										<div style="float:left; font-size:11px;margin:3px 8px 3px 0;">
											<span style="float:left;"><b>·</b> <%=mw3.localize('$Due')%> :&nbsp;</span>
											<span style="float:left;"><%=fields.dueDate.here({when: 'timeago'})%></span>
											<div style="clear:both"></div>
										</div>											
											<%
											}
										}%>
										<%
										if(value.bVBenefit != null && value.bVPenalty != null && value.effort != null){
											var bv = value.bVBenefit + value.bVPenalty;
											if(value.effort != 0) {
												var roi = Math.round(bv/value.effort);
										%>
										<div style="float:left; font-size:11px;margin:3px 8px 3px 0;">
											<span style="float:left;"><b>·</b> Biz Val :&nbsp;</span>
											<%if(bv > 0) {%>
											<span style="float:left;"><%=bv%></span>
											<%}else{%>
											<span style="float:left;">-</span>
											<%}%>
										</div>
										<div style="float:left; font-size:11px;margin:3px 8px 3px 0;">
											<span style="float:left;"><b>·</b> ROI :&nbsp;</span>
											<%if(roi > 0) {%>
											<span style="float:left;"><%=roi%></span>
											<%}else{%>
											<span style="float:left;">-</span>
											<%}%>
											<div style="clear:both"></div>
										</div>
										<%
											}
										}
										%>
										<div style="clear:both"></div>
									</div>													
								</td>
								

							</tr>
						</table>
					<div>				
				</li>
				
			    <% 
			    
			    if(value.instanceViewThreadPanel && value.instanceViewThreadPanel.instanceId) {%>			     
			    <% }else if(value.lastCmnt != null){%>
			    <% if(value.currentUser && value.currentUser.userId){%>
			    <!-- && (value.initiator.userId!=value.currentUser.userId || value.name!=value.lastCmnt)-->
			    
			    <li>
			    	<!--style="margin-left:38px;"-->
			   		<table><td><%value.lastCmntUser['size']='small';%><%=fields.lastCmntUser.here()%></td>
			  		<td colspan=2 style="border:none; padding-right:10px;"><font color=204070><%=value.lastCmntUser.name%></font>&nbsp;&nbsp; <font color="gray" class="inctanceReply"><%=lastCmnt%></font></td></table>
			 	</li>
			   		<%if(value.lastCmnt2 && value.lastCmnt2 != null){%>
					    <li>
					    	<!--style="margin-left:38px;"-->
					   		<table><td><%value.lastCmnt2User['size']='small';%><%=fields.lastCmnt2User.here()%></td>
					  		<td colspan=2 style="border:none; padding-right:10px;"><font color=204070><%=value.lastCmnt2User.name%></font>&nbsp;&nbsp; <font color="gray" class="inctanceReply"><%=lastCmnt2%></font></td></table>
					 	</li>
			   		<%}%>
			    <%}%>
			    <%}%>
												
			</ul>								
		</td>


		
		<td width="20"  class="instanceMove">
			<% if(mw3.how != 'sns'){ %>
				<div class="instanceBtn" style="width: 15px;margin: 0 auto;"><%=fields.instanceDrag.here()%></div>
			<% } %>
		</td>
		
	</tr>
	</tbody>
</table>

<% if(value.instanceViewThreadPanel && value.instanceViewThreadPanel.instanceId) {%>
<div style="background:#F3F3F3; margin-left:65px;  margin-right:20px;position:relative">
	<!--div style="position:absolute; top:-10px; left:49%;"><img src="images/waveStyle/topShadowArrow.png"></div-->
	<%=fields.instanceViewThreadPanel.here()%>
</div>
<%}%>

	<%}%>
<%}%>

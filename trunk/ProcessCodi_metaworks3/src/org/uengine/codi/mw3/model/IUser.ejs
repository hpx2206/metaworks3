<%	
	if(value && value.userId){
		var clickAction = '';
		
		if(mw3.when == 'addContact'){
			clickAction = methods.addContact.caller();
		}else if(mw3.when == 'addTopicFollower'){
			clickAction = methods.addFollower.caller();
		}else if(mw3.when == 'addInstanceFollower'){
			clickAction = methods.addFollower.caller();
		}else if(mw3.when == 'addEtcFollower'){
			clickAction = methods.addFollower.caller();
		}else if(mw3.when == 'self' || mw3.when == 'self_small'){
			clickAction = methods.info.caller();
		}else{
			clickAction = methods.detail.caller();
		}
					
		var unknown = 'images/portrait/unknown_user.gif';
		var portrait = unknown;
		
		if(value.network == 'local' || value.network == null){
			if(value.userId)
				portrait = 'images/portrait/' + value.userId + '.jpg';			
		}else if(value.network == 'fb'){
			if(value.userId)
				portrait = 'http://graph.facebook.com/' + value.userId + '/picture';			
		}		
		
		if(mw3.how == 'info'){			
%>
		<ul>
			<li>
				<dl class="lst_type2">

					<dd class="photo">
						<div id="popupInfoImgWih"><img id="user_picture_<%=objectId%>" src="<%=portrait%>" onerror="this.src='<%=unknown%>';" width="104" height="104"></div>	
					</dd>
					<dd class="tit">
						<div id="popupInfoNameWih"><b><%=value.name%></b></div>
						<%
							var session = mw3.getAutowiredObject("org.uengine.codi.mw3.model.Session");
							var itIsMe = (session.user.userId == value.userId);
							
							if(itIsMe){
						%>
						<div>
							<%=fields.mood.here({when:'edit'})%>
						</div>
						<div style="margin-top:5px;">
							<a id="wBtn" href="#" onClick="<%=methods.changeMood.caller()%>"><span style="color:#000; margin-right:0px"><%=mw3.localize("$ChangeMood")%></span></a>
						</div>
						
						<%	}else{%>
							<%=value.mood ? value.mood : ''%>
						<%	}%>			
					</dd>
       			</dl>
      		</li>    
     	</ul>

<%
			if(mw3.when != 'chat'){
%>			     	
     	<div id="btnline" style="border-top:1px solid #E3E8F2; padding-top:8px;">
			<ul>
<%
				if(mw3.when == 'contacts'){
%>							
				<li><a id="wBtn" href="#" onClick="<%=methods.removeContact.caller()%>"><span><%=mw3.localize("$RemoveFromContact")%></span></a></li>
<%
				}else if(mw3.when== 'followers'){
%>							
				<li><a id="wBtn" href="#" onClick="<%=methods.removeFollower.caller()%>"><span><%=mw3.localize("$RemoveFromFollowers")%></span></a></li>
<%
				}
				
				if(value.network == 'fb'){
%>
				<li><a id="wBtn" href="http://www.facebook.com/profile.php?id=<%=value.userId%>" target="_blank"><span>goFacebook</span></a></li>
<%				
				}
%>				
				<li><a id="wBtn" href="#" onClick="<%=methods.addContact.caller()%>"><span><%=mw3.localize("$AddFriend")%></span></a></li>						
				<li><a id="wBtn" href="#" onClick="<%=methods.chat.caller()%>"><span><%=mw3.localize("$Chat")%></span></a></li>						
				<li><a id="wBtn" href="#" onClick="<%=methods.showSchedule.caller()%>"><span><%=mw3.localize("$showSchedule")%></span></a></li>
				<li><a id="wBtn" href="#" onClick="<%=methods.showWall.caller()%>"><span><%=mw3.localize("$ShowWall")%></span></a></li>
			</ul>
		</div>
<%
			}
		}else if(mw3.how == 'picker'){
%>
		<div class="user">	
			<div class="user_focus<%=(value.size=='small' ? ' small':'')%>" style="background: url('<%=portrait%>'); background-size:cover;"  title="<%=value.name%>">	
				<img id="user_picture_<%=objectId%>" width=1 height=1 src="<%=portrait%>"  onerror="$(this).parent().css({'background':'url(\'<%=unknown%>\') no-repeat','background-size':'cover'})">
			</div>
				
			<div class="user_compact">
				<%=value.name%>
			</div>
			<div style="clear:both"></div>
		</div>			
<%		
		}else if(mw3.how == 'followerCheck'){
%>
		<div class="user">		
			<input type="checkbox" id="followerCheck_<%=objectId%>" name="followerCheck">
			<div class="user_focus<%=(value.size=='small' ? ' small':'')%>" style="background: url('<%=portrait%>'); background-size:cover;"  title="<%=value.name%>">	
				<img id="user_picture_<%=objectId%>" width=1 height=1 src="<%=portrait%>"  onerror="$(this).parent().css({'background':'url(\'<%=unknown%>\') no-repeat','background-size':'cover'})">
			</div>
			<div class="user_detail">
				<span class="fontbold"><%=value.name%></span>
				<span class="fontgray"><%=value.mood ? value.mood : ''%></span>
			</div>
			<div style="clear:both"></div>
		</div>
<%		
		}else{			
%>
		<div class="user" onclick="<%=clickAction%>">		
			<div class="user_focus<%=(value.size=='small' ? ' small':'')%>" style="background: url('<%=portrait%>'); background-size:cover;"  title="<%=value.name%>">	
				<img id="user_picture_<%=objectId%>" width=1 height=1 src="<%=portrait%>"  onerror="$(this).parent().css({'background':'url(\'<%=unknown%>\') no-repeat','background-size':'cover'})">
			</div>
<%	
			/* case by user */
			if(mw3.when == 'contacts' || mw3.when == 'addContact' || mw3.when == 'addTopicFollower' || mw3.when == 'addInstanceFollower' || mw3.when == 'addEtcFollower'){
%>
			<div class="user_detail">
				<span class="fontbold"><%=value.name%></span>
				<span class="fontgray"><%=value.mood ? value.mood : ''%></span>
				<!--<span class="fontgray"></span>-->
			</div>
<%			
			}else if(mw3.when == 'self'){
%>
			<div class="user_compact">
				<%=value.name%>
				<%=value.mood ? '<br>'+value.mood : ''%>
			</div>
<%			
			}
%>		
			<div style="clear:both"></div>
		</div>
<%		 
		}
	}
%>
<%=methods ? methods.pickUp.here() : ""%>
var OG=window.OG||{};OG.common={};OG.geometry={};OG.graph={};OG.handler={};OG.layout={};OG.renderer={};OG.shape={};OG.shape.bpmn={};OG.common.Constants={CANVAS_BACKGROUND:"#f9f9f9",GEOM_TYPE:{NULL:0,POINT:1,LINE:2,POLYLINE:3,POLYGON:4,RECTANGLE:5,CIRCLE:6,ELLIPSE:7,CURVE:8,BEZIER_CURVE:9,COLLECTION:10},GEOM_NAME:["","Point","Line","PolyLine","Polygon","Rectangle","Circle","Ellipse","Curve","BezierCurve","Collection"],NUM_PRECISION:0,SCALE:1,SCALE_MIN:0.1,SCALE_MAX:10,NODE_TYPE:{ROOT:"ROOT",SHAPE:"SHAPE",ETC:"ETC"},SHAPE_TYPE:{GEOM:"GEOM",TEXT:"TEXT",HTML:"HTML",IMAGE:"IMAGE",EDGE:"EDGE",GROUP:"GROUP"},EDGE_TYPE:{STRAIGHT:"straight",PLAIN:"plain",BEZIER:"bezier"},EDGE_PADDING:20,LABEL_PADDING:5,LABEL_EDITOR_WIDTH:70,LABEL_EDITOR_HEIGHT:16,FROMTO_LABEL_OFFSET_TOP:15,LABEL_SUFFIX:"_LABEL",LABEL_EDITOR_SUFFIX:"_LABEL_EDITOR",FROM_LABEL_SUFFIX:"_FROMLABEL",TO_LABEL_SUFFIX:"_TOLABEL",DEFAULT_STYLE:{SHAPE:{cursor:"default"},GEOM:{stroke:"black",fill:"white","fill-opacity":0,"label-position":"center"},TEXT:{stroke:"none","text-anchor":"middle"},HTML:{"label-position":"bottom","text-anchor":"middle","vertical-align":"top"},IMAGE:{"label-position":"bottom","text-anchor":"middle","vertical-align":"top"},EDGE:{stroke:"black",fill:"none","fill-opacity":0,"stroke-width":1,"stroke-opacity":1,"edge-type":"plain","edge-direction":"c c","arrow-start":"none","arrow-end":"classic-wide-long","stroke-dasharray":"","label-position":"center"},EDGE_SHADOW:{stroke:"#00FF00",fill:"none","fill-opacity":0,"stroke-width":1,"stroke-opacity":1,"arrow-start":"none","arrow-end":"none","stroke-dasharray":"- "},EDGE_HIDDEN:{stroke:"white",fill:"none","fill-opacity":0,"stroke-width":5,"stroke-opacity":0},GROUP:{stroke:"none",fill:"white","fill-opacity":0,"label-position":"bottom","text-anchor":"middle","vertical-align":"top"},GUIDE_BBOX:{stroke:"#00FF00",fill:"none","stroke-dasharray":"- ","shape-rendering":"crispEdges"},GUIDE_UL:{stroke:"black",fill:"#00FF00",cursor:"nwse-resize","shape-rendering":"crispEdges"},GUIDE_UR:{stroke:"black",fill:"#00FF00",cursor:"nesw-resize","shape-rendering":"crispEdges"},GUIDE_LL:{stroke:"black",fill:"#00FF00",cursor:"nesw-resize","shape-rendering":"crispEdges"},GUIDE_LR:{stroke:"black",fill:"#00FF00",cursor:"nwse-resize","shape-rendering":"crispEdges"},GUIDE_LC:{stroke:"black",fill:"#00FF00",cursor:"ew-resize","shape-rendering":"crispEdges"},GUIDE_UC:{stroke:"black",fill:"#00FF00",cursor:"ns-resize","shape-rendering":"crispEdges"},GUIDE_RC:{stroke:"black",fill:"#00FF00",cursor:"ew-resize","shape-rendering":"crispEdges"},GUIDE_LWC:{stroke:"black",fill:"#00FF00",cursor:"ns-resize","shape-rendering":"crispEdges"},GUIDE_FROM:{stroke:"black",fill:"#00FF00",cursor:"move","shape-rendering":"crispEdges"},GUIDE_TO:{stroke:"black",fill:"#00FF00",cursor:"move","shape-rendering":"crispEdges"},GUIDE_CTL_H:{stroke:"black",fill:"#00FF00",cursor:"ew-resize","shape-rendering":"crispEdges"},GUIDE_CTL_V:{stroke:"black",fill:"#00FF00",cursor:"ns-resize","shape-rendering":"crispEdges"},GUIDE_SHADOW:{stroke:"black",fill:"none","stroke-dasharray":"- ","shape-rendering":"crispEdges"},RUBBER_BAND:{stroke:"#0000FF",opacity:0.2,fill:"#0077FF"},TERMINAL:{stroke:"#808080","stroke-width":1,fill:"r(0.5, 0.5)#FFFFFF-#808080","fill-opacity":0.5,cursor:"pointer"},TERMINAL_OVER:{stroke:"#0077FF","stroke-width":4,fill:"r(0.5, 0.5)#FFFFFF-#0077FF","fill-opacity":1,cursor:"pointer"},TERMINAL_BBOX:{stroke:"none",fill:"white","fill-opacity":0},DROP_OVER_BBOX:{stroke:"#0077FF",fill:"none",opacity:0.6,"shape-rendering":"crispEdges"},LABEL:{"font-size":12,"font-color":"black"},LABEL_EDITOR:{position:"absolute",overflow:"visible",resize:"none","text-align":"center",display:"block",padding:0},COLLAPSE:{stroke:"black",fill:"white","fill-opacity":0,cursor:"pointer","shape-rendering":"crispEdges"},COLLAPSE_BBOX:{stroke:"none",fill:"white","fill-opacity":0}},RUBBER_BAND_ID:"OG_R_BAND",GUIDE_SUFFIX:{GUIDE:"_GUIDE",BBOX:"_GUIDE_BBOX",UL:"_GUIDE_UL",UR:"_GUIDE_UR",LL:"_GUIDE_LL",LR:"_GUIDE_LR",LC:"_GUIDE_LC",UC:"_GUIDE_UC",RC:"_GUIDE_RC",LWC:"_GUIDE_LWC",FROM:"_GUIDE_FROM",TO:"_GUIDE_TO",CTL:"_GUIDE_CTL_",CTL_H:"_GUIDE_CTL_H_",CTL_V:"_GUIDE_CTL_V_"},GUIDE_RECT_SIZE:8,GUIDE_MIN_SIZE:18,COLLAPSE_SUFFIX:"_COLLAPSE",COLLAPSE_BBOX_SUFFIX:"_COLLAPSE_BBOX",COLLAPSE_SIZE:10,MOVE_SNAP_SIZE:5,DROP_OVER_BBOX_SUFFIX:"_DROP_OVER",TERMINAL_SUFFIX:{GROUP:"_TERMINAL",BOX:"_TERMINAL_BOX"},TERMINAL_TYPE:{C:"C",E:"E",W:"W",S:"S",N:"N",IN:"IN",OUT:"OUT",INOUT:"INOUT"},TERMINAL_SIZE:3,COPY_PASTE_PADDING:20,FIT_CANVAS_PADDING:20,AUTO_EXTENSIONAL:true,AUTO_EXTENSION_SIZE:100,SELECTABLE:true,DRAG_SELECTABLE:true,MOVABLE:true,MOVABLE_GEOM:true,MOVABLE_TEXT:true,MOVABLE_HTML:true,MOVABLE_IMAGE:true,MOVABLE_EDGE:true,MOVABLE_GROUP:true,RESIZABLE:true,RESIZABLE_GEOM:true,RESIZABLE_TEXT:true,RESIZABLE_HTML:true,RESIZABLE_IMAGE:true,RESIZABLE_EDGE:true,RESIZABLE_GROUP:true,CONNECTABLE:true,SELF_CONNECTABLE:true,CONNECT_CLONEABLE:true,CONNECT_REQUIRED:true,LABEL_EDITABLE:true,LABEL_EDITABLE_GEOM:true,LABEL_EDITABLE_TEXT:true,LABEL_EDITABLE_HTML:true,LABEL_EDITABLE_IMAGE:true,LABEL_EDITABLE_EDGE:true,LABEL_EDITABLE_GROUP:true,GROUP_DROPABLE:true,GROUP_COLLAPSIBLE:true,DRAG_GRIDABLE:true,ENABLE_HOTKEY:true,ENABLE_HOTKEY_DELETE:true,ENABLE_HOTKEY_CTRL_A:true,ENABLE_HOTKEY_CTRL_C:true,ENABLE_HOTKEY_CTRL_V:true,ENABLE_HOTKEY_CTRL_D:true,ENABLE_HOTKEY_CTRL_G:true,ENABLE_HOTKEY_CTRL_U:true,ENABLE_HOTKEY_ARROW:true,ENABLE_HOTKEY_SHIFT_ARROW:true,ENABLE_CONTEXTMENU:true};OG.Constants=OG.common.Constants;if(typeof KeyEvent==="undefined"){var KeyEvent={DOM_VK_CANCEL:3,DOM_VK_HELP:6,DOM_VK_BACK_SPACE:8,DOM_VK_TAB:9,DOM_VK_CLEAR:12,DOM_VK_RETURN:13,DOM_VK_ENTER:14,DOM_VK_SHIFT:16,DOM_VK_CONTROL:17,DOM_VK_ALT:18,DOM_VK_PAUSE:19,DOM_VK_CAPS_LOCK:20,DOM_VK_ESCAPE:27,DOM_VK_SPACE:32,DOM_VK_PAGE_UP:33,DOM_VK_PAGE_DOWN:34,DOM_VK_END:35,DOM_VK_HOME:36,DOM_VK_LEFT:37,DOM_VK_UP:38,DOM_VK_RIGHT:39,DOM_VK_DOWN:40,DOM_VK_PRINTSCREEN:44,DOM_VK_INSERT:45,DOM_VK_DELETE:46,DOM_VK_0:48,DOM_VK_1:49,DOM_VK_2:50,DOM_VK_3:51,DOM_VK_4:52,DOM_VK_5:53,DOM_VK_6:54,DOM_VK_7:55,DOM_VK_8:56,DOM_VK_9:57,DOM_VK_SEMICOLON:59,DOM_VK_EQUALS:61,DOM_VK_A:65,DOM_VK_B:66,DOM_VK_C:67,DOM_VK_D:68,DOM_VK_E:69,DOM_VK_F:70,DOM_VK_G:71,DOM_VK_H:72,DOM_VK_I:73,DOM_VK_J:74,DOM_VK_K:75,DOM_VK_L:76,DOM_VK_M:77,DOM_VK_N:78,DOM_VK_O:79,DOM_VK_P:80,DOM_VK_Q:81,DOM_VK_R:82,DOM_VK_S:83,DOM_VK_T:84,DOM_VK_U:85,DOM_VK_V:86,DOM_VK_W:87,DOM_VK_X:88,DOM_VK_Y:89,DOM_VK_Z:90,DOM_VK_COMMAND:91,DOM_VK_CONTEXT_MENU:93,DOM_VK_NUMPAD0:96,DOM_VK_NUMPAD1:97,DOM_VK_NUMPAD2:98,DOM_VK_NUMPAD3:99,DOM_VK_NUMPAD4:100,DOM_VK_NUMPAD5:101,DOM_VK_NUMPAD6:102,DOM_VK_NUMPAD7:103,DOM_VK_NUMPAD8:104,DOM_VK_NUMPAD9:105,DOM_VK_MULTIPLY:106,DOM_VK_ADD:107,DOM_VK_SEPARATOR:108,DOM_VK_SUBTRACT:109,DOM_VK_DECIMAL:110,DOM_VK_DIVIDE:111,DOM_VK_F1:112,DOM_VK_F2:113,DOM_VK_F3:114,DOM_VK_F4:115,DOM_VK_F5:116,DOM_VK_F6:117,DOM_VK_F7:118,DOM_VK_F8:119,DOM_VK_F9:120,DOM_VK_F10:121,DOM_VK_F11:122,DOM_VK_F12:123,DOM_VK_F13:124,DOM_VK_F14:125,DOM_VK_F15:126,DOM_VK_F16:127,DOM_VK_F17:128,DOM_VK_F18:129,DOM_VK_F19:130,DOM_VK_F20:131,DOM_VK_F21:132,DOM_VK_F22:133,DOM_VK_F23:134,DOM_VK_F24:135,DOM_VK_NUM_LOCK:144,DOM_VK_SCROLL_LOCK:145,DOM_VK_COMMA:188,DOM_VK_PERIOD:190,DOM_VK_SLASH:191,DOM_VK_BACK_QUOTE:192,DOM_VK_OPEN_BRACKET:219,DOM_VK_BACK_SLASH:220,DOM_VK_CLOSE_BRACKET:221,DOM_VK_QUOTE:222,DOM_VK_META:224}};OG.common.Util={isEmpty:function(b,a){return b===null||b===undefined||((OG.Util.isArray(b)&&!b.length))||(!a?b==="":false)},isArray:function(a){return Object.prototype.toString.apply(a)==="[object Array]"},isDate:function(a){return Object.prototype.toString.apply(a)==="[object Date]"},isObject:function(a){return !!a&&Object.prototype.toString.call(a)==="[object Object]"},isPrimitive:function(a){return OG.Util.isString(a)||OG.Util.isNumber(a)||OG.Util.isBoolean(a)},isFunction:function(a){return Object.prototype.toString.apply(a)==="[object Function]"},isNumber:function(a){return typeof a==="number"&&isFinite(a)},isString:function(a){return typeof a==="string"},isBoolean:function(a){return typeof a==="boolean"},isElement:function(a){return !!a&&a.tagName?true:false},isDefined:function(a){return typeof a!=="undefined"},isWebKit:function(){return(/webkit/).test(navigator.userAgent.toLowerCase())},isGecko:function(){return !OG.Util.isWebKit()&&(/gecko/).test(navigator.userAgent.toLowerCase())},isOpera:function(){return(/opera/).test(navigator.userAgent.toLowerCase())},isChrome:function(){return(/\bchrome\b/).test(navigator.userAgent.toLowerCase())},isSafari:function(){return !OG.Util.isChrome()&&(/safari/).test(navigator.userAgent.toLowerCase())},isFirefox:function(){return(/firefox/).test(navigator.userAgent.toLowerCase())},isIE:function(){return !OG.Util.isOpera()&&(/msie/).test(navigator.userAgent.toLowerCase())},isIE6:function(){return OG.Util.isIE()&&(/msie 6/).test(navigator.userAgent.toLowerCase())},isIE7:function(){return OG.Util.isIE()&&((/msie 7/).test(navigator.userAgent.toLowerCase())||document.documentMode===7)},isIE8:function(){return OG.Util.isIE()&&((/msie 8/).test(navigator.userAgent.toLowerCase())||document.documentMode===8)},isIE9:function(){return OG.Util.isIE()&&((/msie 9/).test(navigator.userAgent.toLowerCase())||document.documentMode===9)},isWindows:function(){return(/windows|win32/).test(navigator.userAgent.toLowerCase())},isMac:function(){return(/macintosh|mac os x/).test(navigator.userAgent.toLowerCase())},isLinux:function(){return(/linux/).test(navigator.userAgent.toLowerCase())},clone:function(g){if(g===null||g===undefined){return g}if(g.nodeType&&g.cloneNode){return g.cloneNode(true)}var e,c,b,h,d,f=Object.prototype.toString.call(g),a=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"];if(f==="[object Date]"){return new Date(g.getTime())}if(f==="[object Array]"){e=g.length;h=[];while(e--){h[e]=this.clone(g[e])}}else{if(f==="[object Object]"&&g.constructor===Object){h={};for(d in g){h[d]=this.clone(g[d])}if(a){for(c=a.length;c--;){b=a[c];h[b]=g[b]}}}}return h||g},round:function(a){return this.roundPrecision(a,OG.Constants.NUM_PRECISION)},roundPrecision:function(c,a){var b=Math.pow(10,a);return Math.round(c*b)/b},roundGrid:function(a,b){b=b||OG.Constants.MOVE_SNAP_SIZE;return OG.Util.round(a/b)*b},apply:function(d,a,c){var b;if(c){this.apply(d,c)}if(d&&a&&typeof a==="object"){for(b in a){d[b]=a[b]}}return d},extend:(function(){var b=function(d){var c;for(c in d){this[c]=d[c]}},a=Object.prototype.constructor;return function(h,e,g){if(OG.Util.isObject(e)){g=e;e=h;h=g.constructor!==a?g.constructor:function(){e.apply(this,arguments)}}var d=function(){},f,c=e.prototype;d.prototype=c;f=h.prototype=new d();f.constructor=h;h.superclass=c;if(c.constructor===a){c.constructor=e}h.override=function(i){OG.Util.override(h,i)};f.superclass=f.supr=(function(){return c}());f.override=b;OG.Util.override(h,g);h.extend=function(i){return OG.Util.extend(h,i)};return h}}()),override:function(a,c){if(c){var b=a.prototype;OG.Util.apply(b,c);if((/msie/).test(navigator.userAgent.toLowerCase())&&c.hasOwnProperty("toString")){b.toString=c.toString}}},xmlToJson:function(c){var b={},a=function(f){var e={};for(var g in f){if(f.hasOwnProperty(g)){e[g]=f[g]}}return e},d=function(g,m,r){if(g.nodeType===3){if(!g.nodeValue.match(/[\S]+/)){return}if(m["$"] instanceof Array){m["$"].push(g.nodeValue)}else{if(m["$"] instanceof Object){m["$"]=[m["$"],g.nodeValue]}else{m["$"]=g.nodeValue}}}else{if(g.nodeType===1){var f={};var s=g.nodeName;for(var n=0;g.attributes&&n<g.attributes.length;n++){var q=g.attributes[n];var e=q.nodeName;var t=q.nodeValue;if(e==="xmlns"){r["$"]=t}else{if(e.indexOf("xmlns:")===0){r[e.substr(e.indexOf(":")+1)]=t}else{f["@"+e]=t}}}for(var o in r){if(r.hasOwnProperty(o)){f["@xmlns"]=f["@xmlns"]||{};f["@xmlns"][o]=r[o]}}if(m[s] instanceof Array){m[s].push(f)}else{if(m[s] instanceof Object){m[s]=[m[s],f]}else{m[s]=f}}for(var l=0;l<g.childNodes.length;l++){d(g.childNodes[l],f,a(r))}}else{if(g.nodeType===9){for(var h=0;h<g.childNodes.length;h++){d(g.childNodes[h],m,a(r))}}}}};d(c,b,{});return b},jsonToXml:function(d){if(typeof d!=="object"){return null}var b=function(f){var e={};for(var g in f){if(f.hasOwnProperty(g)){e[g]=f[g]}}return e};var c=function(n,e,o){var m="";if(e instanceof Array){for(var k=0;k<e.length;k++){m+=c(n,e[k],b(o))}return m}else{if(typeof e==="object"){var f="<"+n;var h="";var q="";if(e["@xmlns"]){var g=e["@xmlns"];for(var l in g){if(g.hasOwnProperty(l)){if(l==="$"){if(o[l]!==g[l]){h+=' xmlns="'+g[l]+'"';o[l]=g[l]}}else{if(!o[l]||(o[l]!==g[l])){h+=" xmlns:"+l+'="'+g[l]+'"';o[l]=g[l]}}}}}for(var p in e){if(e.hasOwnProperty(p)&&p!=="@xmlns"){var j=e[p];if(p==="$"){q+=j}else{if(p.indexOf("@")===0){h+=" "+p.substring(1)+'="'+j+'"'}else{m+=c(p,j,b(o))}}}}m=q+m;return(m!=="")?f+h+">"+m+"</"+n+">":f+h+"/>"}}};for(var a in d){if(d.hasOwnProperty(a)&&a.indexOf("@")==-1){return'<?xml version="1.0" encoding="UTF-8"?>'+c(a,d[a],{})}}return null},parseXML:function(b){var a,c;if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(b)}else{c=new DOMParser();a=c.parseFromString(b,"text/xml")}return a}};OG.Util=OG.common.Util;OG.common.CurveUtil={CatmullRomSpline:function(c){var b=[],e,f={},d={},a=function(g){return function(j,i){var h=c.length,k,l;if(h<2){return NaN}j=j-1;if(!i&&b[g]){i=true}if(!i){f[g]=2*c[0][g]-c[1][g];d[g]=2*c[h-1][g]-c[h-2][g];e=[f].concat(c,[d]);b[g]=[];for(k=0;k<h-1;k++){b[g][k]=[2*e[k+1][g],-e[k][g]+e[k+2][g],2*e[k][g]-5*e[k+1][g]+4*e[k+2][g]-e[k+3][g],-e[k][g]+3*e[k+1][g]-3*e[k+2][g]+e[k+3][g]]}}h+=2;if(isNaN(j)){return NaN}if(j<0){return e[1][g]}else{if(j>=h-3){return e[h-2][g]}}k=Math.floor(j);if(k===j){return e[k][g]}j-=k;l=b[g][k];return 0.5*(((l[3]*j+l[2])*j+l[1])*j+l[0])}};return{getX:a(0),getY:a(1),maxT:c.length+1}},Bezier:function(c){var a,b=function(d){return function(f,e){var i=Math.floor(f)*3,h=f,g=1-h;if(!e&&a){e=true}if(!e){a=Math.floor(c.length/3)}if(f<0){return c[0][d]}if(f>=a){return c[c.length-1][d]}if(isNaN(f)){return NaN}return g*g*(g*c[i][d]+3*h*c[i+1][d])+(3*g*c[i+2][d]+h*c[i+3][d])*h*h}};return{getX:b(0),getY:b(1),maxT:Math.floor(c.length/3)+1}},BSpline:function(d,a){var e,g=[],f=function(m,h){var i,l=[];for(i=0;i<m+h+1;i++){if(i<h){l[i]=0}else{if(i<=m){l[i]=i-h+1}else{l[i]=m-h+2}}}return l},c=function(v,x,h,l,w){var o,m,r,q,u,p=[];if(x[w]<=v&&v<x[w+1]){p[w]=1}else{p[w]=0}for(o=2;o<=l;o++){for(m=w-o+1;m<=w;m++){if(m<=w-o+1||m<0){r=0}else{r=p[m]}if(m>=w){q=0}else{q=p[m+1]}u=x[m+o-1]-x[m];if(u===0){p[m]=0}else{p[m]=(v-x[m])/u*r}u=x[m+o]-x[m+1];if(u!==0){p[m]+=(x[m+o]-v)/u*q}}}return p},b=function(h){return function(p,l){var i=d.length,u,o,q,r=i-1,m=a;if(r<=0){return NaN}if(r+2<=m){m=r+1}if(p<=0){return d[0][h]}if(p>=r-m+2){return d[r][h]}e=f(r,m);q=Math.floor(p)+m-1;g=c(p,e,r,m,q);u=0;for(o=q-m+1;o<=q;o++){if(o<i&&o>=0){u+=d[o][h]*g[o]}}return u}};return{getX:b(0),getY:b(1),maxT:d.length-2}}};OG.CurveUtil=OG.common.CurveUtil;OG.common.NotSupportedException=function(a){this.name="OG.NotSupportedException";this.message=a||"Not Supported!"};OG.NotSupportedException=OG.common.NotSupportedException;OG.common.NotImplementedException=function(a){this.name="OG.NotImplementedException";this.message=a||"Not Implemented!"};OG.NotImplementedException=OG.common.NotImplementedException;OG.common.ParamError=function(a){this.name="OG.ParamError";this.message=a||"Invalid Parameter Error!"};OG.ParamError=OG.common.ParamError;OG.common.HashMap=function(a){this.map=a||{};this.put=function(b,c){this.map[b]=c};this.get=function(b){return this.map[b]};this.containsKey=function(b){return this.map.hasOwnProperty(b)};this.containsValue=function(b){var c;for(c in this.map){if(this.map[c]===b){return true}}return false};this.isEmpty=function(){return this.size()===0};this.clear=function(){var b;for(b in this.map){delete this.map[b]}};this.remove=function(b){if(this.map[b]){delete this.map[b]}};this.keys=function(){var b=[],c;for(c in this.map){b.push(c)}return b};this.values=function(){var b=[],c;for(c in this.map){b.push(this.map[c])}return b};this.size=function(){var b=0,c;for(c in this.map){b++}return b};this.toString=function(){var b=[],c;for(c in this.map){b.push("'"+c+"':'"+this.map[c]+"'")}return"{"+b.join()+"}"}};OG.common.HashMap.prototype=new OG.common.HashMap();OG.common.HashMap.prototype.constructor=OG.common.HashMap;OG.HashMap=OG.common.HashMap;OG.common.JSON=new (function(){var useHasOwn=!!{}.hasOwnProperty,USE_NATIVE_JSON=false,isNative=(function(){var useNative=null;return function(){if(useNative===null){useNative=USE_NATIVE_JSON&&window.JSON&&JSON.toString()==="[object JSON]"}return useNative}}()),m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},pad=function(n){return n<10?"0"+n:n},doDecode=function(json){return eval("("+json+")")},encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+s+'"'},encodeArray=function(o){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i+=1){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(v===null?"null":OG.common.JSON.encode(v));b=true}}a.push("]");return a.join("")},doEncode=function(o){if(!OG.Util.isDefined(o)||o===null){return"null"}else{if(OG.Util.isArray(o)){return encodeArray(o)}else{if(OG.Util.isDate(o)){return OG.common.JSON.encodeDate(o)}else{if(OG.Util.isString(o)){return encodeString(o)}else{if(typeof o==="number"){return isFinite(o)?String(o):"null"}else{if(OG.Util.isBoolean(o)){return String(o)}else{var a=["{"],b,i,v;for(i in o){if(!o.getElementsByTagName){if(!useHasOwn||o.hasOwnProperty(i)){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(doEncode(i),":",v===null?"null":doEncode(v));b=true}}}}a.push("}");return a.join("")}}}}}}};this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'};this.encode=(function(){var ec;return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode}return ec(o)}}());this.decode=(function(){var dc;return function(json){if(!dc){dc=isNative()?JSON.parse:doDecode}return dc(json)}}())})();OG.JSON=OG.common.JSON;OG.geometry.Style=function(c){var b={},a={};OG.Util.apply(a,c,b);OG.geometry.Style.superclass.call(this,a)};OG.geometry.Style.prototype=new OG.common.HashMap();OG.geometry.Style.superclass=OG.common.HashMap;OG.geometry.Style.prototype.constructor=OG.geometry.Style;OG.Style=OG.geometry.Style;OG.geometry.Coordinate=function(a,b){this.x=undefined;this.y=undefined;if(arguments.length===1&&a.constructor===Array){this.x=a[0];this.y=a[1]}else{if(arguments.length===2&&typeof a==="number"&&typeof b==="number"){this.x=a;this.y=b}else{if(arguments.length!==0){throw new OG.ParamError()}}}this.distance=function(e){if(e.constructor===Array){e=new OG.geometry.Coordinate(e[0],e[1])}var d=this.x-e.x,c=this.y-e.y;return OG.Util.round(Math.sqrt(Math.pow(d,2)+Math.pow(c,2)))};this.move=function(c,d){this.x+=c;this.y+=d;return this};this.rotate=function(f,d){if(d.constructor===Array){d=new OG.geometry.Coordinate(d[0],d[1])}f*=Math.PI/180;var c=this.distance(d),e=f+Math.atan2(this.y-d.y,this.x-d.x);this.x=OG.Util.round(d.x+(c*Math.cos(e)));this.y=OG.Util.round(d.y+(c*Math.sin(e)));return this};this.isEquals=function(c){if(c.constructor===Array){c=new OG.geometry.Coordinate(c[0],c[1])}if(c&&c instanceof OG.geometry.Coordinate){if(this.x===c.x&&this.y===c.y){return true}}return false};this.toString=function(){var c=[];c.push(this.x);c.push(this.y);return"["+c.join()+"]"}};OG.geometry.Coordinate.prototype=new OG.geometry.Coordinate();OG.geometry.Coordinate.prototype.constructor=OG.geometry.Coordinate;OG.Coordinate=OG.geometry.Coordinate;OG.geometry.Envelope=function(b,c,n){var o,f=c,g=n,m,d,j,a,k,h,l,e,i;if(b){if(b.constructor===Array){o=new OG.geometry.Coordinate(b)}else{o=new OG.geometry.Coordinate(b.x,b.y)}}this.getUpperLeft=function(){return o};this.setUpperLeft=function(p){if(p.constructor===Array){p=new OG.geometry.Coordinate(p[0],p[1])}o=p;i()};this.getUpperRight=function(){if(!m){m=new OG.geometry.Coordinate(o.x+f,o.y)}return m};this.getLowerRight=function(){if(!j){j=new OG.geometry.Coordinate(o.x+f,o.y+g)}return j};this.getLowerLeft=function(){if(!d){d=new OG.geometry.Coordinate(o.x,o.y+g)}return d};this.getLeftCenter=function(){if(!a){a=new OG.geometry.Coordinate(o.x,OG.Util.round(o.y+g/2))}return a};this.getUpperCenter=function(){if(!k){k=new OG.geometry.Coordinate(OG.Util.round(o.x+f/2),o.y)}return k};this.getRightCenter=function(){if(!h){h=new OG.geometry.Coordinate(o.x+f,OG.Util.round(o.y+g/2))}return h};this.getLowerCenter=function(){if(!l){l=new OG.geometry.Coordinate(OG.Util.round(o.x+f/2),o.y+g)}return l};this.getCentroid=function(){if(!e){e=new OG.geometry.Coordinate(OG.Util.round(o.x+f/2),OG.Util.round(o.y+g/2))}return e};this.setCentroid=function(p){if(p.constructor===Array){p=new OG.geometry.Coordinate(p[0],p[1])}this.move(p.x-this.getCentroid().x,p.y-this.getCentroid().y)};this.getWidth=function(){return f};this.setWidth=function(p){f=p;i()};this.getHeight=function(){return g};this.setHeight=function(p){g=p;i()};this.getVertices=function(){var p=[];p.push(this.getUpperLeft());p.push(this.getUpperCenter());p.push(this.getUpperRight());p.push(this.getRightCenter());p.push(this.getLowerRight());p.push(this.getLowerCenter());p.push(this.getLowerLeft());p.push(this.getLeftCenter());p.push(this.getUpperLeft());return p};this.isContains=function(p){if(p.constructor===Array){return p[0]>=o.x&&p[0]<=this.getLowerRight().x&&p[1]>=o.y&&p[1]<=this.getLowerRight().y}else{return p.x>=o.x&&p.x<=this.getLowerRight().x&&p.y>=o.y&&p.y<=this.getLowerRight().y}};this.isContainsAll=function(q){var p;for(p=0;p<q.length;p++){if(!this.isContains(q[p])){return false}}return true};this.move=function(p,q){o.move(p,q);i();return this};this.resize=function(r,p,s,q){r=r||0;p=p||0;s=s||0;q=q||0;if(f+(s+q)<0||g+(r+p)<0){throw new OG.ParamError()}o.move(-1*s,-1*r);f+=(s+q);g+=(r+p);i();return this};this.isEquals=function(p){if(p&&p instanceof OG.geometry.Envelope){if(this.getUpperLeft().isEquals(p.getUpperLeft())&&this.getWidth()===p.getWidth()&&this.getHeight()===p.getHeight()){return true}}return false};this.toString=function(){var p=[];p.push("upperLeft:"+this.getUpperLeft());p.push("width:"+this.getWidth());p.push("height:"+this.getHeight());p.push("upperRight:"+this.getUpperRight());p.push("lowerLeft:"+this.getLowerLeft());p.push("lowerRight:"+this.getLowerRight());p.push("leftCenter:"+this.getLeftCenter());p.push("upperCenter:"+this.getUpperCenter());p.push("rightCenter:"+this.getRightCenter());p.push("lowerCenter:"+this.getLowerCenter());p.push("centroid:"+this.getCentroid());return"{"+p.join()+"}"};i=function(){m=null;d=null;j=null;a=null;k=null;h=null;l=null;e=null}};OG.geometry.Envelope.prototype=new OG.geometry.Envelope();OG.geometry.Envelope.prototype.constructor=OG.geometry.Envelope;OG.Envelope=OG.geometry.Envelope;OG.geometry.Geometry=function(){this.TYPE=OG.Constants.GEOM_TYPE.NULL;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.boundary=null;this.isEquals=function(a){return a&&a.toString()===this.toString()};this.isContains=function(a){throw new OG.NotImplementedException()};this.isWithin=function(a){throw new OG.NotImplementedException()};this.getBoundary=function(){if(this.boundary===null){var f,e,c,a,b,d,j,h=this.getVertices(),g;for(g=0;g<h.length;g++){if(g===0){f=c=h[g].x;e=a=h[g].y}f=h[g].x<f?h[g].x:f;e=h[g].y<e?h[g].y:e;c=h[g].x>c?h[g].x:c;a=h[g].y>a?h[g].y:a}b=new OG.geometry.Coordinate(f,e);d=c-f;j=a-e;this.boundary=new OG.geometry.Envelope(b,d,j)}return this.boundary};this.getCentroid=function(){return this.getBoundary().getCentroid()};this.getVertices=function(){throw new OG.NotImplementedException()};this.minDistance=function(c){var d=Number.MAX_VALUE,e=0,a=this.getVertices(),b;c=this.convertCoordinate(c);if(a.length===1){return c.distance(a[0])}for(b=0;b<a.length-1;b++){e=this.distanceToLine(c,[a[b],a[b+1]]);if(e<d){d=e}}return d};this.distance=function(a){return this.getCentroid().distance(a.getCentroid())};this.getLength=function(){var c=0,a=this.getVertices(),b;for(b=0;b<a.length-1;b++){c+=a[b].distance(a[b+1])}return c};this.move=function(a,b){throw new OG.NotImplementedException()};this.moveCentroid=function(b){var a=this.getCentroid();b=new OG.geometry.Coordinate(b);this.move(b.x-a.x,b.y-a.y)};this.resize=function(c,a,d,b){throw new OG.NotImplementedException()};this.resizeBox=function(d,a){var e=this.getBoundary(),c=OG.Util.round((d-e.getWidth())/2),b=OG.Util.round((a-e.getHeight())/2);this.resize(b,b,c,c);return this};this.rotate=function(b,a){throw new OG.NotImplementedException()};this.fitToBoundary=function(e){var f=this.getBoundary(),c=f.getUpperCenter().y-e.getUpperCenter().y,a=e.getLowerCenter().y-f.getLowerCenter().y,d=f.getLeftCenter().x-e.getLeftCenter().x,b=e.getRightCenter().x-f.getRightCenter().x;this.resize(c,a,d,b);return this};this.convertCoordinate=function(a){if(a){if(a.constructor===Array){return new OG.geometry.Coordinate(a)}else{if(a instanceof OG.geometry.Coordinate){return new OG.geometry.Coordinate(a.x,a.y)}else{throw new OG.ParamError()}}}else{return undefined}};this.distanceToLine=function(e,b){var a=this.convertCoordinate(b[0]),f=this.convertCoordinate(b[1]),d,c;e=this.convertCoordinate(e);if(a.isEquals(f)){return e.distance(a)}d=((e.x-a.x)*(f.x-a.x)+(e.y-a.y)*(f.y-a.y))/((f.x-a.x)*(f.x-a.x)+(f.y-a.y)*(f.y-a.y));if(d<=0){return e.distance(a)}if(d>=1){return e.distance(f)}c=((a.y-e.y)*(f.x-a.x)-(a.x-e.x)*(f.y-a.y))/((f.x-a.x)*(f.x-a.x)+(f.y-a.y)*(f.y-a.y));return OG.Util.round(Math.abs(c)*Math.sqrt(((f.x-a.x)*(f.x-a.x)+(f.y-a.y)*(f.y-a.y))))};this.distanceLineToLine=function(i,g){var f=this.convertCoordinate(i[0]),e=this.convertCoordinate(i[1]),d=this.convertCoordinate(g[0]),b=this.convertCoordinate(g[1]),c,k,j,h,l,a;if(f.isEquals(e)){return this.distanceToLine(f,[d,b])}if(d.isEquals(b)){return this.distanceToLine(b,[f,e])}c=(f.y-d.y)*(b.x-d.x)-(f.x-d.x)*(b.y-d.y);k=(e.x-f.x)*(b.y-d.y)-(e.y-f.y)*(b.x-d.x);j=(f.y-d.y)*(e.x-f.x)-(f.x-d.x)*(e.y-f.y);h=(e.x-f.x)*(b.y-d.y)-(e.y-f.y)*(b.x-d.x);if((k===0)||(h===0)){return Math.min(this.distanceToLine(f,[d,b]),Math.min(this.distanceToLine(e,[d,b]),Math.min(this.distanceToLine(d,[f,e]),this.distanceToLine(b,[f,e]))))}l=j/h;a=c/k;if((a<0)||(a>1)||(l<0)||(l>1)){return Math.min(this.distanceToLine(f,[d,b]),Math.min(this.distanceToLine(e,[d,b]),Math.min(this.distanceToLine(d,[f,e]),this.distanceToLine(b,[f,e]))))}return 0};this.intersectToLine=function(c){var d=this.getVertices(),b=[],a,f,e=function(h,i){var g;for(g=0;g<h.length;g++){if(h[g].isEquals(i)){return true}}return false};for(f=0;f<d.length-1;f++){a=this.intersectLineToLine(c,[d[f],d[f+1]]);if(a&&!e(b,a)){b.push(a)}}return b};this.intersectLineToLine=function(j,h){var f=this.convertCoordinate(j[0]),e=this.convertCoordinate(j[1]),d=this.convertCoordinate(h[0]),c=this.convertCoordinate(h[1]),n,g,b,l,k,i,a,m;if(f.isEquals(e)){return this.distanceToLine(f,[d,c])===0?f:undefined}if(d.isEquals(c)){return this.distanceToLine(d,[f,e])===0?d:undefined}b=(f.y-d.y)*(c.x-d.x)-(f.x-d.x)*(c.y-d.y);l=(e.x-f.x)*(c.y-d.y)-(e.y-f.y)*(c.x-d.x);k=(f.y-d.y)*(e.x-f.x)-(f.x-d.x)*(e.y-f.y);i=(e.x-f.x)*(c.y-d.y)-(e.y-f.y)*(c.x-d.x);if(l!==0&&i!==0){a=b/l;m=k/i;if(0<=a&&a<=1&&0<=m&&m<=1){g="Intersection";n=new OG.Coordinate(OG.Util.round(f.x+a*(e.x-f.x)),OG.Util.round(f.y+a*(e.y-f.y)))}else{g="No Intersection"}}else{if(b===0||k===0){g="Coincident"}else{g="Parallel"}}return n};this.intersectCircleToLine=function(c,j,o,p){var q=[],n=(p.x-o.x)*(p.x-o.x)+(p.y-o.y)*(p.y-o.y),m=2*((p.x-o.x)*(o.x-c.x)+(p.y-o.y)*(o.y-c.y)),i=c.x*c.x+c.y*c.y+o.x*o.x+o.y*o.y-2*(c.x*o.x+c.y*o.y)-j*j,d=m*m-4*n*i,l,h=function(e,b,a){return new OG.Coordinate(OG.Util.round(e.x+(b.x-e.x)*a),OG.Util.round(e.y+(b.y-e.y)*a))},k,g,f;if(d<0){l="Outside"}else{if(d===0){l="Tangent"}else{k=Math.sqrt(d);g=(-m+k)/(2*n);f=(-m-k)/(2*n);if((g<0||g>1)&&(f<0||f>1)){if((g<0&&f<0)||(g>1&&f>1)){l="Outside"}else{l="Inside"}}else{l="Intersection";if(0<=g&&g<=1){q.push(h(o,p,g))}if(0<=f&&f<=1){q.push(h(o,p,f))}}}}return q};this.reset=function(){this.boundary=null}};OG.geometry.Geometry.prototype=new OG.geometry.Geometry();OG.geometry.Geometry.prototype.constructor=OG.geometry.Geometry;OG.geometry.GeometryCollection=function(c){var b,a;this.TYPE=OG.Constants.GEOM_TYPE.COLLECTION;this.geometries=c;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.getVertices=function(){var d=[],e;for(b=0;b<this.geometries.length;b++){e=this.geometries[b].getVertices();for(a=0;a<e.length;a++){d.push(e[a])}}return d};this.move=function(d,f){var e;this.getBoundary().move(d,f);for(e=0;e<this.geometries.length;e++){this.geometries[e].move(d,f);this.geometries[e].reset()}return this};this.resize=function(n,i,g,o){var f=this.getBoundary(),j=g+o,h=n+i,e=f.getWidth()+j,p=f.getHeight()+h,m=f.getWidth()===0?1:e/f.getWidth(),l=f.getHeight()===0?1:p/f.getHeight(),d=f.getUpperLeft(),k;if(e<0||p<0){throw new OG.ParamError()}for(b=0;b<this.geometries.length;b++){k=this.geometries[b].vertices;for(a=0;a<k.length;a++){k[a].x=OG.Util.round((d.x-g)+(k[a].x-d.x)*m);k[a].y=OG.Util.round((d.y-n)+(k[a].y-d.y)*l)}this.geometries[b].reset()}f.resize(n,i,g,o);return this};this.resizeBox=function(g,d){var h=this.getBoundary(),f=OG.Util.round((g-h.getWidth())/2),e=OG.Util.round((d-h.getHeight())/2);this.resize(e,e,f,f);return this};this.rotate=function(e,d){d=d||this.getCentroid();for(b=0;b<this.geometries.length;b++){this.geometries[b].rotate(e,d);this.geometries[b].reset()}this.reset();return this};this.fitToBoundary=function(h){var i=this.getBoundary(),f=i.getUpperCenter().y-h.getUpperCenter().y,d=h.getLowerCenter().y-i.getLowerCenter().y,g=i.getLeftCenter().x-h.getLeftCenter().x,e=h.getRightCenter().x-i.getRightCenter().x;this.resize(f,d,g,e);return this};this.toString=function(){var d=[];for(b=0;b<this.geometries.length;b++){d.push(this.geometries[b].toString())}return"{type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"',geometries:["+d.join()+"]}"}};OG.geometry.GeometryCollection.prototype=new OG.geometry.Geometry();OG.geometry.GeometryCollection.prototype.constructor=OG.geometry.GeometryCollection;OG.GeometryCollection=OG.geometry.GeometryCollection;OG.geometry.PolyLine=function(a){var b;this.TYPE=OG.Constants.GEOM_TYPE.POLYLINE;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.vertices=[];if(a&&a.length>0){for(b=0;b<a.length;b++){this.vertices.push(this.convertCoordinate(a[b]))}}this.getVertices=function(){return this.vertices};this.move=function(c,d){this.getBoundary().move(c,d);for(b=0;b<this.vertices.length;b++){this.vertices[b].move(c,d)}return this};this.resize=function(l,h,f,m){var e=this.getBoundary(),i=f+m,g=l+h,d=e.getWidth()+i,n=e.getHeight()+g,k=e.getWidth()===0?1:d/e.getWidth(),j=e.getHeight()===0?1:n/e.getHeight(),c=e.getUpperLeft();if(d<0||n<0){throw new OG.ParamError()}for(b=0;b<this.vertices.length;b++){this.vertices[b].x=OG.Util.round((c.x-f)+(this.vertices[b].x-c.x)*k);this.vertices[b].y=OG.Util.round((c.y-l)+(this.vertices[b].y-c.y)*j)}e.resize(l,h,f,m);return this};this.rotate=function(d,c){c=c||this.getCentroid();for(b=0;b<this.vertices.length;b++){this.vertices[b].rotate(d,c)}this.reset();return this};this.toString=function(){var c=[];c.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");c.push("vertices:["+this.vertices+"]");return"{"+c.join()+"}"}};OG.geometry.PolyLine.prototype=new OG.geometry.Geometry();OG.geometry.PolyLine.prototype.constructor=OG.geometry.PolyLine;OG.PolyLine=OG.geometry.PolyLine;OG.geometry.Curve=function(controlPoints){OG.geometry.Curve.superclass.call(this,controlPoints);var t,cmRomSpline=OG.CurveUtil.CatmullRomSpline(eval("["+this.vertices.toString()+"]"));this.vertices=[];for(t=0;t<=cmRomSpline.maxT;t+=0.1){this.vertices.push(new OG.geometry.Coordinate(OG.Util.round(cmRomSpline.getX(t)),OG.Util.round(cmRomSpline.getY(t))))}this.TYPE=OG.Constants.GEOM_TYPE.CURVE;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.getVertices=function(){var vertices=[],i;for(i=10;i<=this.vertices.length-10;i++){vertices.push(this.vertices[i])}return vertices};this.getControlPoints=function(){var controlPoints=[],i;for(i=10;i<=this.vertices.length-10;i+=10){controlPoints.push(this.vertices[i])}return controlPoints};this.toString=function(){var s=[];s.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");s.push("vertices:["+this.getVertices()+"]");s.push("controlPoints:["+this.getControlPoints()+"]");return"{"+s.join()+"}"}};OG.geometry.Curve.prototype=new OG.geometry.PolyLine();OG.geometry.Curve.superclass=OG.geometry.PolyLine;OG.geometry.Curve.prototype.constructor=OG.geometry.Curve;OG.Curve=OG.geometry.Curve;OG.geometry.Ellipse=function(a,c,b,e){var h=this.convertCoordinate(a),g=e||0,d,f,j=[];if(h){for(f=-45;f<=405;f+=45){d=Math.PI/180*f;j.push((new OG.geometry.Coordinate(OG.Util.round(h.x+c*Math.cos(d)),OG.Util.round(h.y+b*Math.sin(d)))).rotate(g,h))}}OG.geometry.Ellipse.superclass.call(this,j);this.TYPE=OG.Constants.GEOM_TYPE.ELLIPSE;this.IS_CLOSED=true;this.style=new OG.geometry.Style();this.getVertices=function(){var i=[];for(f=20;f<this.vertices.length-20;f++){i.push(this.vertices[f])}return i};this.getControlPoints=function(){var i=[];for(f=10;f<=this.vertices.length-10;f+=10){i.push(this.vertices[f])}return i};this.getLength=function(){var i=this.getControlPoints(),l=a.distance(i[1]),k=a.distance(i[3]);return Math.PI*(5*(l+k)/4-l*k/(l+k))};this.toString=function(){var l=[],k=this.getControlPoints(),i=this.getCentroid(),o=i.distance(k[1]),m=i.distance(k[3]),n=OG.Util.round(Math.atan2(k[1].y-i.y,k[1].x-i.x)*180/Math.PI);l.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");l.push("center:"+i);l.push("radiusX:"+o);l.push("radiusY:"+m);l.push("angle:"+n);return"{"+l.join()+"}"}};OG.geometry.Ellipse.prototype=new OG.geometry.Curve();OG.geometry.Ellipse.superclass=OG.geometry.Curve;OG.geometry.Ellipse.prototype.constructor=OG.geometry.Ellipse;OG.Ellipse=OG.geometry.Ellipse;OG.geometry.Circle=function(b,a){OG.geometry.Circle.superclass.call(this,b,a,a,0);this.TYPE=OG.Constants.GEOM_TYPE.CIRCLE;this.IS_CLOSED=true;this.style=new OG.geometry.Style();this.getLength=function(){var c=this.getControlPoints(),d=b.distance(c[1]);return 2*Math.PI*d};this.toString=function(){var e=[],d=this.getControlPoints(),c=this.getCentroid(),h=c.distance(d[1]),f=c.distance(d[3]),g=OG.Util.round(Math.atan2(d[1].y-c.y,d[1].x-c.x)*180/Math.PI);if(h===f){e.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");e.push("center:"+c);e.push("radius:"+h)}else{e.push("type:'"+OG.Constants.GEOM_NAME[OG.Constants.GEOM_TYPE.ELLIPSE]+"'");e.push("center:"+c);e.push("radiusX:"+h);e.push("radiusY:"+f);e.push("angle:"+g)}return"{"+e.join()+"}"}};OG.geometry.Circle.prototype=new OG.geometry.Ellipse();OG.geometry.Circle.superclass=OG.geometry.Ellipse;OG.geometry.Circle.prototype.constructor=OG.geometry.Circle;OG.Circle=OG.geometry.Circle;OG.geometry.Line=function(d,c){var b=this.convertCoordinate(d),a=this.convertCoordinate(c);OG.geometry.Line.superclass.call(this,[[b.x,b.y],[a.x,a.y]]);this.TYPE=OG.Constants.GEOM_TYPE.LINE;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.toString=function(){var e=[];e.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");e.push("from:"+this.vertices[0]);e.push("to:"+this.vertices[1]);return"{"+e.join()+"}"}};OG.geometry.Line.prototype=new OG.geometry.PolyLine();OG.geometry.Line.superclass=OG.geometry.PolyLine;OG.geometry.Line.prototype.constructor=OG.geometry.Line;OG.Line=OG.geometry.Line;OG.geometry.Point=function(a){this.TYPE=OG.Constants.GEOM_TYPE.POINT;this.IS_CLOSED=false;this.style=new OG.geometry.Style();this.coordinate=this.convertCoordinate(a);this.vertices=[this.coordinate];this.getVertices=function(){return this.vertices};this.move=function(b,c){this.getBoundary().move(b,c);this.coordinate.move(b,c);this.vertices=[this.coordinate];return this};this.moveCentroid=function(b){this.getBoundary().setUpperLeft(b);this.coordinate=new OG.geometry.Coordinate(b);this.vertices=[this.coordinate]};this.resize=function(d,b,e,c){var f=this.getBoundary();f.resize(d,b,e,c);this.coordinate=f.getCentroid();this.vertices=[this.coordinate];this.boundary=new OG.Envelope(this.coordinate,0,0);return this};this.resizeBox=function(c,b){return this};this.rotate=function(c,b){b=b||this.getCentroid();this.coordinate.rotate(c,b);this.vertices=[this.coordinate];this.reset();return this};this.fitToBoundary=function(b){this.coordinate=b.getCentroid();this.vertices=[this.coordinate];this.boundary=new OG.Envelope(this.coordinate,0,0);return this};this.toString=function(){var b=[];b.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");b.push("coordinate:"+this.coordinate);return"{"+b.join()+"}"}};OG.geometry.Point.prototype=new OG.geometry.Geometry();OG.geometry.Point.prototype.constructor=OG.geometry.Point;OG.Point=OG.geometry.Point;OG.geometry.Polygon=function(a){OG.geometry.Polygon.superclass.call(this,a);if(this.vertices.length>0&&!this.vertices[0].isEquals(this.vertices[this.vertices.length-1])){this.vertices.push(new OG.geometry.Coordinate(this.vertices[0].x,this.vertices[0].y))}this.TYPE=OG.Constants.GEOM_TYPE.POLYGON;this.IS_CLOSED=true;this.style=new OG.geometry.Style()};OG.geometry.Polygon.prototype=new OG.geometry.PolyLine();OG.geometry.Polygon.superclass=OG.geometry.PolyLine;OG.geometry.Polygon.prototype.constructor=OG.geometry.Polygon;OG.Polygon=OG.geometry.Polygon;OG.geometry.Rectangle=function(c,d,a){var b=this.convertCoordinate(c),e=this.convertCoordinate([b.x+d,b.y+a]);if(b.x>e.x||b.y>e.y){throw new OG.ParamError()}OG.geometry.Rectangle.superclass.call(this,[[b.x,b.y],[b.x+(e.x-b.x),b.y],[e.x,e.y],[b.x,b.y+(e.y-b.y)],[b.x,b.y]]);this.TYPE=OG.Constants.GEOM_TYPE.RECTANGLE;this.IS_CLOSED=true;this.style=new OG.geometry.Style();this.toString=function(){var f=[],g=OG.Util.round(Math.atan2(this.vertices[1].y-this.vertices[0].y,this.vertices[1].x-this.vertices[0].x)*180/Math.PI);f.push("type:'"+OG.Constants.GEOM_NAME[this.TYPE]+"'");f.push("upperLeft:"+this.vertices[0]);f.push("width:"+(this.vertices[0].distance(this.vertices[1])));f.push("height:"+(this.vertices[0].distance(this.vertices[3])));f.push("angle:"+g);return"{"+f.join()+"}"}};OG.geometry.Rectangle.prototype=new OG.geometry.Polygon();OG.geometry.Rectangle.superclass=OG.geometry.Polygon;OG.geometry.Rectangle.prototype.constructor=OG.geometry.Rectangle;OG.Rectangle=OG.geometry.Rectangle;OG.shape.IShape=function(){this.TYPE=OG.Constants.NODE_TYPE.SHAPE;this.SHAPE_ID="OG.shape.IShape";this.geom=null;this.label=null;this.isCollapsed=false;this.createTerminal=function(){return[]};this.createShape=function(){throw new OG.NotImplementedException("OG.shape.IShape.createShape")};this.clone=function(){throw new OG.NotImplementedException("OG.shape.IShape.clone")}};OG.shape.IShape.prototype=new OG.shape.IShape();OG.shape.IShape.prototype.constructor=OG.shape.IShape;OG.IShape=OG.shape.IShape;OG.shape.Terminal=function(a,c,b){this.position=a;this.direction=c||OG.Constants.TERMINAL_TYPE.E;this.inout=b||OG.Constants.TERMINAL_TYPE.INOUT};OG.shape.Terminal.prototype=new OG.shape.Terminal();OG.shape.Terminal.prototype.constructor=OG.shape.Terminal;OG.Terminal=OG.shape.Terminal;OG.shape.GeomShape=function(){this.TYPE=OG.Constants.SHAPE_TYPE.GEOM;this.SHAPE_ID="OG.shape.GeomShape";this.createTerminal=function(){if(!this.geom){return[]}var a=this.geom.getBoundary();return[new OG.Terminal(a.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(a.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(a.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(a.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(a.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){throw new OG.NotImplementedException("OG.shape.IShape.createShape")};this.clone=function(){throw new OG.NotImplementedException("OG.shape.IShape.clone")}};OG.shape.GeomShape.prototype=new OG.shape.IShape();OG.shape.GeomShape.prototype.constructor=OG.shape.GeomShape;OG.GeomShape=OG.shape.GeomShape;OG.shape.TextShape=function(a){this.TYPE=OG.Constants.SHAPE_TYPE.TEXT;this.SHAPE_ID="OG.shape.TextShape";this.text=a||"Text Here";this.angle=0;this.createShape=function(){return this.text};this.clone=function(){return new OG.shape.TextShape(this.text)}};OG.shape.TextShape.prototype=new OG.shape.IShape();OG.shape.TextShape.prototype.constructor=OG.shape.TextShape;OG.TextShape=OG.shape.TextShape;OG.shape.ImageShape=function(b,a){this.TYPE=OG.Constants.SHAPE_TYPE.IMAGE;this.SHAPE_ID="OG.shape.ImageShape";this.image=b;this.angle=0;this.label=a;this.createTerminal=function(){if(!this.geom){return[]}var c=this.geom.getBoundary();return[new OG.Terminal(c.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){return this.image};this.clone=function(){return new OG.shape.ImageShape(this.image,this.label)}};OG.shape.ImageShape.prototype=new OG.shape.IShape();OG.shape.ImageShape.prototype.constructor=OG.shape.ImageShape;OG.ImageShape=OG.shape.ImageShape;OG.shape.EdgeShape=function(e,d,a,b,c){this.TYPE=OG.Constants.SHAPE_TYPE.EDGE;this.SHAPE_ID="OG.shape.EdgeShape";this.from=e;this.to=d;this.label=a;this.fromLabel=b;this.toLabel=c;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(e,d);return this.geom};this.clone=function(){return new OG.shape.EdgeShape(this.from,this.to,this.label,this.fromLabel,this.toLabel)}};OG.shape.EdgeShape.prototype=new OG.shape.IShape();OG.shape.EdgeShape.prototype.constructor=OG.shape.EdgeShape;OG.EdgeShape=OG.shape.EdgeShape;OG.shape.CircleShape=function(a){this.SHAPE_ID="OG.shape.CircleShape";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Circle([50,50],50);return this.geom};this.clone=function(){return new OG.shape.CircleShape(this.label)}};OG.shape.CircleShape.prototype=new OG.shape.GeomShape();OG.shape.CircleShape.prototype.constructor=OG.shape.CircleShape;OG.CircleShape=OG.shape.CircleShape;OG.shape.EllipseShape=function(a){this.SHAPE_ID="OG.shape.EllipseShape";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Ellipse([50,50],50,30);return this.geom};this.clone=function(){return new OG.shape.EllipseShape(this.label)}};OG.shape.EllipseShape.prototype=new OG.shape.GeomShape();OG.shape.EllipseShape.prototype.constructor=OG.shape.EllipseShape;OG.EllipseShape=OG.shape.EllipseShape;OG.shape.GroupShape=function(a){this.TYPE=OG.Constants.SHAPE_TYPE.GROUP;this.SHAPE_ID="OG.shape.GroupShape";this.label=a;this.createTerminal=function(){if(!this.geom){return[]}var b=this.geom.getBoundary();return[new OG.Terminal(b.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({stroke:"none"});return this.geom};this.clone=function(){return new OG.shape.GroupShape(this.label)}};OG.shape.GroupShape.prototype=new OG.shape.IShape();OG.shape.GroupShape.prototype.constructor=OG.shape.GroupShape;OG.GroupShape=OG.shape.GroupShape;OG.shape.HorizontalLaneShape=function(a){this.TYPE=OG.Constants.SHAPE_TYPE.GROUP;this.SHAPE_ID="OG.shape.HorizontalLaneShape";this.label=a;this.createTerminal=function(){if(!this.geom){return[]}var b=this.geom.getBoundary();return[new OG.Terminal(b.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({"label-direction":"vertical","vertical-align":"top"});return this.geom};this.clone=function(){return new OG.shape.HorizontalLaneShape(this.label)}};OG.shape.HorizontalLaneShape.prototype=new OG.shape.GroupShape();OG.shape.HorizontalLaneShape.prototype.constructor=OG.shape.HorizontalLaneShape;OG.HorizontalLaneShape=OG.shape.HorizontalLaneShape;OG.shape.HtmlShape=function(b,a){this.TYPE=OG.Constants.SHAPE_TYPE.HTML;this.SHAPE_ID="OG.shape.HtmlShape";this.html=b||"";this.label=a;this.angle=0;this.createTerminal=function(){if(!this.geom){return[]}var c=this.geom.getBoundary();return[new OG.Terminal(c.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(c.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){return this.html};this.clone=function(){return new OG.shape.HtmlShape(this.html,this.label)}};OG.shape.HtmlShape.prototype=new OG.shape.IShape();OG.shape.HtmlShape.prototype.constructor=OG.shape.HtmlShape;OG.HtmlShape=OG.shape.HtmlShape;OG.shape.RectangleShape=function(a){this.SHAPE_ID="OG.shape.RectangleShape";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);return this.geom};this.clone=function(){return new OG.shape.RectangleShape(this.label)}};OG.shape.RectangleShape.prototype=new OG.shape.GeomShape();OG.shape.RectangleShape.prototype.constructor=OG.shape.RectangleShape;OG.RectangleShape=OG.shape.RectangleShape;OG.shape.VerticalLaneShape=function(a){this.TYPE=OG.Constants.SHAPE_TYPE.GROUP;this.SHAPE_ID="OG.shape.VerticalLaneShape";this.label=a;this.createTerminal=function(){if(!this.geom){return[]}var b=this.geom.getBoundary();return[new OG.Terminal(b.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.INOUT),new OG.Terminal(b.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.INOUT)]};this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({"label-direction":"horizontal","vertical-align":"top"});return this.geom};this.clone=function(){return new OG.shape.VerticalLaneShape(this.label)}};OG.shape.VerticalLaneShape.prototype=new OG.shape.GroupShape();OG.shape.VerticalLaneShape.prototype.constructor=OG.shape.VerticalLaneShape;OG.VerticalLaneShape=OG.shape.VerticalLaneShape;OG.shape.bpmn.A_Subprocess=function(a){this.SHAPE_ID="OG.shape.bpmn.A_Subprocess";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({stroke:"black",r:6});return this.geom};this.clone=function(){return new OG.shape.bpmn.A_Subprocess(this.label)}};OG.shape.bpmn.A_Subprocess.prototype=new OG.shape.GroupShape();OG.shape.bpmn.A_Subprocess.prototype.constructor=OG.shape.bpmn.A_Subprocess;OG.A_Subprocess=OG.shape.bpmn.A_Subprocess;OG.shape.bpmn.A_Task=function(a){this.SHAPE_ID="OG.shape.bpmn.A_Task";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({r:6});return this.geom};this.clone=function(){return new OG.shape.bpmn.A_Task(this.label)}};OG.shape.bpmn.A_Task.prototype=new OG.shape.GeomShape();OG.shape.bpmn.A_Task.prototype.constructor=OG.shape.bpmn.A_Task;OG.A_Task=OG.shape.bpmn.A_Task;OG.shape.bpmn.C_Association=function(c,b,a){this.SHAPE_ID="OG.shape.bpmn.C_Association";this.from=c;this.to=b;this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(this.from||[0,0],this.to||[70,0]);this.geom.style=new OG.geometry.Style({"edge-type":"straight","arrow-start":"none","arrow-end":"none","stroke-dasharray":"."});return this.geom};this.clone=function(){return new OG.shape.bpmn.C_Association(this.from,this.to,this.label)}};OG.shape.bpmn.C_Association.prototype=new OG.shape.EdgeShape();OG.shape.bpmn.C_Association.prototype.constructor=OG.shape.bpmn.C_Association;OG.C_Association=OG.shape.bpmn.C_Association;OG.shape.bpmn.C_Conditional=function(c,b,a){this.SHAPE_ID="OG.shape.bpmn.C_Conditional";this.from=c;this.to=b;this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(this.from||[0,0],this.to||[70,0]);this.geom.style=new OG.geometry.Style({"edge-type":"straight","arrow-start":"open_diamond-wide-long","arrow-end":"open_block-wide-long"});return this.geom};this.clone=function(){return new OG.shape.bpmn.C_Conditional(this.from,this.to,this.label)}};OG.shape.bpmn.C_Conditional.prototype=new OG.shape.EdgeShape();OG.shape.bpmn.C_Conditional.prototype.constructor=OG.shape.bpmn.C_Conditional;OG.C_Conditional=OG.shape.bpmn.C_Conditional;OG.shape.bpmn.C_DataAssociation=function(c,b,a){this.SHAPE_ID="OG.shape.bpmn.C_DataAssociation";this.from=c;this.to=b;this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(this.from||[0,0],this.to||[70,0]);this.geom.style=new OG.geometry.Style({"edge-type":"straight","arrow-start":"none","arrow-end":"classic-wide-long","stroke-dasharray":"."});return this.geom};this.clone=function(){return new OG.shape.bpmn.C_DataAssociation(this.from,this.to,this.label)}};OG.shape.bpmn.C_DataAssociation.prototype=new OG.shape.EdgeShape();OG.shape.bpmn.C_DataAssociation.prototype.constructor=OG.shape.bpmn.C_DataAssociation;OG.C_DataAssociation=OG.shape.bpmn.C_DataAssociation;OG.shape.bpmn.C_Message=function(c,b,a){this.SHAPE_ID="OG.shape.bpmn.C_Message";this.from=c;this.to=b;this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(this.from||[0,0],this.to||[80,0]);this.geom.style=new OG.geometry.Style({"edge-type":"straight","arrow-start":"open_oval-wide-long","arrow-end":"open_block-wide-long","stroke-dasharray":"."});return this.geom};this.clone=function(){return new OG.shape.bpmn.C_Message(this.from,this.to,this.label)}};OG.shape.bpmn.C_Message.prototype=new OG.shape.EdgeShape();OG.shape.bpmn.C_Message.prototype.constructor=OG.shape.bpmn.C_Message;OG.C_Message=OG.shape.bpmn.C_Message;OG.shape.bpmn.C_Sequence=function(c,b,a){this.SHAPE_ID="OG.shape.bpmn.C_Sequence";this.from=c;this.to=b;this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.Line(this.from||[0,0],this.to||[80,0]);this.geom.style=new OG.geometry.Style({"edge-type":"plain","arrow-start":"none","arrow-end":"classic-wide-long"});return this.geom};this.clone=function(){return new OG.shape.bpmn.C_Sequence(this.from,this.to,this.label)}};OG.shape.bpmn.C_Sequence.prototype=new OG.shape.EdgeShape();OG.shape.bpmn.C_Sequence.prototype.constructor=OG.shape.bpmn.C_Sequence;OG.C_Sequence=OG.shape.bpmn.C_Sequence;OG.shape.bpmn.D_Data=function(a){this.SHAPE_ID="OG.shape.bpmn.D_Data";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.PolyLine([[0,0],[0,100],[100,100],[100,20],[80,0],[0,0],[80,0],[80,20],[100,20]]);return this.geom};this.clone=function(){return new OG.shape.bpmn.D_Data(this.label)}};OG.shape.bpmn.D_Data.prototype=new OG.shape.GeomShape();OG.shape.bpmn.D_Data.prototype.constructor=OG.shape.bpmn.D_Data;OG.D_Data=OG.shape.bpmn.D_Data;OG.shape.bpmn.D_Store=function(a){this.SHAPE_ID="OG.shape.bpmn.D_Store";this.label=a;this.createShape=function(){var g,f,e,d,b,c=[];if(this.geom){return this.geom}g=new OG.geometry.Ellipse([50,10],50,10);f=new OG.geometry.Line([0,10],[0,90]);e=new OG.geometry.Line([100,10],[100,90]);d=new OG.geometry.Curve([[100,90],[96,94],[85,97],[50,100],[15,97],[4,94],[0,90]]);b=new OG.geometry.Rectangle([0,10],100,80);b.style=new OG.geometry.Style({stroke:"none"});c.push(g);c.push(f);c.push(e);c.push(d);c.push(b);this.geom=new OG.geometry.GeometryCollection(c);return this.geom};this.clone=function(){return new OG.shape.bpmn.D_Store(this.label)}};OG.shape.bpmn.D_Store.prototype=new OG.shape.GeomShape();OG.shape.bpmn.D_Store.prototype.constructor=OG.shape.bpmn.D_Store;OG.D_Store=OG.shape.bpmn.D_Store;OG.shape.bpmn.E_End=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Circle([50,50],50);this.geom.style=new OG.geometry.Style({"stroke-width":3,"label-position":"bottom"});return this.geom};this.createTerminal=function(){if(!this.geom){return[]}var b=this.geom.getBoundary();return[new OG.Terminal(b.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.IN),new OG.Terminal(b.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.IN),new OG.Terminal(b.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.IN),new OG.Terminal(b.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.IN),new OG.Terminal(b.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.IN)]};this.clone=function(){return new OG.shape.bpmn.E_End(this.label)}};OG.shape.bpmn.E_End.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End.prototype.constructor=OG.shape.bpmn.E_End;OG.E_End=OG.shape.bpmn.E_End;OG.shape.bpmn.E_End_Cancel=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Cancel";this.label=a;this.createShape=function(){var e,d,c,b=[];if(this.geom){return this.geom}e=new OG.geometry.Circle([50,50],50);e.style=new OG.geometry.Style({"stroke-width":3});d=new OG.geometry.Line([25,25],[75,75]);d.style=new OG.geometry.Style({"stroke-width":5});c=new OG.geometry.Line([25,75],[75,25]);c.style=new OG.geometry.Style({"stroke-width":5});b.push(e);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Cancel(this.label)}};OG.shape.bpmn.E_End_Cancel.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Cancel.prototype.constructor=OG.shape.bpmn.E_End_Cancel;OG.E_End_Cancel=OG.shape.bpmn.E_End_Cancel;OG.shape.bpmn.E_End_Compensation=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Compensation";this.label=a;this.createShape=function(){var e,d,c,b=[];if(this.geom){return this.geom}e=new OG.geometry.Circle([50,50],50);e.style=new OG.geometry.Style({"stroke-width":3});d=new OG.geometry.Polygon([[15,50],[45,70],[45,30]]);d.style=new OG.geometry.Style({fill:"black","fill-opacity":1});c=new OG.geometry.Polygon([[45,50],[75,70],[75,30]]);c.style=new OG.geometry.Style({fill:"black","fill-opacity":1});b.push(e);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Compensation(this.label)}};OG.shape.bpmn.E_End_Compensation.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Compensation.prototype.constructor=OG.shape.bpmn.E_End_Compensation;OG.E_End_Compensation=OG.shape.bpmn.E_End_Compensation;OG.shape.bpmn.E_End_Error=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Error";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":3});c=new OG.geometry.PolyLine([[20,75],[40,40],[60,60],[80,20]]);c.style=new OG.geometry.Style({"stroke-width":2});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Error(this.label)}};OG.shape.bpmn.E_End_Error.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Error.prototype.constructor=OG.shape.bpmn.E_End_Error;OG.E_End_Error=OG.shape.bpmn.E_End_Error;OG.shape.bpmn.E_End_Link=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Link";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":3});c=new OG.geometry.Polygon([[20,40],[20,60],[60,60],[60,80],[85,50],[60,20],[60,40]]);c.style=new OG.geometry.Style({fill:"black","fill-opacity":1});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Link(this.label)}};OG.shape.bpmn.E_End_Link.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Link.prototype.constructor=OG.shape.bpmn.E_End_Link;OG.E_End_Link=OG.shape.bpmn.E_End_Link;OG.shape.bpmn.E_End_Message=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Message";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":3});c=new OG.geometry.PolyLine([[20,30],[20,70],[80,70],[80,30],[20,30],[50,50],[80,30]]);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Message(this.label)}};OG.shape.bpmn.E_End_Message.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Message.prototype.constructor=OG.shape.bpmn.E_End_Message;OG.E_End_Message=OG.shape.bpmn.E_End_Message;OG.shape.bpmn.E_End_Multiple=function(a){this.SHAPE_ID="OG.shape.bpmn.E_End_Multiple";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":3});c=new OG.geometry.Polygon([[50,15],[39,33],[20,33],[29,50],[19,67],[40,67],[50,85],[60,68],[80,68],[70,50],[79,33],[60,33]]);c.style=new OG.geometry.Style({fill:"black","fill-opacity":1});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_End_Multiple(this.label)}};OG.shape.bpmn.E_End_Multiple.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_End_Multiple.prototype.constructor=OG.shape.bpmn.E_End_Multiple;OG.E_End_Multiple=OG.shape.bpmn.E_End_Multiple;OG.shape.bpmn.E_Intermediate=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate";this.label=a;this.createShape=function(){var b=[];if(this.geom){return this.geom}b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate(this.label)}};OG.shape.bpmn.E_Intermediate.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate.prototype.constructor=OG.shape.bpmn.E_Intermediate;OG.E_Intermediate=OG.shape.bpmn.E_Intermediate;OG.shape.bpmn.E_Intermediate_Compensation=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Compensation";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Polygon([[15,50],[45,70],[45,30]]);c=new OG.geometry.Polygon([[45,50],[75,70],[75,30]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Compensation(this.label)}};OG.shape.bpmn.E_Intermediate_Compensation.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Compensation.prototype.constructor=OG.shape.bpmn.E_Intermediate_Compensation;OG.E_Intermediate_Compensation=OG.shape.bpmn.E_Intermediate_Compensation;OG.shape.bpmn.E_Intermediate_Error=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Error";this.label=a;this.createShape=function(){var c,b=[];if(this.geom){return this.geom}c=new OG.geometry.PolyLine([[20,75],[40,40],[60,60],[80,20]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Error(this.label)}};OG.shape.bpmn.E_Intermediate_Error.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Error.prototype.constructor=OG.shape.bpmn.E_Intermediate_Error;OG.E_Intermediate_Error=OG.shape.bpmn.E_Intermediate_Error;OG.shape.bpmn.E_Intermediate_Link=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Link";this.label=a;this.createShape=function(){var c,b=[];if(this.geom){return this.geom}c=new OG.geometry.Polygon([[20,40],[20,60],[60,60],[60,80],[85,50],[60,20],[60,40]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Link(this.label)}};OG.shape.bpmn.E_Intermediate_Link.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Link.prototype.constructor=OG.shape.bpmn.E_Intermediate_Link;OG.E_Intermediate_Link=OG.shape.bpmn.E_Intermediate_Link;OG.shape.bpmn.E_Intermediate_Message=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Message";this.label=a;this.createShape=function(){var c,b=[];if(this.geom){return this.geom}c=new OG.geometry.PolyLine([[20,30],[20,70],[80,70],[80,30],[20,30],[50,50],[80,30]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Message(this.label)}};OG.shape.bpmn.E_Intermediate_Message.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Message.prototype.constructor=OG.shape.bpmn.E_Intermediate_Message;OG.E_Intermediate_Message=OG.shape.bpmn.E_Intermediate_Message;OG.shape.bpmn.E_Intermediate_Multiple=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Multiple";this.label=a;this.createShape=function(){var c,b=[];if(this.geom){return this.geom}c=new OG.geometry.Polygon([[50,15],[39,33],[20,33],[29,50],[19,67],[40,67],[50,85],[60,68],[80,68],[70,50],[79,33],[60,33]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Multiple(this.label)}};OG.shape.bpmn.E_Intermediate_Multiple.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Multiple.prototype.constructor=OG.shape.bpmn.E_Intermediate_Multiple;OG.E_Intermediate_Multiple=OG.shape.bpmn.E_Intermediate_Multiple;OG.shape.bpmn.E_Intermediate_Rule=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Rule";this.label=a;this.createShape=function(){var c,b=[];if(this.geom){return this.geom}c=new OG.geometry.Rectangle([25,20],50,60);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(c);b.push(new OG.geometry.Line([30,30],[70,30]));b.push(new OG.geometry.Line([30,45],[70,45]));b.push(new OG.geometry.Line([30,60],[70,60]));b.push(new OG.geometry.Line([30,70],[70,70]));this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Rule(this.label)}};OG.shape.bpmn.E_Intermediate_Rule.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Rule.prototype.constructor=OG.shape.bpmn.E_Intermediate_Rule;OG.E_Intermediate_Rule=OG.shape.bpmn.E_Intermediate_Rule;OG.shape.bpmn.E_Intermediate_Timer=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Intermediate_Timer";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],32);c=new OG.geometry.PolyLine([[50,30],[50,50],[70,50]]);b.push(new OG.geometry.Circle([50,50],50));b.push(new OG.geometry.Circle([50,50],42));b.push(d);b.push(new OG.geometry.Line([50,18],[50,25]));b.push(new OG.geometry.Line([50,82],[50,75]));b.push(new OG.geometry.Line([18,50],[25,50]));b.push(new OG.geometry.Line([82,50],[75,50]));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Intermediate_Timer(this.label)}};OG.shape.bpmn.E_Intermediate_Timer.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Intermediate_Timer.prototype.constructor=OG.shape.bpmn.E_Intermediate_Timer;OG.E_Intermediate_Timer=OG.shape.bpmn.E_Intermediate_Timer;OG.shape.bpmn.E_Start=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Circle([50,50],50);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.createTerminal=function(){if(!this.geom){return[]}var b=this.geom.getBoundary();return[new OG.Terminal(b.getCentroid(),OG.Constants.TERMINAL_TYPE.C,OG.Constants.TERMINAL_TYPE.OUT),new OG.Terminal(b.getRightCenter(),OG.Constants.TERMINAL_TYPE.E,OG.Constants.TERMINAL_TYPE.OUT),new OG.Terminal(b.getLeftCenter(),OG.Constants.TERMINAL_TYPE.W,OG.Constants.TERMINAL_TYPE.OUT),new OG.Terminal(b.getLowerCenter(),OG.Constants.TERMINAL_TYPE.S,OG.Constants.TERMINAL_TYPE.OUT),new OG.Terminal(b.getUpperCenter(),OG.Constants.TERMINAL_TYPE.N,OG.Constants.TERMINAL_TYPE.OUT)]};this.clone=function(){return new OG.shape.bpmn.E_Start(this.label)}};OG.shape.bpmn.E_Start.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start.prototype.constructor=OG.shape.bpmn.E_Start;OG.E_Start=OG.shape.bpmn.E_Start;OG.shape.bpmn.E_Start_Link=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start_Link";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":1});c=new OG.geometry.Polygon([[20,40],[20,60],[60,60],[60,80],[85,50],[60,20],[60,40]]);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Start_Link(this.label)}};OG.shape.bpmn.E_Start_Link.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start_Link.prototype.constructor=OG.shape.bpmn.E_Start_Link;OG.E_Start_Link=OG.shape.bpmn.E_Start_Link;OG.shape.bpmn.E_Start_Message=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start_Message";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);c=new OG.geometry.PolyLine([[20,30],[20,70],[80,70],[80,30],[20,30],[50,50],[80,30]]);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Start_Message(this.label)}};OG.shape.bpmn.E_Start_Message.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start_Message.prototype.constructor=OG.shape.bpmn.E_Start_Message;OG.E_Start_Message=OG.shape.bpmn.E_Start_Message;OG.shape.bpmn.E_Start_Multiple=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start_Multiple";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);c=new OG.geometry.Polygon([[50,15],[39,33],[20,33],[29,50],[19,67],[40,67],[50,85],[60,68],[80,68],[70,50],[79,33],[60,33]]);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Start_Multiple(this.label)}};OG.shape.bpmn.E_Start_Multiple.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start_Multiple.prototype.constructor=OG.shape.bpmn.E_Start_Multiple;OG.E_Start_Multiple=OG.shape.bpmn.E_Start_Multiple;OG.shape.bpmn.E_Start_Rule=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start_Rule";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":1});c=new OG.geometry.Rectangle([25,20],50,60);b.push(d);b.push(c);b.push(new OG.geometry.Line([30,30],[70,30]));b.push(new OG.geometry.Line([30,45],[70,45]));b.push(new OG.geometry.Line([30,60],[70,60]));b.push(new OG.geometry.Line([30,70],[70,70]));this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Start_Rule(this.label)}};OG.shape.bpmn.E_Start_Rule.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start_Rule.prototype.constructor=OG.shape.bpmn.E_Start_Rule;OG.E_Start_Rule=OG.shape.bpmn.E_Start_Rule;OG.shape.bpmn.E_Start_Timer=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Start_Timer";this.label=a;this.createShape=function(){var e,d,c,b=[];if(this.geom){return this.geom}e=new OG.geometry.Circle([50,50],50);e.style=new OG.geometry.Style({"stroke-width":1});d=new OG.geometry.Circle([50,50],32);c=new OG.geometry.PolyLine([[50,30],[50,50],[70,50]]);b.push(e);b.push(d);b.push(new OG.geometry.Line([50,18],[50,25]));b.push(new OG.geometry.Line([50,82],[50,75]));b.push(new OG.geometry.Line([18,50],[25,50]));b.push(new OG.geometry.Line([82,50],[75,50]));b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Start_Timer(this.label)}};OG.shape.bpmn.E_Start_Timer.prototype=new OG.shape.GeomShape();OG.shape.bpmn.E_Start_Timer.prototype.constructor=OG.shape.bpmn.E_Start_Timer;OG.E_Start_Timer=OG.shape.bpmn.E_Start_Timer;OG.shape.bpmn.E_Terminate=function(a){this.SHAPE_ID="OG.shape.bpmn.E_Terminate";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Circle([50,50],50);d.style=new OG.geometry.Style({"stroke-width":3});c=new OG.geometry.Circle([50,50],30);c.style=new OG.geometry.Style({fill:"black","fill-opacity":1});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({"label-position":"bottom"});return this.geom};this.clone=function(){return new OG.shape.bpmn.E_Terminate(this.label)}};OG.shape.bpmn.E_Terminate.prototype=new OG.shape.bpmn.E_End();OG.shape.bpmn.E_Terminate.prototype.constructor=OG.shape.bpmn.E_Terminate;OG.E_Terminate=OG.shape.bpmn.E_Terminate;OG.shape.bpmn.G_Complex=function(a){this.SHAPE_ID="OG.shape.bpmn.G_Complex";this.label=a;this.createShape=function(){var g,f,e,d,b,c=[];if(this.geom){return this.geom}g=new OG.geometry.Polygon([[0,50],[50,100],[100,50],[50,0]]);f=new OG.geometry.Line([30,30],[70,70]);f.style=new OG.geometry.Style({"stroke-width":3});e=new OG.geometry.Line([30,70],[70,30]);e.style=new OG.geometry.Style({"stroke-width":3});d=new OG.geometry.Line([20,50],[80,50]);d.style=new OG.geometry.Style({"stroke-width":3});b=new OG.geometry.Line([50,20],[50,80]);b.style=new OG.geometry.Style({"stroke-width":3});c.push(g);c.push(f);c.push(e);c.push(d);c.push(b);this.geom=new OG.geometry.GeometryCollection(c);return this.geom};this.clone=function(){return new OG.shape.bpmn.G_Complex(this.label)}};OG.shape.bpmn.G_Complex.prototype=new OG.shape.GeomShape();OG.shape.bpmn.G_Complex.prototype.constructor=OG.shape.bpmn.G_Complex;OG.G_Complex=OG.shape.bpmn.G_Complex;OG.shape.bpmn.G_Exclusive=function(a){this.SHAPE_ID="OG.shape.bpmn.G_Exclusive";this.label=a;this.createShape=function(){var e,d,c,b=[];if(this.geom){return this.geom}e=new OG.geometry.Polygon([[0,50],[50,100],[100,50],[50,0]]);d=new OG.geometry.Line([30,30],[70,70]);d.style=new OG.geometry.Style({"stroke-width":5});c=new OG.geometry.Line([30,70],[70,30]);c.style=new OG.geometry.Style({"stroke-width":5});b.push(e);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);return this.geom};this.clone=function(){return new OG.shape.bpmn.G_Exclusive(this.label)}};OG.shape.bpmn.G_Exclusive.prototype=new OG.shape.GeomShape();OG.shape.bpmn.G_Exclusive.prototype.constructor=OG.shape.bpmn.G_Exclusive;OG.G_Exclusive=OG.shape.bpmn.G_Exclusive;OG.shape.bpmn.G_Gateway=function(a){this.SHAPE_ID="OG.shape.bpmn.G_Gateway";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Polygon([[0,50],[50,100],[100,50],[50,0]]);return this.geom};this.clone=function(){return new OG.shape.bpmn.G_Gateway(this.label)}};OG.shape.bpmn.G_Gateway.prototype=new OG.shape.GeomShape();OG.shape.bpmn.G_Gateway.prototype.constructor=OG.shape.bpmn.G_Gateway;OG.G_Gateway=OG.shape.bpmn.G_Gateway;OG.shape.bpmn.G_Inclusive=function(a){this.SHAPE_ID="OG.shape.bpmn.G_Inclusive";this.label=a;this.createShape=function(){var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Polygon([[0,50],[50,100],[100,50],[50,0]]);c=new OG.geometry.Circle([50,50],25);c.style=new OG.geometry.Style({"stroke-width":3});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);return this.geom};this.clone=function(){return new OG.shape.bpmn.G_Inclusive(this.label)}};OG.shape.bpmn.G_Inclusive.prototype=new OG.shape.GeomShape();OG.shape.bpmn.G_Inclusive.prototype.constructor=OG.shape.bpmn.G_Inclusive;OG.G_Inclusive=OG.shape.bpmn.G_Inclusive;OG.shape.bpmn.G_Parallel=function(a){this.SHAPE_ID="OG.shape.bpmn.G_Parallel";this.label=a;this.createShape=function(){var e,d,c,b=[];if(this.geom){return this.geom}e=new OG.geometry.Polygon([[0,50],[50,100],[100,50],[50,0]]);d=new OG.geometry.Line([20,50],[80,50]);d.style=new OG.geometry.Style({"stroke-width":5});c=new OG.geometry.Line([50,20],[50,80]);c.style=new OG.geometry.Style({"stroke-width":5});b.push(e);b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);return this.geom};this.clone=function(){return new OG.shape.bpmn.G_Parallel(this.label)}};OG.shape.bpmn.G_Parallel.prototype=new OG.shape.GeomShape();OG.shape.bpmn.G_Parallel.prototype.constructor=OG.shape.bpmn.G_Parallel;OG.G_Parallel=OG.shape.bpmn.G_Parallel;OG.shape.bpmn.M_Annotation=function(a){this.SHAPE_ID="OG.shape.bpmn.M_Annotation";this.label=a||"Annotation";this.createShape=function(){if(this.geom){return this.geom}var d,c,b=[];if(this.geom){return this.geom}d=new OG.geometry.Rectangle([0,0],100,100);d.style=new OG.geometry.Style({stroke:"none"});c=new OG.geometry.PolyLine([[10,0],[0,0],[0,100],[10,100]]);c.style=new OG.geometry.Style({stroke:"black"});b.push(d);b.push(c);this.geom=new OG.geometry.GeometryCollection(b);this.geom.style=new OG.geometry.Style({});return this.geom};this.clone=function(){return new OG.shape.bpmn.M_Annotation(this.label)}};OG.shape.bpmn.M_Annotation.prototype=new OG.shape.GeomShape();OG.shape.bpmn.M_Annotation.prototype.constructor=OG.shape.bpmn.M_Annotation;OG.M_Annotation=OG.shape.bpmn.M_Annotation;OG.shape.bpmn.M_Group=function(a){this.SHAPE_ID="OG.shape.bpmn.M_Group";this.label=a;this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({"stroke-dasharray":"-",r:6});return this.geom};this.clone=function(){return new OG.shape.bpmn.M_Group(this.label)}};OG.shape.bpmn.M_Group.prototype=new OG.shape.GeomShape();OG.shape.bpmn.M_Group.prototype.constructor=OG.shape.bpmn.M_Group;OG.M_Group=OG.shape.bpmn.M_Group;OG.shape.bpmn.M_Text=function(a){this.SHAPE_ID="OG.shape.bpmn.M_Text";this.label=a||"Text";this.createShape=function(){if(this.geom){return this.geom}this.geom=new OG.geometry.Rectangle([0,0],100,100);this.geom.style=new OG.geometry.Style({stroke:"none"});return this.geom};this.clone=function(){return new OG.shape.bpmn.M_Text(this.label)}};OG.shape.bpmn.M_Text.prototype=new OG.shape.GeomShape();OG.shape.bpmn.M_Text.prototype.constructor=OG.shape.bpmn.M_Text;OG.M_Text=OG.shape.bpmn.M_Text;OG.renderer.IRenderer=function(){this.drawShape=function(a,b,c,d,e){throw new OG.NotImplementedException()};this.drawGeom=function(b,a,c){throw new OG.NotImplementedException()};this.drawText=function(a,d,b,c,e){throw new OG.NotImplementedException()};this.drawImage=function(a,d,b,c,e){throw new OG.NotImplementedException()};this.drawEdge=function(a,c,d,b){throw new OG.NotImplementedException()};this.drawLabel=function(a,c,b){throw new OG.NotImplementedException()};this.drawEdgeLabel=function(a,c,b){throw new OG.NotImplementedException()};this.redrawShape=function(a,b){throw new OG.NotImplementedException()};this.redrawEdge=function(a){throw new OG.NotImplementedException()};this.redrawConnectedEdge=function(a,b){throw new OG.NotImplementedException()};this.connect=function(e,d,c,b,a){throw new OG.NotImplementedException()};this.disconnect=function(a){throw new OG.NotImplementedException()};this.drawDropOverGuide=function(a){throw new OG.NotImplementedException()};this.drawGuide=function(a){throw new OG.NotImplementedException()};this.removeGuide=function(a){throw new OG.NotImplementedException()};this.removeAllGuide=function(){throw new OG.NotImplementedException()};this.drawEdgeGuide=function(a){throw new OG.NotImplementedException()};this.drawRubberBand=function(a,b,c){throw new OG.NotImplementedException()};this.removeRubberBand=function(a){throw new OG.NotImplementedException()};this.drawTerminal=function(a,b){throw new OG.NotImplementedException()};this.removeTerminal=function(a){throw new OG.NotImplementedException()};this.removeAllTerminal=function(){throw new OG.NotImplementedException()};this.drawCollapseGuide=function(a){throw new OG.NotImplementedException()};this.removeCollapseGuide=function(a){throw new OG.NotImplementedException()};this.group=function(a){throw new OG.NotImplementedException()};this.ungroup=function(a){throw new OG.NotImplementedException()};this.addToGroup=function(a,b){throw new OG.NotImplementedException()};this.collapse=function(a){throw new OG.NotImplementedException()};this.expand=function(a){throw new OG.NotImplementedException()};this.clear=function(){throw new OG.NotImplementedException()};this.removeShape=function(a){throw new OG.NotImplementedException()};this.remove=function(a){throw new OG.NotImplementedException()};this.removeChild=function(a){throw new OG.NotImplementedException()};this.getRootElement=function(){throw new OG.NotImplementedException()};this.getRootGroup=function(){throw new OG.NotImplementedException()};this.getElementByPoint=function(a){throw new OG.NotImplementedException()};this.getElementsByBBox=function(a){throw new OG.NotImplementedException()};this.setAttr=function(a,b){throw new OG.NotImplementedException()};this.getAttr=function(b,a){throw new OG.NotImplementedException()};this.setShapeStyle=function(a,b){throw new OG.NotImplementedException()};this.toFront=function(a){throw new OG.NotImplementedException()};this.toBack=function(a){throw new OG.NotImplementedException()};this.getCanvasSize=function(){throw new OG.NotImplementedException()};this.setCanvasSize=function(a){throw new OG.NotImplementedException()};this.fitCanvasSize=function(b,a){throw new OG.NotImplementedException()};this.setViewBox=function(a,b,c){throw new OG.NotImplementedException()};this.getScale=function(a){throw new OG.NotImplementedException()};this.setScale=function(a){throw new OG.NotImplementedException()};this.show=function(a){throw new OG.NotImplementedException()};this.hide=function(a){throw new OG.NotImplementedException()};this.appendChild=function(a,b){throw new OG.NotImplementedException()};this.insertAfter=function(a,b){throw new OG.NotImplementedException()};this.insertBefore=function(a,b){throw new OG.NotImplementedException()};this.move=function(a,b){throw new OG.NotImplementedException()};this.moveCentroid=function(b,a){throw new OG.NotImplementedException()};this.rotate=function(a,b){throw new OG.NotImplementedException()};this.resize=function(a,b){throw new OG.NotImplementedException()};this.resizeBox=function(b,a){throw new OG.NotImplementedException()};this.intersectionEdge=function(b,c,e,d,a){throw new OG.NotImplementedException()};this.clone=function(a){throw new OG.NotImplementedException()};this.getElementById=function(a){throw new OG.NotImplementedException()};this.getElementsByType=function(b,a){throw new OG.NotImplementedException()};this.getBBox=function(a){throw new OG.NotImplementedException()};this.getRootBBox=function(){throw new OG.NotImplementedException()};this.getRealRootBBox=function(){throw new OG.NotImplementedException()};this.getContainer=function(){throw new OG.NotImplementedException()};this.isSVG=function(){throw new OG.NotImplementedException()};this.isVML=function(){throw new OG.NotImplementedException()}};OG.renderer.IRenderer.prototype=new OG.renderer.IRenderer();OG.renderer.IRenderer.prototype.constructor=OG.renderer.IRenderer;OG.renderer.RaphaelRenderer=function(n,r,g,a){var q=new Raphael(n,r?r[0]:null,r?r[1]:null),o=Math.round(Math.random()*10000),j=0,t=new OG.HashMap(),k,f,u=this,d=g||OG.Constants.CANVAS_BACKGROUND,c,p,v,h,w,e,s,m,b,i,l;c=function(){var x="OG_"+o+"_"+j;j++;return x};p=function(y,A,x,z){y.id=A||c();y.node.id=y.id;y.node.raphaelid=y.id;if(x){$(y.node).attr("_type",x)}if(z){$(y.node).attr("_shape",z)}t.put(y.id,y);return y};v=function(x){var z,y;if(x){z=x.node.childNodes;for(y=z.length-1;y>=0;y--){v(w(z[y].id))}t.remove(x.id);x.remove()}};h=function(x){var z,y;if(x){z=x.node.childNodes;for(y=z.length-1;y>=0;y--){v(w(z[y].id))}}};w=function(x){return t.get(x)};e=function(D,F,x,G){var A=0,H="",E,B,y,z={},C=function(Q,N){var M,L,J,I,K,O=[],P=function(U,T,S){var R=Math.PI/180*S;return new OG.geometry.Coordinate(OG.Util.round(U.x+T*Math.cos(R)),OG.Util.round(U.y+T*Math.sin(R)))};M=OG.JSON.decode(Q.toString());L=Q.getVertices();K=M.angle;J=P(L[0],N,90+K);I=P(L[0],N,K);O=O.concat(["M",J.x,J.y,"Q",L[0].x,L[0].y,I.x,I.y]);J=P(L[1],N,180+K);I=P(L[1],N,90+K);O=O.concat(["L",J.x,J.y,"Q",L[1].x,L[1].y,I.x,I.y]);J=P(L[2],N,270+K);I=P(L[2],N,180+K);O=O.concat(["L",J.x,J.y,"Q",L[2].x,L[2].y,I.x,I.y]);J=P(L[3],N,K);I=P(L[3],N,270+K);O=O.concat(["L",J.x,J.y,"Q",L[3].x,L[3].y,I.x,I.y,"Z"]);return O.toString()};if(G){OG.Util.apply(z,(x instanceof OG.geometry.Style)?x.map:x||{},OG.Util.apply({},F.style.map,OG.Util.apply({},G,OG.Constants.DEFAULT_STYLE.GEOM)))}else{OG.Util.apply(z,(x instanceof OG.geometry.Style)?x.map:x||{},OG.Util.apply({},F.style.map,OG.Constants.DEFAULT_STYLE.GEOM))}F.style.map=z;switch(F.TYPE){case OG.Constants.GEOM_TYPE.POINT:B=q.circle(F.coordinate.x,F.coordinate.y,0.5);B.attr(z);break;case OG.Constants.GEOM_TYPE.LINE:case OG.Constants.GEOM_TYPE.POLYLINE:case OG.Constants.GEOM_TYPE.POLYGON:H="";E=F.getVertices();for(A=0;A<E.length;A++){if(A===0){H="M"+E[A].x+" "+E[A].y}else{H+="L"+E[A].x+" "+E[A].y}}B=q.path(H);B.attr(z);break;case OG.Constants.GEOM_TYPE.RECTANGLE:if((z.r||0)===0){H="";E=F.getVertices();for(A=0;A<E.length;A++){if(A===0){H="M"+E[A].x+" "+E[A].y}else{H+="L"+E[A].x+" "+E[A].y}}}else{H=C(F,z.r||0)}B=q.path(H);B.attr(z);break;case OG.Constants.GEOM_TYPE.CIRCLE:y=OG.JSON.decode(F.toString());if(y.type===OG.Constants.GEOM_NAME[OG.Constants.GEOM_TYPE.CIRCLE]){B=q.circle(y.center[0],y.center[1],y.radius)}else{if(y.type===OG.Constants.GEOM_NAME[OG.Constants.GEOM_TYPE.ELLIPSE]){if(y.angle===0){B=q.ellipse(y.center[0],y.center[1],y.radiusX,y.radiusY)}else{H="";E=F.getControlPoints();H="M"+E[1].x+" "+E[1].y+"A"+y.radiusX+" "+y.radiusY+" "+y.angle+" 1 0 "+E[5].x+" "+E[5].y;H+="M"+E[1].x+" "+E[1].y+"A"+y.radiusX+" "+y.radiusY+" "+y.angle+" 1 1 "+E[5].x+" "+E[5].y;B=q.path(H)}}}B.attr(z);break;case OG.Constants.GEOM_TYPE.ELLIPSE:y=OG.JSON.decode(F.toString());if(y.angle===0){B=q.ellipse(y.center[0],y.center[1],y.radiusX,y.radiusY)}else{H="";E=F.getControlPoints();H="M"+E[1].x+" "+E[1].y+"A"+y.radiusX+" "+y.radiusY+" "+y.angle+" 1 0 "+E[5].x+" "+E[5].y;H+="M"+E[1].x+" "+E[1].y+"A"+y.radiusX+" "+y.radiusY+" "+y.angle+" 1 1 "+E[5].x+" "+E[5].y;B=q.path(H)}B.attr(z);break;case OG.Constants.GEOM_TYPE.CURVE:H="";E=F.getControlPoints();for(A=0;A<E.length;A++){if(A===0){H="M"+E[A].x+" "+E[A].y}else{if(A===1){H+="R"+E[A].x+" "+E[A].y}else{H+=" "+E[A].x+" "+E[A].y}}}B=q.path(H);B.attr(z);break;case OG.Constants.GEOM_TYPE.COLLECTION:for(A=0;A<F.geometries.length;A++){e(D,F.geometries[A],x,F.style.map)}break}if(B){p(B);D.appendChild(B.node);return B.node}else{return D}};s=function(z,y,C,B){var x={x:C[0],y:C[1]},A={x:B[0],y:B[1]};if(z==="c"&&y==="c"){if(x.x<=A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="e";y="w"}else{z="s";y="n"}}else{if(x.x<=A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="e";y="w"}else{z="n";y="s"}}else{if(x.x>A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="w";y="e"}else{z="s";y="n"}}else{if(x.x>A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="w";y="e"}else{z="n";y="s"}}}}}}else{if(z==="c"&&y!=="c"){if(x.x<=A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="e"}else{z="s"}}else{if(x.x<=A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="e"}else{z="n"}}else{if(x.x>A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="w"}else{z="s"}}else{if(x.x>A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){z="w"}else{z="n"}}}}}}else{if(z!=="c"&&y==="c"){if(x.x<=A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){y="w"}else{y="n"}}else{if(x.x<=A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){y="w"}else{y="s"}}else{if(x.x>A.x&&x.y<=A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){y="e"}else{y="n"}}else{if(x.x>A.x&&x.y>A.y){if(Math.abs(A.x-x.x)>Math.abs(A.y-x.y)){y="e"}else{y="s"}}}}}}}}return z+" "+y};m=function(z,E,F){var C={x:E[0],y:E[1]},x={x:F[0],y:F[1]},G=u.drawTerminal(z),A=G.terminal.childNodes,D,B,y;if(Math.abs(x.x-C.x)>Math.abs(x.y-C.y)){if(x.x>C.x){D="e"}else{D="w"}}else{if(x.y>C.y){D="s"}else{D="n"}}B=A[0];for(y=0;y<A.length;y++){if(A[y].terminal&&A[y].terminal.direction.toLowerCase()===D){B=A[y];break}}return B};b=function(z,D,E){var C={x:D[0],y:D[1]},x={x:E[0],y:E[1]},F=u.drawTerminal(z),A=F.terminal.childNodes,B,G,y;if(Math.abs(x.x-C.x)>Math.abs(x.y-C.y)){if(x.x>C.x){B="w"}else{B="e"}}else{if(x.y>C.y){B="n"}else{B="s"}}G=A[0];for(y=0;y<A.length;y++){if(A[y].terminal&&A[y].terminal.direction.toLowerCase()===B){G=A[y];break}}return G};i=function(x){var y=OG.Util.isElement(x)?x.id:x;if(y){return u.getElementById(y.substring(0,y.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP)))}else{return null}};l=function(T,K,M,R,O,D){var C=OG.Constants.LABEL_PADDING,P=M?M[0]-C*2:null,N=M?M[1]-C*2:null,S=M?M[2]||0:0,G,A,z,F={},H,Q,E,B,L,J,I;OG.Util.apply(F,(R instanceof OG.geometry.Style)?R.map:R||{},OG.Constants.DEFAULT_STYLE.TEXT);if(O===0||O){G=w(O);if(G){h(G)}else{G=q.group();p(G,O)}}else{G=q.group();p(G,O)}H=F["text-anchor"]||"middle";F["text-anchor"]="middle";A=q.text(T[0],T[1],K);A.attr(F);E=A.getBBox();P=P?(P>E.width?P:E.width):E.width;N=N?(N>E.height?N:E.height):E.height;B=OG.Util.round(T[0]-P/2);L=OG.Util.round(T[1]-N/2);Q=new OG.Rectangle([B,L],P,N);if(F["label-direction"]==="vertical"){switch(H){case"start":I=Q.getBoundary().getLowerCenter().y;break;case"end":I=Q.getBoundary().getUpperCenter().y;break;case"middle":I=Q.getBoundary().getCentroid().y;break;default:I=Q.getBoundary().getCentroid().y;break}switch(F["vertical-align"]){case"top":J=OG.Util.round(Q.getBoundary().getLeftCenter().x+E.height/2);break;case"bottom":J=OG.Util.round(Q.getBoundary().getRightCenter().x-E.height/2);break;case"middle":J=Q.getBoundary().getCentroid().x;break;default:J=Q.getBoundary().getCentroid().x;break}S=-90}else{switch(H){case"start":J=Q.getBoundary().getLeftCenter().x;break;case"end":J=Q.getBoundary().getRightCenter().x;break;case"middle":J=Q.getBoundary().getCentroid().x;break;default:J=Q.getBoundary().getCentroid().x;break}switch(F["vertical-align"]){case"top":I=OG.Util.round(Q.getBoundary().getUpperCenter().y+E.height/2);break;case"bottom":I=OG.Util.round(Q.getBoundary().getLowerCenter().y-E.height/2);break;case"middle":I=Q.getBoundary().getCentroid().y;break;default:I=Q.getBoundary().getCentroid().y;break}}A.attr({x:J,y:I,stroke:"none",fill:F["font-color"]||OG.Constants.DEFAULT_STYLE.LABEL["font-color"],"font-size":F["font-size"]||OG.Constants.DEFAULT_STYLE.LABEL["font-size"],"fill-opacity":1});if(S||F["label-angle"]){if(S===0){S=parseInt(F["label-angle"],10)}A.rotate(S)}A.attr({"text-anchor":H});if(D&&K){E=A.getBBox();z=q.rect(E.x-C/2,E.y-C/2,E.width+C,E.height+C);z.attr({stroke:"none",fill:d,"fill-opacity":1});p(z);G.node.appendChild(z.node)}p(A);G.node.appendChild(A.node);return G.node};k=p(q.group(),null,OG.Constants.NODE_TYPE.ROOT);f=p(q.group(),null,OG.Constants.NODE_TYPE.ETC);q.id="OG_"+o;q.canvas.id="OG_"+o;$(q.canvas).css({"background-color":d,"user-select":"none","-o-user-select":"none","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none"});if(a){$(q.canvas).css({"background-image":a})}$(q.canvas.parentNode).attr("tabindex","0");$(q.canvas.parentNode).css({outline:"none"});if($(q.canvas.parentNode).css("position")==="static"){$(q.canvas.parentNode).css({position:"relative",left:"0",top:"0"})}this.drawShape=function(D,E,I,x,y){var z=I?I[0]:100,H=I?I[1]:100,A,F,G,B,C;if(E instanceof OG.shape.GeomShape){F=E.createShape();F.moveCentroid(D);F.resizeBox(z,H);A=this.drawGeom(F,x,y);E.geom=A.geom}else{if(E instanceof OG.shape.TextShape){G=E.createShape();A=this.drawText(D,G,I,x,y);E.text=A.text;E.angle=A.angle;E.geom=A.geom}else{if(E instanceof OG.shape.ImageShape){B=E.createShape();A=this.drawImage(D,B,I,x,y);E.image=A.image;E.angle=A.angle;E.geom=A.geom}else{if(E instanceof OG.shape.HtmlShape){C=E.createShape();A=this.drawHtml(D,C,I,x,y);E.html=A.html;E.angle=A.angle;E.geom=A.geom}else{if(E instanceof OG.shape.EdgeShape){F=E.geom||E.createShape();A=this.drawEdge(F,x,y);E.geom=A.geom}else{if(E instanceof OG.shape.GroupShape){F=E.createShape();F.moveCentroid(D);F.resizeBox(z,H);A=this.drawGroup(F,x,y);E.geom=A.geom}}}}}}if(E.geom){A.shape=E}A.shapeStyle=(x instanceof OG.geometry.Style)?x.map:x;$(A).attr("_shape_id",E.SHAPE_ID);if(!(E instanceof OG.shape.TextShape)){this.drawLabel(A);if(E instanceof OG.shape.EdgeShape){this.drawEdgeLabel(A,null,"FROM");this.drawEdgeLabel(A,null,"TO")}}if(A.geom){if(OG.Util.isIE7()){A.removeAttribute("geom")}else{delete A.geom}}if(A.text){if(OG.Util.isIE7()){A.removeAttribute("text")}else{delete A.text}}if(A.image){if(OG.Util.isIE7()){A.removeAttribute("image")}else{delete A.image}}if(A.angle){if(OG.Util.isIE7()){A.removeAttribute("angle")}else{delete A.angle}}$(q.canvas).trigger("drawShape",[A]);return A};this.drawGeom=function(A,y,B){var z,x={};OG.Util.apply(x,(y instanceof OG.geometry.Style)?y.map:y||{});if(B===0||B){z=w(B);if(z){h(z)}else{z=q.group();p(z,B,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.GEOM);k.node.appendChild(z.node)}}else{z=q.group();p(z,B,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.GEOM);k.node.appendChild(z.node)}e(z.node,A,x);z.node.geom=A;z.attr(OG.Constants.DEFAULT_STYLE.SHAPE);if(z.node.shape){z.node.shape.geom=A;if(z.node.geom){if(OG.Util.isIE7()){z.node.removeAttribute("geom")}else{delete z.node.geom}}}return z.node};this.drawText=function(G,M,P,z,A){var B=P?P[0]:null,N=P?P[1]:null,E=P?P[2]||0:0,L,F,D={},J,O,C,I,K,H;OG.Util.apply(D,(z instanceof OG.geometry.Style)?z.map:z||{},OG.Constants.DEFAULT_STYLE.TEXT);if(A===0||A){L=w(A);if(L){h(L)}else{L=q.group();p(L,A,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.TEXT);k.node.appendChild(L.node)}}else{L=q.group();p(L,A,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.TEXT);k.node.appendChild(L.node)}F=q.text(G[0],G[1],M);F.attr(D);O=F.getBBox();B=B?(B>O.width?B:O.width):O.width;N=N?(N>O.height?N:O.height):O.height;C=OG.Util.round(G[0]-B/2);I=OG.Util.round(G[1]-N/2);J=new OG.Rectangle([C,I],B,N);J.style.map=D;switch(D["text-anchor"]){case"start":K=J.getBoundary().getLeftCenter().x;break;case"end":K=J.getBoundary().getRightCenter().x;break;case"middle":K=J.getBoundary().getCentroid().x;break;default:K=J.getBoundary().getCentroid().x;break}switch(D["vertical-align"]){case"top":H=OG.Util.round(J.getBoundary().getUpperCenter().y+O.height/2);break;case"bottom":H=OG.Util.round(J.getBoundary().getLowerCenter().y-O.height/2);break;case"middle":H=J.getBoundary().getCentroid().y;break;default:H=J.getBoundary().getCentroid().y;break}F.attr({x:K,y:H});F.attr({stroke:"none",fill:D["font-color"]||OG.Constants.DEFAULT_STYLE.LABEL["font-color"],"font-size":D["font-size"]||OG.Constants.DEFAULT_STYLE.LABEL["font-size"]});if(E){F.rotate(E)}p(F);L.node.appendChild(F.node);L.node.text=M;L.node.angle=E;L.node.geom=J;L.attr(OG.Constants.DEFAULT_STYLE.SHAPE);if(L.node.shape){L.node.shape.text=M;L.node.shape.angle=E;L.node.shape.geom=J;if(L.node.text){if(OG.Util.isIE7()){L.node.removeAttribute("text")}else{delete L.node.text}}if(L.node.angle){if(OG.Util.isIE7()){L.node.removeAttribute("angle")}else{delete L.node.angle}}if(L.node.geom){if(OG.Util.isIE7()){L.node.removeAttribute("geom")}else{delete L.node.geom}}}return L.node};this.drawHtml=function(F,E,L,x,y){var z=L?L[0]:null,J=L?L[1]:null,C=L?L[2]||0:0,I,D,B={},K,H,A,G;OG.Util.apply(B,(x instanceof OG.geometry.Style)?x.map:x||{},OG.Constants.DEFAULT_STYLE.HTML);if(y===0||y){I=w(y);if(I){h(I)}else{I=q.group();p(I,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.HTML);k.node.appendChild(I.node)}}else{I=q.group();p(I,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.HTML);k.node.appendChild(I.node)}D=q.foreignObject(E,F[0],F[1],z,J);D.attr(B);K=D.getBBox();z=z||K.width;J=J||K.height;A=OG.Util.round(F[0]-z/2);G=OG.Util.round(F[1]-J/2);D.attr({x:A,y:G});H=new OG.Rectangle([A,G],z,J);if(C){D.rotate(C)}H.style.map=B;p(D);I.node.appendChild(D.node);I.node.html=E;I.node.angle=C;I.node.geom=H;I.attr(OG.Constants.DEFAULT_STYLE.SHAPE);if(I.node.shape){I.node.shape.html=E;I.node.shape.angle=C;I.node.shape.geom=H;if(I.node.html){if(OG.Util.isIE7()){I.node.removeAttribute("html")}else{delete I.node.html}}if(I.node.angle){if(OG.Util.isIE7()){I.node.removeAttribute("angle")}else{delete I.node.angle}}if(I.node.geom){if(OG.Util.isIE7()){I.node.removeAttribute("geom")}else{delete I.node.geom}}}return I.node};this.drawImage=function(E,K,L,x,y){var z=L?L[0]:null,I=L?L[1]:null,C=L?L[2]||0:0,H,D,B={},J,G,A,F;OG.Util.apply(B,(x instanceof OG.geometry.Style)?x.map:x||{},OG.Constants.DEFAULT_STYLE.IMAGE);if(y===0||y){H=w(y);if(H){h(H)}else{H=q.group();p(H,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.IMAGE);k.node.appendChild(H.node)}}else{H=q.group();p(H,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.IMAGE);k.node.appendChild(H.node)}D=q.image(K,E[0],E[1],z,I);D.attr(B);J=D.getBBox();z=z||J.width;I=I||J.height;A=OG.Util.round(E[0]-z/2);F=OG.Util.round(E[1]-I/2);D.attr({x:A,y:F});G=new OG.Rectangle([A,F],z,I);if(C){D.rotate(C)}G.style.map=B;p(D);H.node.appendChild(D.node);H.node.image=K;H.node.angle=C;H.node.geom=G;H.attr(OG.Constants.DEFAULT_STYLE.SHAPE);if(H.node.shape){H.node.shape.image=K;H.node.shape.angle=C;H.node.shape.geom=G;if(H.node.image){if(OG.Util.isIE7()){H.node.removeAttribute("image")}else{delete H.node.image}}if(H.node.angle){if(OG.Util.isIE7()){H.node.removeAttribute("angle")}else{delete H.node.angle}}if(H.node.geom){if(OG.Util.isIE7()){H.node.removeAttribute("geom")}else{delete H.node.geom}}}return H.node};this.drawEdge=function(K,x,y,B){var I,A={},C=K.getVertices(),F=C[0],E=C[C.length-1],H=[],z,D,J=function(N,M,L){if(L){return[[N[0],N[1]],[M[0],N[1]],[M[0],M[1]]]}else{return[[N[0],N[1]],[N[0],M[1]],[M[0],M[1]]]}},G=function(N,M,L){if(L){return[[N[0],N[1]],[OG.Util.round((N[0]+M[0])/2),N[1]],[OG.Util.round((N[0]+M[0])/2),M[1]],[M[0],M[1]]]}else{return[[N[0],N[1]],[N[0],OG.Util.round((N[1]+M[1])/2)],[M[0],OG.Util.round((N[1]+M[1])/2)],[M[0],M[1]]]}};OG.Util.apply(A,(x instanceof OG.geometry.Style)?x.map:x||{},OG.Util.apply({},K.style.map,OG.Constants.DEFAULT_STYLE.EDGE));if(y===0||y){I=w(y);if(I){h(I)}else{I=q.group();p(I,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.EDGE);k.node.appendChild(I.node)}}else{I=q.group();p(I,y,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.EDGE);k.node.appendChild(I.node)}if(B){H=[[F.x,F.y-OG.Constants.GUIDE_RECT_SIZE/2],[F.x+OG.Constants.GUIDE_RECT_SIZE*2,F.y-OG.Constants.GUIDE_RECT_SIZE],[F.x+OG.Constants.GUIDE_RECT_SIZE*2,F.y+OG.Constants.GUIDE_RECT_SIZE],[F.x,F.y+OG.Constants.GUIDE_RECT_SIZE/2]]}else{if(K instanceof OG.geometry.Line){switch(A["edge-type"].toLowerCase()){case OG.Constants.EDGE_TYPE.STRAIGHT:H=[F,E];break;case OG.Constants.EDGE_TYPE.PLAIN:D=A["edge-direction"].toLowerCase().split(" ");if(D[0]==="c"||D[1]==="c"){D=s(D[0],D[1],[F.x,F.y],[E.x,E.y]).split(" ")}if(D[0]==="e"){switch(D[1]){case"e":if(F.x<=E.x){H=J([F.x,F.y],[E.x+OG.Constants.EDGE_PADDING,E.y],true);H.push([E.x,E.y])}else{H=[[F.x,F.y]];H=H.concat(J([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}break;case"w":if(F.x<=E.x){H=G([F.x,F.y],[E.x,E.y],true)}else{H=[[F.x,F.y]];H=H.concat(G([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x-OG.Constants.EDGE_PADDING,E.y],false));H.push([E.x,E.y])}break;case"s":if(F.x<=E.x&&F.y<=E.y){H=G([F.x,F.y],[E.x,E.y+OG.Constants.EDGE_PADDING],true);H.push([E.x,E.y])}else{if(F.x<=E.x&&F.y>E.y){H=J([F.x,F.y],[E.x,E.y],true)}else{if(F.x>E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(J([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y+OG.Constants.EDGE_PADDING],false));H.push([E.x,E.y])}else{if(F.x>E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(G([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}}}}break;case"n":if(F.x<=E.x&&F.y<=E.y){H=J([F.x,F.y],[E.x,E.y],true)}else{if(F.x<=E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(J([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y-OG.Constants.EDGE_PADDING],false));H.push([E.x,E.y])}else{if(F.x>E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(G([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}else{if(F.x>E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(J([F.x+OG.Constants.EDGE_PADDING,F.y],[E.x,E.y-OG.Constants.EDGE_PADDING],false));H.push([E.x,E.y])}}}}break}}else{if(D[0]==="w"){switch(D[1]){case"e":if(F.x<=E.x){H=[[F.x,F.y]];H=H.concat(G([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x+OG.Constants.EDGE_PADDING,E.y],false));H.push([E.x,E.y])}else{H=G([F.x,F.y],[E.x,E.y],true)}break;case"w":if(F.x<=E.x){H=[[F.x,F.y]];H=H.concat(J([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}else{H=J([F.x,F.y],[E.x-OG.Constants.EDGE_PADDING,E.y],true);H.push([E.x,E.y])}break;case"s":if(F.x<=E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(J([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x,E.y+OG.Constants.EDGE_PADDING],false));H.push([E.x,E.y])}else{if(F.x<=E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(G([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}else{if(F.x>E.x&&F.y<=E.y){H=G([F.x,F.y],[E.x,E.y+OG.Constants.EDGE_PADDING],true);H.push([E.x,E.y])}else{if(F.x>E.x&&F.y>E.y){H=J([F.x,F.y],[E.x,E.y],true)}}}}break;case"n":if(F.x<=E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(G([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x,E.y],false))}else{if(F.x<=E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(J([F.x-OG.Constants.EDGE_PADDING,F.y],[E.x,E.y-OG.Constants.EDGE_PADDING],false));H.push([E.x,E.y])}else{if(F.x>E.x&&F.y<=E.y){H=H.concat(J([F.x,F.y],[E.x,E.y],true))}else{if(F.x>E.x&&F.y>E.y){H=G([F.x,F.y],[E.x,E.y-OG.Constants.EDGE_PADDING],true);H.push([E.x,E.y])}}}}break}}else{if(D[0]==="s"){switch(D[1]){case"e":if(F.x<=E.x&&F.y<=E.y){H=G([F.x,F.y],[E.x+OG.Constants.EDGE_PADDING,E.y],false);H.push([E.x,E.y])}else{if(F.x<=E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(J([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x+OG.Constants.EDGE_PADDING,E.y],true));H.push([E.x,E.y])}else{if(F.x>E.x&&F.y<=E.y){H=J([F.x,F.y],[E.x,E.y],false)}else{if(F.x>E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(G([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x,E.y],true))}}}}break;case"w":if(F.x<=E.x&&F.y<=E.y){H=J([F.x,F.y],[E.x,E.y],false)}else{if(F.x<=E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(G([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x,E.y],true))}else{if(F.x>E.x&&F.y<=E.y){H=G([F.x,F.y],[E.x-OG.Constants.EDGE_PADDING,E.y],false);H.push([E.x,E.y])}else{if(F.x>E.x&&F.y>E.y){H=[[F.x,F.y]];H=H.concat(J([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x-OG.Constants.EDGE_PADDING,E.y],true));H.push([E.x,E.y])}}}}break;case"s":if(F.y<=E.y){H=J([F.x,F.y],[E.x,E.y+OG.Constants.EDGE_PADDING],false);H.push([E.x,E.y])}else{H=[[F.x,F.y]];H=H.concat(J([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x,E.y],true))}break;case"n":if(F.y<=E.y){H=G([F.x,F.y],[E.x,E.y],false)}else{H=[[F.x,F.y]];H=H.concat(G([F.x,F.y+OG.Constants.EDGE_PADDING],[E.x,E.y-OG.Constants.EDGE_PADDING],true));H.push([E.x,E.y])}break}}else{if(D[0]==="n"){switch(D[1]){case"e":if(F.x<=E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(J([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x+OG.Constants.EDGE_PADDING,E.y],true));H.push([E.x,E.y])}else{if(F.x<=E.x&&F.y>E.y){H=G([F.x,F.y],[E.x+OG.Constants.EDGE_PADDING,E.y],false);H.push([E.x,E.y])}else{if(F.x>E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(G([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x,E.y],true))}else{if(F.x>E.x&&F.y>E.y){H=J([F.x,F.y],[E.x,E.y],false)}}}}break;case"w":if(F.x<=E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(G([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x,E.y],true))}else{if(F.x<=E.x&&F.y>E.y){H=J([F.x,F.y],[E.x,E.y],false)}else{if(F.x>E.x&&F.y<=E.y){H=[[F.x,F.y]];H=H.concat(J([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x-OG.Constants.EDGE_PADDING,E.y],true));H.push([E.x,E.y])}else{if(F.x>E.x&&F.y>E.y){H=G([F.x,F.y],[E.x-OG.Constants.EDGE_PADDING,E.y],false);H.push([E.x,E.y])}}}}break;case"s":if(F.y<=E.y){H=[[F.x,F.y]];H=H.concat(G([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x,E.y+OG.Constants.EDGE_PADDING],true));H.push([E.x,E.y])}else{H=G([F.x,F.y],[E.x,E.y],false)}break;case"n":if(F.y<=E.y){H=[[F.x,F.y]];H=H.concat(J([F.x,F.y-OG.Constants.EDGE_PADDING],[E.x,E.y],true))}else{H=J([F.x,F.y],[E.x,E.y-OG.Constants.EDGE_PADDING],false);H.push([E.x,E.y])}break}}}}}break;case OG.Constants.EDGE_TYPE.BEZIER:break}}else{if(K instanceof OG.geometry.Curve){H=K.getControlPoints()}else{H=C}}}if(B){z=new OG.Curve(H)}else{if(K instanceof OG.geometry.Curve){z=new OG.Curve(H)}else{z=new OG.PolyLine(H)}}e(I.node,z,OG.Constants.DEFAULT_STYLE.EDGE_HIDDEN);e(I.node,z,A);I.node.geom=z;I.attr(OG.Constants.DEFAULT_STYLE.SHAPE);if(I.node.shape){I.node.shape.geom=z;if(I.node.geom){if(OG.Util.isIE7()){I.node.removeAttribute("geom")}else{delete I.node.geom}}}return I.node};this.drawGroup=function(E,y,z){var F,H,B={},G,C,A,x,D={};OG.Util.apply(B,(y instanceof OG.geometry.Style)?y.map:y||{});if(z===0||z){F=w(z);if(F){G=F.node.childNodes;for(C=G.length-1;C>=0;C--){if($(G[C]).attr("_type")!==OG.Constants.NODE_TYPE.SHAPE){v(w(G[C].id))}}}else{F=q.group();p(F,z,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.GROUP);k.node.appendChild(F.node)}}else{F=q.group();p(F,z,OG.Constants.NODE_TYPE.SHAPE,OG.Constants.SHAPE_TYPE.GROUP);k.node.appendChild(F.node)}H=e(F.node,E,B);F.node.geom=E;F.attr(OG.Constants.DEFAULT_STYLE.SHAPE);OG.Util.apply(D,E.style.map,B);if(D["label-direction"]&&D["vertical-align"]==="top"){A=E.getBoundary();if(D["label-direction"]==="vertical"){x=new OG.geometry.Line([A.getUpperLeft().x+20,A.getUpperLeft().y],[A.getLowerLeft().x+20,A.getLowerLeft().y])}else{x=new OG.geometry.Line([A.getUpperLeft().x,A.getUpperLeft().y+20],[A.getUpperRight().x,A.getUpperRight().y+20])}e(F.node,x,B)}if(H.id!==F.node.firstChild.id){F.node.insertBefore(H,F.node.firstChild)}if(F.node.shape){if(!F.node.shape.isCollapsed||F.node.shape.isCollapsed===false){F.node.shape.geom=E}if(F.node.geom){if(OG.Util.isIE7()){F.node.removeAttribute("geom")}else{delete F.node.geom}}}return F.node};this.drawLabel=function(G,I,y){var D=w(OG.Util.isElement(G)?G.id:G),B,E,F,z={},C,J,A,H=function(O){var M,K,P=0,N,L;M=O.shape.geom.getVertices();K=O.shape.geom.getLength();for(N=0;N<M.length-1;N++){P+=M[N].distance(M[N+1]);if(P>K/2){L=O.shape.geom.intersectCircleToLine(M[N+1],P-K/2,M[N+1],M[N]);break}}return L[0]},x;OG.Util.apply(z,(y instanceof OG.geometry.Style)?y.map:y||{});if(D&&D.node.shape){B=D.node;F=B.shape.geom.getBoundary();A=B.shape.label;OG.Util.apply(B.shape.geom.style.map,z);B.shape.label=I===undefined?B.shape.label:I;if(B.shape.label!==undefined){if(B.shape instanceof OG.shape.EdgeShape){x=H(B);C=[x.x,x.y];J=[0,0]}else{switch(B.shape.geom.style.get("label-position")){case"left":C=[F.getCentroid().x-F.getWidth(),F.getCentroid().y];break;case"right":C=[F.getCentroid().x+F.getWidth(),F.getCentroid().y];break;case"top":C=[F.getCentroid().x,F.getCentroid().y-F.getHeight()];break;case"bottom":C=[F.getCentroid().x,F.getCentroid().y+F.getHeight()];break;default:C=[F.getCentroid().x,F.getCentroid().y];break}J=[F.getWidth(),F.getHeight()]}E=l(C,B.shape.label,J,B.shape.geom.style,B.id+OG.Constants.LABEL_SUFFIX,B.shape instanceof OG.shape.EdgeShape);B.appendChild(E);$(q.canvas).trigger("drawLabel",[B,I]);if(I!==A){$(q.canvas).trigger("labelChanged",[B,I,A])}}}return E};this.drawEdgeLabel=function(E,G,D){var A=w(OG.Util.isElement(E)?E.id:E),y,B,C,z,x,F;if(A&&A.node.shape){y=A.node;if(y.shape instanceof OG.shape.EdgeShape){B=y.shape.geom.getVertices();if(D==="FROM"){z=[B[0].x,B[0].y+OG.Constants.FROMTO_LABEL_OFFSET_TOP];y.shape.fromLabel=G||y.shape.fromLabel;x=y.shape.fromLabel;F=OG.Constants.FROM_LABEL_SUFFIX}else{z=[B[B.length-1].x,B[B.length-1].y+OG.Constants.FROMTO_LABEL_OFFSET_TOP];y.shape.toLabel=G||y.shape.toLabel;x=y.shape.toLabel;F=OG.Constants.TO_LABEL_SUFFIX}if(x){C=l(z,x,[0,0],y.shape.geom.style,y.id+F,false);y.appendChild(C)}}}return C};this.redrawShape=function(B,E){var C=this,D,y,z,F,x,A;A=function(O,J){var P,N,L,H=J.childNodes,G,M,K,I;for(M=H.length-1;M>=0;M--){if($(H[M]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){A(O,H[M]);I=false;P=$(H[M]).attr("_fromedge");if(P){P=P.split(",");for(K=0;K<P.length;K++){N=C.getElementById(P[K]);if(N){G=i($(N).attr("_from"));if($(G).parents("#"+O.id).length===0){I=true}}}}P=$(H[M]).attr("_toedge");if(P){P=P.split(",");for(K=0;K<P.length;K++){L=C.getElementById(P[K]);if(L){G=i($(L).attr("_to"));if($(G).parents("#"+O.id).length===0){I=true}}}}if(I===true){C.redrawConnectedEdge(H[M])}}}};if(B&&B.shape.geom){switch($(B).attr("_shape")){case OG.Constants.SHAPE_TYPE.GEOM:B=this.drawGeom(B.shape.geom,{},B.id);this.redrawConnectedEdge(B,E);this.drawLabel(B);break;case OG.Constants.SHAPE_TYPE.TEXT:D=B.shape.geom.getBoundary();y=D.getCentroid();z=D.getWidth();F=D.getHeight();B=this.drawText([y.x,y.y],B.shape.text,[z,F,B.shape.angle],B.shape.geom.style,B.id);this.redrawConnectedEdge(B,E);break;case OG.Constants.SHAPE_TYPE.IMAGE:D=B.shape.geom.getBoundary();y=D.getCentroid();z=D.getWidth();F=D.getHeight();B=this.drawImage([y.x,y.y],B.shape.image,[z,F,B.shape.angle],B.shape.geom.style,B.id);this.redrawConnectedEdge(B,E);this.drawLabel(B);break;case OG.Constants.SHAPE_TYPE.HTML:D=B.shape.geom.getBoundary();y=D.getCentroid();z=D.getWidth();F=D.getHeight();B=this.drawHtml([y.x,y.y],B.shape.html,[z,F,B.shape.angle],B.shape.geom.style,B.id);this.redrawConnectedEdge(B,E);this.drawLabel(B);break;case OG.Constants.SHAPE_TYPE.EDGE:B=this.drawEdge(B.shape.geom,B.shape.geom.style,B.id);this.drawLabel(B);this.drawEdgeLabel(B,null,"FROM");this.drawEdgeLabel(B,null,"TO");break;case OG.Constants.SHAPE_TYPE.GROUP:if(B.shape.isCollapsed){D=B.shape.geom.getBoundary();x=D.getUpperLeft();B=this.drawGroup(new OG.geometry.Rectangle(x,OG.Constants.COLLAPSE_SIZE*3,OG.Constants.COLLAPSE_SIZE*2),B.shape.geom.style,B.id);A(B,B)}else{B=this.drawGroup(B.shape.geom,B.shape.geom.style,B.id);this.redrawConnectedEdge(B,E);this.drawLabel(B)}break}}$(q.canvas).trigger("redrawShape",[B]);return B};this.redrawEdge=function(y){var C,T,O,W,K,E,J,L,A,D,U,z,P,Q,F,H,G,R,I,N,B,V,x,M,S;C=OG.Util.isElement(y)?y:this.getElementById(y);T=$(C).attr("_from");O=$(C).attr("_to");if(T){W=i(T);E=parseInt(T.substring(T.lastIndexOf("_")+1),10);L=W.shape.createTerminal()[E];U=L.direction.toLowerCase();P=L.position}else{D=C.shape.geom.getVertices();U="c";P=D[0]}if(O){K=i(O);J=parseInt(O.substring(O.lastIndexOf("_")+1),10);A=K.shape.createTerminal()[J];z=A.direction.toLowerCase();Q=A.position}else{D=C.shape.geom.getVertices();z="c";Q=D[D.length-1]}F=P;H=Q;G=U;R=z;if(W&&U==="c"){I=this.intersectionEdge(C.shape.geom.style.get("edge-type"),W,[F.x,F.y],[H.x,H.y],true);P=I.position;U=I.direction}if(K&&z==="c"){I=this.intersectionEdge(C.shape.geom.style.get("edge-type"),K,[F.x,F.y],[H.x,H.y],false);Q=I.position;z=I.direction}N=W&&K&&W.id===K.id;if(N){P=Q=W.shape.geom.getBoundary().getRightCenter()}else{if(W){B=$(W).parents("[_collapsed=true]");if(B.length!==0){V=B[B.length-1].shape.geom.getBoundary();x=V.getUpperLeft();M=new OG.geometry.Rectangle(x,OG.Constants.COLLAPSE_SIZE*3,OG.Constants.COLLAPSE_SIZE*2);switch(U.toUpperCase()){case OG.Constants.TERMINAL_TYPE.E:S=M.getBoundary().getRightCenter();break;case OG.Constants.TERMINAL_TYPE.W:S=M.getBoundary().getLeftCenter();break;case OG.Constants.TERMINAL_TYPE.S:S=M.getBoundary().getLowerCenter();break;case OG.Constants.TERMINAL_TYPE.N:S=M.getBoundary().getUpperCenter();break}if(S){P=[S.x,S.y]}}}if(K){B=$(K).parents("[_collapsed=true]");if(B.length!==0){V=B[B.length-1].shape.geom.getBoundary();x=V.getUpperLeft();M=new OG.geometry.Rectangle(x,OG.Constants.COLLAPSE_SIZE*3,OG.Constants.COLLAPSE_SIZE*2);switch(z.toUpperCase()){case OG.Constants.TERMINAL_TYPE.E:S=M.getBoundary().getRightCenter();break;case OG.Constants.TERMINAL_TYPE.W:S=M.getBoundary().getLeftCenter();break;case OG.Constants.TERMINAL_TYPE.S:S=M.getBoundary().getLowerCenter();break;case OG.Constants.TERMINAL_TYPE.N:S=M.getBoundary().getUpperCenter();break}if(S){Q=[S.x,S.y]}}}}C=this.drawEdge(new OG.Line(P,Q),OG.Util.apply(C.shape.geom.style.map,{"edge-direction":U+" "+z}),C.id,N);this.drawLabel(C);this.drawEdgeLabel(C,null,"FROM");this.drawEdgeLabel(C,null,"TO");OG.Util.apply(C.shape.geom.style.map,{"edge-direction":G+" "+R})};this.redrawConnectedEdge=function(x,z){var A,y=this;A=$(x).attr("_fromedge");if(A){$.each(A.split(","),function(B,C){if(!z||z.toString().indexOf(C)<0){y.redrawEdge(C)}})}A=$(x).attr("_toedge");if(A){$.each(A.split(","),function(B,C){if(!z||z.toString().indexOf(C)<0){y.redrawEdge(C)}})}this.removeAllTerminal()};this.connect=function(L,x,B,O,G){var F={},Q,I,H,K,M,C,D,P,y,E,N,J,A,z=function(T,S,U){var V=$(T).attr(S),W=V?V.split(","):[],R=[];$.each(W,function(X,Y){if(Y!==U){R.push(Y)}});R.push(U);$(T).attr(S,R.toString());return T};OG.Util.apply(F,(O instanceof OG.geometry.Style)?O.map:O||{},OG.Constants.DEFAULT_STYLE.EDGE);if(OG.Util.isElement(L)){Q=i(L);K=[L.terminal.position.x,L.terminal.position.y];P=L.terminal.direction.toLowerCase()}else{K=L;P="c"}if(OG.Util.isElement(x)){I=i(x);M=[x.terminal.position.x,x.terminal.position.y];y=x.terminal.direction.toLowerCase()}else{M=x;y="c"}if(Q&&I){A=jQuery.Event("beforeConnectShape",{edge:B,fromShape:Q,toShape:I});$(q.canvas).trigger(A);if(A.isPropagationStopped()){this.remove(B);return false}}C=K;D=M;E=P;N=y;if(Q&&P==="c"){H=this.intersectionEdge(F["edge-type"],Q,C,D,true);K=H.position;P=H.direction}if(I&&y==="c"){H=this.intersectionEdge(F["edge-type"],I,C,D,false);M=H.position;y=H.direction}J=Q&&I&&Q.id===I.id;if(J){K=M=Q.shape.geom.getBoundary().getRightCenter()}B=this.drawEdge(new OG.Line(K,M),OG.Util.apply(F,{"edge-direction":P+" "+y}),B?B.id:null,J);this.drawLabel(B,G);this.drawEdgeLabel(B,null,"FROM");this.drawEdgeLabel(B,null,"TO");OG.Util.apply(B.shape.geom.style.map,{"edge-direction":E+" "+N});B.shapeStyle=B.shape.geom.style.map;this.disconnect(B);if(OG.Util.isElement(L)){$(B).attr("_from",L.id);z(Q,"_toedge",B.id)}if(OG.Util.isElement(x)){$(B).attr("_to",x.id);z(I,"_fromedge",B.id)}this.removeAllTerminal();if(Q&&I){$(q.canvas).trigger("connectShape",[B,Q,I])}return B};this.disconnect=function(C){var F=this,G,D,H,A,y,x,E,B,z=function(K,J,L){var M=$(K).attr(J),N=M?M.split(","):[],I=[];$.each(N,function(O,P){if(P!==L){I.push(P)}});$(K).attr(J,I.toString());return K};if(C){if($(C).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){G=$(C).attr("_from");D=$(C).attr("_to");if(G){H=i(G);z(H,"_toedge",C.id);$(C).removeAttr("_from")}if(D){A=i(D);z(A,"_fromedge",C.id);$(C).removeAttr("_to")}if(H&&A){$(q.canvas).trigger("disconnectShape",[C,H,A])}}else{y=$(C).attr("_fromedge");x=$(C).attr("_toedge");if(y){$.each(y.split(","),function(I,J){E=F.getElementById(J);G=$(E).attr("_from");if(G){H=i(G);z(H,"_toedge",J)}if(H&&C){$(q.canvas).trigger("disconnectShape",[E,H,C])}F.remove(E)})}if(x){$.each(x.split(","),function(I,J){B=F.getElementById(J);D=$(B).attr("_to");if(D){A=i(D);z(A,"_fromedge",J)}if(C&&A){$(q.canvas).trigger("disconnectShape",[B,C,A])}F.remove(B)})}}}};this.drawDropOverGuide=function(B){var y=w(OG.Util.isElement(B)?B.id:B),E=y?y.node.shape.geom:null,D,A,C,x=OG.Constants.GUIDE_RECT_SIZE/2,z=x/2;if(y&&E&&$(B).attr("_shape")!==OG.Constants.SHAPE_TYPE.EDGE&&!w(y.id+OG.Constants.DROP_OVER_BBOX_SUFFIX)){D=E.getBoundary();A=D.getUpperLeft();C=q.rect(A.x-z,A.y-z,D.getWidth()+x,D.getHeight()+x);C.attr(OG.Util.apply({"stroke-width":x},OG.Constants.DEFAULT_STYLE.DROP_OVER_BBOX));p(C,y.id+OG.Constants.DROP_OVER_BBOX_SUFFIX);C.insertAfter(y)}};this.drawGuide=function(z){var P=w(OG.Util.isElement(z)?z.id:z),F=P?P.node.shape.geom:null,y,I,T,H,L,B,D,M,K,S,V,C,Q,J,O,G,x,A,R,U,E=OG.Constants.GUIDE_RECT_SIZE,N=OG.Util.round(E/2);if(P&&F){if($(z).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){return this.drawEdgeGuide(z)}else{y=F.getBoundary();L=y.getUpperLeft();B=y.getUpperRight();D=y.getLowerLeft();M=y.getLowerRight();K=y.getLeftCenter();S=y.getUpperCenter();V=y.getRightCenter();C=y.getLowerCenter();if(w(P.id+OG.Constants.GUIDE_SUFFIX.GUIDE)){v(w(P.id+OG.Constants.GUIDE_SUFFIX.BBOX));H=q.rect(L.x,L.y,y.getWidth(),y.getHeight());H.attr(OG.Constants.DEFAULT_STYLE.GUIDE_BBOX);p(H,P.id+OG.Constants.GUIDE_SUFFIX.BBOX);H.insertBefore(P);Q=w(P.id+OG.Constants.GUIDE_SUFFIX.UL);J=w(P.id+OG.Constants.GUIDE_SUFFIX.UR);O=w(P.id+OG.Constants.GUIDE_SUFFIX.LL);G=w(P.id+OG.Constants.GUIDE_SUFFIX.LR);x=w(P.id+OG.Constants.GUIDE_SUFFIX.LC);A=w(P.id+OG.Constants.GUIDE_SUFFIX.UC);R=w(P.id+OG.Constants.GUIDE_SUFFIX.RC);U=w(P.id+OG.Constants.GUIDE_SUFFIX.LWC);Q.attr({x:L.x-N,y:L.y-N});J.attr({x:B.x-N,y:B.y-N});O.attr({x:D.x-N,y:D.y-N});G.attr({x:M.x-N,y:M.y-N});x.attr({x:K.x-N,y:K.y-N});A.attr({x:S.x-N,y:S.y-N});R.attr({x:V.x-N,y:V.y-N});U.attr({x:C.x-N,y:C.y-N});return null}I=w(P.id+OG.Constants.GUIDE_SUFFIX.GUIDE);if(I){v(I);v(w(P.id+OG.Constants.GUIDE_SUFFIX.BBOX))}I=q.group();H=q.rect(L.x,L.y,y.getWidth(),y.getHeight());Q=q.rect(L.x-N,L.y-N,E,E);J=q.rect(B.x-N,B.y-N,E,E);O=q.rect(D.x-N,D.y-N,E,E);G=q.rect(M.x-N,M.y-N,E,E);x=q.rect(K.x-N,K.y-N,E,E);A=q.rect(S.x-N,S.y-N,E,E);R=q.rect(V.x-N,V.y-N,E,E);U=q.rect(C.x-N,C.y-N,E,E);H.attr(OG.Constants.DEFAULT_STYLE.GUIDE_BBOX);Q.attr(OG.Constants.DEFAULT_STYLE.GUIDE_UL);J.attr(OG.Constants.DEFAULT_STYLE.GUIDE_UR);O.attr(OG.Constants.DEFAULT_STYLE.GUIDE_LL);G.attr(OG.Constants.DEFAULT_STYLE.GUIDE_LR);x.attr(OG.Constants.DEFAULT_STYLE.GUIDE_LC);A.attr(OG.Constants.DEFAULT_STYLE.GUIDE_UC);R.attr(OG.Constants.DEFAULT_STYLE.GUIDE_RC);U.attr(OG.Constants.DEFAULT_STYLE.GUIDE_LWC);I.appendChild(Q);I.appendChild(J);I.appendChild(O);I.appendChild(G);I.appendChild(x);I.appendChild(A);I.appendChild(R);I.appendChild(U);p(I,P.id+OG.Constants.GUIDE_SUFFIX.GUIDE);p(H,P.id+OG.Constants.GUIDE_SUFFIX.BBOX);p(Q,P.id+OG.Constants.GUIDE_SUFFIX.UL);p(J,P.id+OG.Constants.GUIDE_SUFFIX.UR);p(O,P.id+OG.Constants.GUIDE_SUFFIX.LL);p(G,P.id+OG.Constants.GUIDE_SUFFIX.LR);p(x,P.id+OG.Constants.GUIDE_SUFFIX.LC);p(A,P.id+OG.Constants.GUIDE_SUFFIX.UC);p(R,P.id+OG.Constants.GUIDE_SUFFIX.RC);p(U,P.id+OG.Constants.GUIDE_SUFFIX.LWC);T={bBox:H.node,group:I.node,ul:Q.node,ur:J.node,ll:O.node,lr:G.node,lc:x.node,uc:A.node,rc:R.node,lwc:U.node};H.insertBefore(P);I.insertAfter(P);$(P.node).attr("_selected","true");return T}}return null};this.removeGuide=function(z){var y=w(OG.Util.isElement(z)?z.id:z),x=w(y.id+OG.Constants.GUIDE_SUFFIX.GUIDE),A=w(y.id+OG.Constants.GUIDE_SUFFIX.BBOX);y.node.removeAttribute("_selected");v(x);v(A)};this.removeAllGuide=function(){$(this.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(x,y){if(OG.Util.isElement(y)&&y.id){u.removeGuide(y)}})};this.drawEdgeGuide=function(C){var G=w(OG.Util.isElement(C)?C.id:C),K=G?G.node.shape.geom:null,H,F,L,y,M,A,z,E,x,I=[],J=OG.Constants.GUIDE_RECT_SIZE,D=OG.Util.round(J/2),B;if(G&&K){H=K.getVertices();F=$(C).attr("_from")&&$(C).attr("_to")&&$(C).attr("_from")===$(C).attr("_to");if(w(G.id+OG.Constants.GUIDE_SUFFIX.GUIDE)){v(w(G.id+OG.Constants.GUIDE_SUFFIX.BBOX));M="";for(B=0;B<H.length;B++){if(B===0){M="M"+H[B].x+" "+H[B].y}else{M+="L"+H[B].x+" "+H[B].y}}A=q.path(M);A.attr(OG.Constants.DEFAULT_STYLE.GUIDE_BBOX);p(A,G.id+OG.Constants.GUIDE_SUFFIX.BBOX);A.insertBefore(G);z=w(G.id+OG.Constants.GUIDE_SUFFIX.FROM);z.attr({x:H[0].x-D,y:H[0].y-D});E=w(G.id+OG.Constants.GUIDE_SUFFIX.TO);E.attr({x:H[H.length-1].x-D,y:H[H.length-1].y-D});if(!F){for(B=1;B<H.length-2;B++){if(H[B].x===H[B+1].x){x=w(G.id+OG.Constants.GUIDE_SUFFIX.CTL_H+B);if(x){x.attr({x:H[B].x-D,y:OG.Util.round((H[B].y+H[B+1].y)/2)-D})}}else{x=w(G.id+OG.Constants.GUIDE_SUFFIX.CTL_V+B);if(x){x.attr({x:OG.Util.round((H[B].x+H[B+1].x)/2)-D,y:H[B].y-D})}}}}return null}L=w(G.id+OG.Constants.GUIDE_SUFFIX.GUIDE);if(L){v(L);v(w(G.id+OG.Constants.GUIDE_SUFFIX.BBOX))}L=q.group();M="";for(B=0;B<H.length;B++){if(B===0){M="M"+H[B].x+" "+H[B].y}else{M+="L"+H[B].x+" "+H[B].y}}A=q.path(M);A.attr(OG.Constants.DEFAULT_STYLE.GUIDE_BBOX);z=q.rect(H[0].x-D,H[0].y-D,J,J);z.attr(OG.Constants.DEFAULT_STYLE.GUIDE_FROM);L.appendChild(z);p(z,G.id+OG.Constants.GUIDE_SUFFIX.FROM);E=q.rect(H[H.length-1].x-D,H[H.length-1].y-D,J,J);E.attr(OG.Constants.DEFAULT_STYLE.GUIDE_TO);L.appendChild(E);p(E,G.id+OG.Constants.GUIDE_SUFFIX.TO);if(!F){for(B=1;B<H.length-2;B++){if(H[B].x===H[B+1].x){x=q.rect(H[B].x-D,OG.Util.round((H[B].y+H[B+1].y)/2)-D,J,J);x.attr(OG.Constants.DEFAULT_STYLE.GUIDE_CTL_H);p(x,G.id+OG.Constants.GUIDE_SUFFIX.CTL_H+B)}else{x=q.rect(OG.Util.round((H[B].x+H[B+1].x)/2)-D,H[B].y-D,J,J);x.attr(OG.Constants.DEFAULT_STYLE.GUIDE_CTL_V);p(x,G.id+OG.Constants.GUIDE_SUFFIX.CTL_V+B)}L.appendChild(x);I.push(x.node)}}p(A,G.id+OG.Constants.GUIDE_SUFFIX.BBOX);p(L,G.id+OG.Constants.GUIDE_SUFFIX.GUIDE);y={bBox:A.node,group:L.node,from:z.node,to:E.node,controls:I};A.insertBefore(G);L.insertAfter(G);$(G.node).attr("_selected","true");return y}return null};this.drawRubberBand=function(C,H,z){var F=C?C[0]:0,D=C?C[1]:0,A=H?H[0]:0,G=H?H[1]:0,E=w(OG.Constants.RUBBER_BAND_ID),B={};if(E){E.attr({x:F,y:D,width:Math.abs(A),height:Math.abs(G)});return E}OG.Util.apply(B,(z instanceof OG.geometry.Style)?z.map:z||{},OG.Constants.DEFAULT_STYLE.RUBBER_BAND);E=q.rect(F,D,A,G).attr(B);p(E,OG.Constants.RUBBER_BAND_ID);f.node.appendChild(E.node);return E.node};this.removeRubberBand=function(x){this.setAttr(OG.Constants.RUBBER_BAND_ID,{x:0,y:0,width:0,height:0});$(x).removeData("dragBox_first");$(x).removeData("rubberBand")};this.drawTerminal=function(z,A){var B=w(OG.Util.isElement(z)?z.id:z),J=B?B.node.shape.createTerminal():null,D=B?B.node.shape.geom.getBoundary():null,I,H,F,G,E,K=OG.Constants.TERMINAL_SIZE,C=K*2;if(B&&J&&J.length>0){I=w(B.id+OG.Constants.TERMINAL_SUFFIX.GROUP);F=w(B.id+OG.Constants.TERMINAL_SUFFIX.BOX);if(I||F){return{bBox:F.node,terminal:I.node}}I=q.group();F=q.rect(D.getUpperLeft().x-C,D.getUpperLeft().y-C,D.getWidth()+C*2,D.getHeight()+C*2);F.attr(OG.Constants.DEFAULT_STYLE.TERMINAL_BBOX);p(F,B.id+OG.Constants.TERMINAL_SUFFIX.BOX);$.each(J,function(x,y){if(!A||y.inout.indexOf(A)>=0){G=y.position.x;E=y.position.y;H=q.circle(G,E,K);H.attr(OG.Constants.DEFAULT_STYLE.TERMINAL);H.node.terminal=y;I.appendChild(H);p(H,B.id+OG.Constants.TERMINAL_SUFFIX.GROUP+"_"+y.direction+"_"+y.inout+"_"+x)}});p(I,B.id+OG.Constants.TERMINAL_SUFFIX.GROUP);F.insertBefore(B);I.insertAfter(B);return{bBox:F.node,terminal:I.node}}return null};this.removeTerminal=function(y){var x=w(OG.Util.isElement(y)?y.id:y),A,z;if(x){A=w(x.id+OG.Constants.TERMINAL_SUFFIX.GROUP);if(A){v(A)}z=w(x.id+OG.Constants.TERMINAL_SUFFIX.BOX);if(z){v(z)}}};this.removeAllTerminal=function(){var x=this;$.each(t.keys(),function(y,z){x.removeTerminal(z)})};this.drawCollapseGuide=function(y){var B=w(OG.Util.isElement(y)?y.id:y),D=B?B.node.shape.geom:null,C,F,x,A,E=OG.Constants.COLLAPSE_SIZE,z=E/2;if(B&&D&&$(y).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP){x=w(B.id+OG.Constants.COLLAPSE_BBOX_SUFFIX);if(x){v(x)}A=w(B.id+OG.Constants.COLLAPSE_SUFFIX);if(A){v(A)}C=D.getBoundary();F=C.getUpperLeft();x=q.rect(C.getUpperLeft().x-E,C.getUpperLeft().y-E,C.getWidth()+E*2,C.getHeight()+E*2);x.attr(OG.Constants.DEFAULT_STYLE.COLLAPSE_BBOX);p(x,B.id+OG.Constants.COLLAPSE_BBOX_SUFFIX);if(B.node.shape.isCollapsed===true){A=q.path("M"+(F.x+z)+" "+(F.y+z)+"h"+E+"v"+E+"h"+(-1*E)+"v"+(-1*E)+"m1 "+z+"h"+(E-2)+"M"+(F.x+z)+" "+(F.y+z)+"m"+z+" 1v"+(E-2))}else{A=q.path("M"+(F.x+z)+" "+(F.y+z)+"h"+E+"v"+E+"h"+(-1*E)+"v"+(-1*E)+"m1 "+z+"h"+(E-2))}A.attr(OG.Constants.DEFAULT_STYLE.COLLAPSE);p(A,B.id+OG.Constants.COLLAPSE_SUFFIX);x.insertBefore(B);A.insertAfter(B);return{bBox:x.node,collapse:A.node}}return null};this.removeCollapseGuide=function(z){var x=w(OG.Util.isElement(z)?z.id:z),A,y;if(x){A=w(x.id+OG.Constants.COLLAPSE_BBOX_SUFFIX);if(A){v(A)}y=w(x.id+OG.Constants.COLLAPSE_SUFFIX);if(y){v(y)}}};this.group=function(x){var z,y=[],D,E,B,C,F,A;if(x&&x.length>1){for(A=0;A<x.length;A++){y.push(x[A].shape.geom)}D=new OG.GeometryCollection(y);E=D.getBoundary();B=[E.getCentroid().x,E.getCentroid().y];C=new OG.GroupShape();F=[E.getWidth(),E.getHeight()];z=this.drawShape(B,C,F);for(A=0;A<x.length;A++){z.appendChild(x[A])}$(q.canvas).trigger("group",[z])}return z};this.ungroup=function(A){var B=[],z,y,x;if(A&&A.length>0){for(y=0;y<A.length;y++){z=$(A[y]).children("[_type='"+OG.Constants.NODE_TYPE.SHAPE+"']");for(x=0;x<z.length;x++){A[y].parentNode.appendChild(z[x]);B.push(z[x])}this.removeShape(A[y])}$(q.canvas).trigger("ungroup",[B])}return B};this.addToGroup=function(y,z){var x;for(x=0;x<z.length;x++){y.appendChild(z[x])}};this.collapse=function(z){var A=this,B,y,x;x=function(K,F){var L,J,H,D=F.childNodes,C,I,G,E;for(I=D.length-1;I>=0;I--){if($(D[I]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){x(K,D[I]);E=false;L=$(D[I]).attr("_fromedge");if(L){L=L.split(",");for(G=0;G<L.length;G++){J=A.getElementById(L[G]);if(J){C=i($(J).attr("_from"));if($(C).parents("#"+K.id).length!==0){A.hide(J)}else{E=true}}}}L=$(D[I]).attr("_toedge");if(L){L=L.split(",");for(G=0;G<L.length;G++){H=A.getElementById(L[G]);if(H){C=i($(H).attr("_to"));if($(C).parents("#"+K.id).length!==0){A.hide(H)}else{E=true}}}}if(E===true){A.redrawConnectedEdge(D[I])}}}};if(z.shape){B=z.childNodes;for(y=B.length-1;y>=0;y--){if($(B[y]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){this.hide(B[y])}}z.shape.isCollapsed=true;$(z).attr("_collapsed",true);x(z,z);this.redrawShape(z);$(q.canvas).trigger("collapsed",[z])}};this.expand=function(z){var A=this,B,y,x;x=function(K,F){var L,J,H,D=F.childNodes,C,I,G,E;for(I=D.length-1;I>=0;I--){if($(D[I]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){x(K,D[I]);E=false;L=$(D[I]).attr("_fromedge");if(L){L=L.split(",");for(G=0;G<L.length;G++){J=A.getElementById(L[G]);if(J){C=i($(J).attr("_from"));if($(C).parents("#"+K.id).length!==0){A.show(J)}else{E=true}}}}L=$(D[I]).attr("_toedge");if(L){L=L.split(",");for(G=0;G<L.length;G++){H=A.getElementById(L[G]);if(H){C=i($(H).attr("_to"));if($(C).parents("#"+K.id).length!==0){A.show(H)}else{E=true}}}}if(E===true){A.redrawConnectedEdge(D[I])}}}};if(z.shape){B=z.childNodes;for(y=B.length-1;y>=0;y--){if($(B[y]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){this.show(B[y])}}z.shape.isCollapsed=false;$(z).attr("_collapsed",false);x(z,z);this.redrawShape(z);$(q.canvas).trigger("expanded",[z])}};this.clear=function(){q.clear();t.clear();o=Math.round(Math.random()*10000);j=0;k=p(q.group(),null,OG.Constants.NODE_TYPE.ROOT);f=p(q.group(),null,OG.Constants.NODE_TYPE.ETC)};this.removeShape=function(A){var x=w(OG.Util.isElement(A)?A.id:A),B,z,y;B=x.node.childNodes;z=jQuery.Event("beforeRemoveShape",{element:x.node});$(q.canvas).trigger(z);if(z.isPropagationStopped()){return false}for(y=B.length-1;y>=0;y--){if($(B[y]).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){this.removeShape(B[y])}}this.disconnect(x.node);this.removeTerminal(x.node);this.removeGuide(x.node);this.removeCollapseGuide(x.node);this.remove(x.node);$(q.canvas).trigger("removeShape",[x.node])};this.remove=function(y){var z=OG.Util.isElement(y)?y.id:y,x=w(z);v(x)};this.removeChild=function(y){var z=OG.Util.isElement(y)?y.id:y,x=w(z);h(x)};this.getRootElement=function(){return q.canvas};this.getRootGroup=function(){return k.node};this.getElementByPoint=function(x){var y=q.getElementByPoint(x[0],x[1]);return y?y.node.parentNode:null};this.getElementsByBBox=function(y){var x=[];$(this.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"]").each(function(z,A){if(A.shape.geom&&y.isContainsAll(A.shape.geom.getVertices())){x.push(A)}});return x};this.setAttr=function(y,z){var x=w(OG.Util.isElement(y)?y.id:y);if(x){x.attr(z)}};this.getAttr=function(z,y){var x=w(OG.Util.isElement(z)?z.id:z);if(x){return x.attr(y)}return null};this.setShapeStyle=function(y,z){var x=w(OG.Util.isElement(y)?y.id:y);if(x&&y.shape&&y.shape.geom){OG.Util.apply(y.shape.geom.style.map,z||{});y.shapeStyle=y.shapeStyle||{};OG.Util.apply(y.shapeStyle,z||{});this.redrawShape(y)}};this.toFront=function(y){var x=w(OG.Util.isElement(y)?y.id:y);if(x){x.toFront()}};this.toBack=function(y){var x=w(OG.Util.isElement(y)?y.id:y);if(x){x.toBack()}};this.getCanvasSize=function(){return[q.width,q.height]};this.setCanvasSize=function(x){q.setSize(x[0],x[1])};this.fitCanvasSize=function(C,B){var z=this.getRealRootBBox(),y,E,D=1,A=z.width+OG.Constants.FIT_CANVAS_PADDING*2,x=z.height+OG.Constants.FIT_CANVAS_PADDING*2;if(z.width!==0&&z.height!==0){y=z.x>OG.Constants.FIT_CANVAS_PADDING?-1*(z.x-OG.Constants.FIT_CANVAS_PADDING):OG.Constants.FIT_CANVAS_PADDING-z.x;E=z.y>OG.Constants.FIT_CANVAS_PADDING?-1*(z.y-OG.Constants.FIT_CANVAS_PADDING):OG.Constants.FIT_CANVAS_PADDING-z.y;this.move(this.getRootGroup(),[y,E]);this.removeAllGuide();if(C&&C.length===2){if(OG.Util.isDefined(B)&&B===true){D=C[0]/A>C[1]/x?C[1]/x:C[0]/A}A=A<C[0]?C[0]:A;x=x<C[1]?C[1]:x}this.setScale(OG.Util.roundPrecision(D,1));this.setCanvasSize([A,x])}};this.setViewBox=function(x,y,z){q.setViewBox(x[0],x[1],y[0],y[1],z)};this.getScale=function(x){return OG.Constants.SCALE};this.setScale=function(x){if(OG.Constants.SCALE_MIN<=x&&x<=OG.Constants.SCALE_MAX){if(this.isVML()){$(k.node).css({width:21600/x,height:21600/x});$(k.node).find("[_type=SHAPE]").each(function(y,z){$(z).css({width:21600,height:21600})})}else{$(k.node).attr("transform","scale("+x+")");$(f.node).attr("transform","scale("+x+")")}q.setSize(OG.Util.roundGrid(q.width/OG.Constants.SCALE*x),OG.Util.roundGrid(q.height/OG.Constants.SCALE*x));OG.Constants.SCALE=x}};this.show=function(y){var x=w(OG.Util.isElement(y)?y.id:y);if(x){x.show()}};this.hide=function(y){var x=w(OG.Util.isElement(y)?y.id:y);if(x){x.hide()}};this.appendChild=function(x,y){var z=w(OG.Util.isElement(x)?x.id:x),A=w(OG.Util.isElement(y)?y.id:y);A.appendChild(z);return z};this.insertAfter=function(x,y){var z=w(OG.Util.isElement(x)?x.id:x),A=w(OG.Util.isElement(y)?y.id:y);z.insertAfter(A);return z};this.insertBefore=function(x,y){var z=w(OG.Util.isElement(x)?x.id:x),A=w(OG.Util.isElement(y)?y.id:y);z.insertBefore(A);return z};this.move=function(y,D,B){var x=w(OG.Util.isElement(y)?y.id:y),z=x?x.node.getAttribute("_type"):null,C,A=this;this.removeCollapseGuide(y);if(x&&z){$(x.node).children("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape=EDGE]").each(function(E,F){A.move(F,D,B)});$(x.node).children("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape!=EDGE]").each(function(E,F){A.move(F,D,B)});if(z!==OG.Constants.NODE_TYPE.ROOT&&x.node.shape){C=x.node.shape.geom;C.move(D[0],D[1]);this.redrawShape(x.node,B);$(q.canvas).trigger("moveShape",[x.node,D]);return x.node}else{return y}}else{if(x){x.transform("...t"+D[0]+","+D[1]);$(q.canvas).trigger("moveShape",[x.node,D]);return x.node}}return null};this.moveCentroid=function(A,y,C){var z=w(OG.Util.isElement(A)?A.id:A),D=z?z.node.shape.geom:null,B,x={};if(z&&D){x=D.getCentroid();return this.move(A,[y[0]-x.x,y[1]-x.y],C)}else{if(z){B=z.getBBox();x.x=B.x+OG.Util.round(B.width/2);x.y=B.y+OG.Util.round(B.height/2);return this.move(A,[y[0]-x.x,y[1]-x.y])}}this.removeCollapseGuide(A);return null};this.rotate=function(A,z,G){var B=w(OG.Util.isElement(A)?A.id:A),E=B?B.node.getAttribute("_shape"):null,F=B?B.node.shape.geom:null,C,D,x,y,H;if(B&&E&&F){if(E===OG.Constants.SHAPE_TYPE.IMAGE||E===OG.Constants.SHAPE_TYPE.TEXT||E===OG.Constants.SHAPE_TYPE.HTML){C=B.node.shape.clone();D=F.getBoundary();x=D.getCentroid();y=D.getWidth();H=D.getHeight();this.drawShape([x.x,x.y],C,[y,H,z],B.node.shapeStyle,B.node.id)}else{if(B.node.shape.angle){F.rotate(-1*B.node.shape.angle)}F.rotate(z);B.node.shape.angle=z;this.redrawShape(B.node,G)}$(q.canvas).trigger("rotateShape",[B.node,z]);return B.node}else{if(B){B.rotate(z);$(q.canvas).trigger("rotateShape",[B.node,z]);return B.node}}return null};this.resize=function(A,y,G){var C=w(OG.Util.isElement(A)?A.id:A),E=C?C.node.getAttribute("_shape"):null,F=C?C.node.shape.geom:null,J,B,z,x,I,H,D;this.removeCollapseGuide(A);if(C&&E&&F){F.resize(y[0],y[1],y[2],y[3]);this.redrawShape(C.node,G);$(q.canvas).trigger("resizeShape",[C.node,y]);return C.node}else{if(C){J=C.getBBox();B=y[2]+y[3];z=y[0]+y[1];x=J.width+B;I=J.height+z;H=J.width===0?1:x/J.width;D=J.height===0?1:I/J.height;C.transform("...t"+(-1*y[2])+","+(-1*y[0]));C.transform("...s"+H+","+D+","+J.x+","+J.y);$(q.canvas).trigger("resizeShape",[C.node,y]);return C.node}}return null};this.resizeBox=function(A,z){var y=w(OG.Util.isElement(A)?A.id:A),D=y?y.node.shape.geom:null,E,C,B,x;this.removeCollapseGuide(A);if(y&&D){E=D.getBoundary();B=OG.Util.round((z[0]-E.getWidth())/2);x=OG.Util.round((z[1]-E.getHeight())/2);return this.resize(A,[x,x,B,B])}else{if(y){C=y.getBBox();B=OG.Util.round((z[0]-C.width)/2);x=OG.Util.round((z[1]-C.height)/2);return this.resize(A,[x,x,B,B])}}return null};this.intersectionEdge=function(N,C,H,I,A){var E,D,G,K,B,J=Number.MAX_VALUE,x,z,y,F,M,L;if(C){z=$(C).parents("[_collapsed=true]");if(z.length!==0){y=z[z.length-1].shape.geom.getBoundary();F=y.getUpperLeft();M=new OG.geometry.Rectangle(F,OG.Constants.COLLAPSE_SIZE*3,OG.Constants.COLLAPSE_SIZE*2)}}switch(N){case OG.Constants.EDGE_TYPE.PLAIN:E=A?m(C,H,I):b(C,H,I);D=[E.terminal.position.x,E.terminal.position.y];G=E.terminal.direction.toLowerCase();if(M){switch(E.terminal.direction){case OG.Constants.TERMINAL_TYPE.E:L=M.getBoundary().getRightCenter();break;case OG.Constants.TERMINAL_TYPE.W:L=M.getBoundary().getLeftCenter();break;case OG.Constants.TERMINAL_TYPE.S:L=M.getBoundary().getLowerCenter();break;case OG.Constants.TERMINAL_TYPE.N:L=M.getBoundary().getUpperCenter();break}if(L){D=[L.x,L.y]}}break;case OG.Constants.EDGE_TYPE.STRAIGHT:if(M){L=M.getBoundary().getCentroid();if(A===true){H=[L.x,L.y]}else{I=[L.x,L.y]}K=M.intersectToLine([H,I])}else{K=C.shape.geom.intersectToLine([H,I])}D=A?H:I;G="c";for(B=0;B<K.length;B++){x=K[B].distance(A?I:H);if(x<J){J=x;D=[K[B].x,K[B].y];G="c"}}break;default:break}return{position:D,direction:G}};this.clone=function(y){var x=w(OG.Util.isElement(y)?y.id:y),z;z=x.clone();p(z);k.node.appendChild(z.node);return z.node};this.getElementById=function(y){var x=w(y);return x?x.node:null};this.getElementsByType=function(z,x){var y=this.getRootGroup();if(z&&x){return $(y).find("[_type=SHAPE][_shape="+z+"][_shape!="+x+"]")}else{if(z){return $(y).find("[_type=SHAPE][_shape="+z+"]")}else{if(x){return $(y).find("[_type=SHAPE][_shape!="+x+"]")}else{return $(y).find("[_type=SHAPE]")}}}};this.getBBox=function(y){var x=w(OG.Util.isElement(y)?y.id:y);return x.getBBox()};this.getRootBBox=function(){var B=q.canvas.parentNode,C=OG.Util.isFirefox()?q.canvas.width.baseVal.value:q.canvas.scrollWidth,A=OG.Util.isFirefox()?q.canvas.height.baseVal.value:q.canvas.scrollHeight,z=B.offsetLeft,D=B.offsetTop;return{width:C,height:A,x:z,y:D,x2:z+C,y2:D+A}};this.getRealRootBBox=function(){var C=Number.MAX_VALUE,A=Number.MAX_VALUE,z=Number.MIN_VALUE,x=Number.MIN_VALUE,B=this.getElementsByType(),F,G,y,E,D,H={width:0,height:0,x:0,y:0,x2:0,y2:0};for(D=0;D<B.length;D++){F=B[D].shape;if(F&&F.geom){G=F.geom.getBoundary();y=G.getUpperLeft();E=G.getLowerRight();C=C>y.x?y.x:C;A=A>y.y?y.y:A;z=z<E.x?E.x:z;x=x<E.y?E.y:x;H={width:z-C,height:x-A,x:C,y:A,x2:z,y2:x}}}return H};this.getContainer=function(){return q.canvas.parentNode};this.isSVG=function(){return Raphael.svg};this.isVML=function(){return Raphael.vml}};OG.renderer.RaphaelRenderer.prototype=new OG.renderer.IRenderer();OG.renderer.RaphaelRenderer.prototype.constructor=OG.renderer.RaphaelRenderer;OG.RaphaelRenderer=OG.renderer.RaphaelRenderer;OG.handler.EventHandler=function(J){var B=this,h=J,k,v,L,A,e,U=function(Y){return parseInt(Y,10)},N=function(Z,Y){return OG.Constants.DRAG_GRIDABLE?OG.Util.roundGrid(Z,Y):Z},i=function(Y){var Z=OG.Util.isElement(Y)?Y.id:Y;return h.getElementById(Z.substring(0,Z.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP)))},Q=function(Y,ag){var ae,ac,af,Z,ad=false,ab=false,aa;ae=$(Y).attr("_from");ac=$(Y).attr("_to");if(ae){af=i(ae)}if(ac){Z=i(ac)}for(aa=0;aa<ag.length;aa++){if(af&&ag[aa].id===af.id){ad=true}if(Z&&ag[aa].id===Z.id){ab=true}}return{none:!ad&&!ab,all:ad&&ab,any:ad||ab,either:(ad&&!ab)||(!ad&&ab),attrEither:(ae&&!ac)||(!ae&&ac)}},n=function(Z){var Y=h.getContainer();return{x:(Z.pageX-$(Y).offset().left+Y.scrollLeft)/OG.Constants.SCALE,y:(Z.pageY-$(Y).offset().top+Y.scrollTop)/OG.Constants.SCALE}},R=function(){var aa=[],Z,Y=[];$(h.getRootElement()).find("[id$="+OG.Constants.GUIDE_SUFFIX.BBOX+"]").each(function(ab,ac){if(ac.id){Z=h.clone(ac);h.setAttr(Z,OG.Constants.DEFAULT_STYLE.GUIDE_SHADOW);aa.push({id:ac.id.replace(OG.Constants.GUIDE_SUFFIX.BBOX,""),box:Z})}});$.each(aa,function(ac,ad){var ae=h.getElementById(ad.id),ab;if($(ae).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){ab=Q(ae,aa);if(ab.all||ab.none||(ab.either&&ab.attrEither)){Y.push(ad)}else{h.remove(ad.box);h.removeGuide(ae)}}});$.each(aa,function(ab,ac){var ad=h.getElementById(ac.id);if($(ad).attr("_shape")!==OG.Constants.SHAPE_TYPE.EDGE){Y.push(ac)}});return Y},p=function(ac,Z,Y){var ab=[],aa=[];$.each(ac,function(ad,ae){var af=h.getElementById(ae.id);if($(af).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){ab.push(ae.id)}});$.each(ac,function(ad,ae){var af=h.getElementById(ae.id);h.remove(ae.box);h.move(af,[Z,Y],ab);h.drawGuide(af);if($(af).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){if(Q(af,ac).none){h.disconnect(af)}}aa.push(af)});return aa},M=function(){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape=EDGE][_selected=true]").each(function(Y,Z){if(Z.id){h.removeShape(Z)}});$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Y,Z){if(Z.id){h.removeShape(Z)}})},s=function(Z){if($(Z.parentNode).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){var Y=h.drawGuide(Z);if(Y){k(Z,Y,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.removeTerminal(Z)}}},T=function(){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"]").each(function(Y,Z){s(Z)})},z=function(){var Y=h.getRootGroup(),Z=[];$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(aa,ab){Z.push(ab)});$(Y).data("copied",Z)},m=function(){z();M()},G=function(){var Z=h.getRootGroup(),Y=$(Z).data("copied"),aa=[];if(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ab,ac){if(ac.id){h.removeGuide(ac)}});$.each(Y,function(ab,ae){var ag=ae.shape.geom.getBoundary(),ad,af,ac;ad=ae.shape.clone();if($(ae).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){ad.geom=new OG.PolyLine(ae.shape.geom.getVertices());ad.geom.style=ae.shape.geom.style;ad.geom.move(OG.Constants.COPY_PASTE_PADDING,OG.Constants.COPY_PASTE_PADDING);af=h.drawShape(null,ad,null,ae.shapeStyle)}else{af=h.drawShape([ag.getCentroid().x+OG.Constants.COPY_PASTE_PADDING,ag.getCentroid().y+OG.Constants.COPY_PASTE_PADDING],ad,[ag.getWidth(),ag.getHeight()],ae.shapeStyle)}af.data=ae.data;ac=h.drawGuide(af);B.setClickSelectable(af,OG.Constants.SELECTABLE);B.setMovable(af,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);k(af,ac,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);if(OG.Constants.GROUP_DROPABLE){B.enableDragAndDropGroup(af)}if(OG.Constants.GROUP_COLLAPSIBLE){B.enableCollapse(af)}if($(af).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.CONNECTABLE){B.enableConnect(af)}if(OG.Constants.LABEL_EDITABLE){B.enableEditLabel(af)}}A(ae,af);aa.push(af)});$(Z).data("copied",aa)}},F=function(){z();G()},S=function(){var Z=h.group($(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]")),Y;if(Z){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(aa,ab){h.removeGuide(ab)});Y=h.drawGuide(Z);if(Y){B.setClickSelectable(Z,OG.Constants.SELECTABLE);B.setMovable(Z,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);k(Z,Y,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);if(OG.Constants.GROUP_DROPABLE){B.enableDragAndDropGroup(Z)}h.removeAllTerminal();h.toFront(Y.group)}}},o=function(){var Z=h.ungroup($(h.getRootElement()).find("[_shape="+OG.Constants.SHAPE_TYPE.GROUP+"][_selected=true]")),Y;$.each(Z,function(aa,ab){Y=h.drawGuide(ab);if(Y){h.removeAllTerminal();h.toFront(Y.group)}})},I=function(Z){var Y;$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape="+OG.Constants.SHAPE_TYPE.EDGE+"][_selected=true]").each(function(aa,ab){h.removeGuide(ab)});$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(aa,ab){if(ab.shape&&ab.shape.TYPE!==OG.Constants.SHAPE_TYPE.EDGE&&ab.shape.TYPE!==OG.Constants.SHAPE_TYPE.GROUP){h.rotate(ab,Z);h.removeGuide(ab);Y=h.drawGuide(ab);k(ab,Y,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.toFront(Y.group)}})},r=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"stroke-width":Y})})},l=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{stroke:Y})})},D=function(Z){var Y;$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape="+OG.Constants.SHAPE_TYPE.EDGE+"][_selected=true]").each(function(aa,ab){OG.Util.apply(ab.shape.geom.style.map,{"edge-type":Z});ab.shapeStyle=ab.shapeStyle||{};OG.Util.apply(ab.shapeStyle,{"edge-type":Z});h.redrawEdge(ab);h.removeGuide(ab);Y=h.drawGuide(ab);k(ab,Y,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.toFront(Y.group)})},u=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"stroke-dasharray":Y})})},E=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"arrow-start":Y})})},O=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"arrow-end":Y})})},g=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{fill:Y,"fill-opacity":1})})},x=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"fill-opacity":Y})})},H=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"font-family":Y})})},d=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"font-size":Y})})},P=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"font-color":Y})})},b=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"font-weight":Y})})},W=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"font-style":Y})})},a=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"text-decoration":Y})})},X=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"label-direction":Y})})},c=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"label-angle":Y})})},V=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){if(Y==="top"){h.setShapeStyle(aa,{"label-position":Y,"text-anchor":"middle","vertical-align":"bottom"})}else{if(Y==="bottom"){h.setShapeStyle(aa,{"label-position":Y,"text-anchor":"middle","vertical-align":"top"})}else{if(Y==="left"){h.setShapeStyle(aa,{"label-position":Y,"text-anchor":"end","vertical-align":"center"})}else{if(Y==="right"){h.setShapeStyle(aa,{"label-position":Y,"text-anchor":"start","vertical-align":"center"})}else{if(Y==="center"){h.setShapeStyle(aa,{"label-position":Y,"text-anchor":"middle","vertical-align":"center"})}}}}}})},f=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"vertical-align":Y})})},w=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.setShapeStyle(aa,{"text-anchor":Y})})},y=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(Z,aa){h.drawLabel(aa,Y)})},q=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape="+OG.Constants.SHAPE_TYPE.EDGE+"][_selected=true]").each(function(Z,aa){h.drawEdgeLabel(aa,Y,"FROM")})},K=function(Y){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_shape="+OG.Constants.SHAPE_TYPE.EDGE+"][_selected=true]").each(function(Z,aa){h.drawEdgeLabel(aa,Y,"TO")})},C=function(){if(OG.Constants.SCALE+OG.Constants.SCALE*0.1<=OG.Constants.SCALE_MAX){h.setScale(OG.Constants.SCALE+OG.Constants.SCALE*0.1)}},t=function(){if(OG.Constants.SCALE-OG.Constants.SCALE*0.1>=OG.Constants.SCALE_MIN){h.setScale(OG.Constants.SCALE-OG.Constants.SCALE*0.1)}},j=function(){var Y=h.getContainer();h.fitCanvasSize([Y.clientWidth,Y.clientHeight],true)};k=function(aa,Y,ab){var Z=h.getRootGroup();if(!aa||!Y){return}if(ab){if(($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GEOM&&OG.Constants.RESIZABLE_GEOM)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.TEXT&&OG.Constants.RESIZABLE_TEXT)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.HTML&&OG.Constants.RESIZABLE_HTML)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.IMAGE&&OG.Constants.RESIZABLE_IMAGE)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE&&OG.Constants.RESIZABLE_EDGE)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP&&OG.Constants.RESIZABLE_GROUP)){if($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){$(Y.from).draggable({start:function(ah){var af=aa.shape.geom.getVertices(),ac={},ad=$(aa).attr("_to"),ai,ae=[af[af.length-1].x,af[af.length-1].y],ag=h.drawEdge(new OG.PolyLine(af),OG.Util.apply(ac,OG.Constants.DEFAULT_STYLE.EDGE_SHADOW,aa.shape.geom.style.map));if(ad){ai=i(ad);h.drawTerminal(ai);ae=h.getElementById(ad)}$(Z).data("to_terminal",ae);$(Z).data("edge",ag);$(Z).data("dragged_guide","from");h.removeRubberBand(h.getRootElement());$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ak,aj){if(aj.id&&$(aj).attr("_shape")!==OG.Constants.SHAPE_TYPE.EDGE){h.removeGuide(aj)}})},drag:function(ac){var ag=n(ac),ae=$(Z).data("edge"),al=$(Z).data("edge_terminal"),aq=$(Z).data("to_terminal"),am=al?[al.terminal.position.x,al.terminal.position.y]:[ag.x,ag.y],ai=OG.Util.isElement(aq)?[aq.terminal.position.x,aq.terminal.position.y]:aq,an=al?al.terminal.direction.toLowerCase():"c",aj=OG.Util.isElement(aq)?aq.terminal.direction.toLowerCase():"c",ao=al?i(al):null,ah=OG.Util.isElement(aq)?i(aq):null,ad,ap,af,ak;$(this).css({position:"",left:"",top:""});ad=am;ap=ai;if(ao&&an==="c"){af=h.intersectionEdge(ae.geom.style.get("edge-type"),ao,[ad[0],ad[1]],[ap[0],ap[1]],true);am=af.position;an=af.direction}if(ah&&aj==="c"){af=h.intersectionEdge(ae.geom.style.get("edge-type"),ah,[ad[0],ad[1]],[ap[0],ap[1]],false);ai=af.position;aj=af.direction}ak=ao&&ah&&ao.id===ah.id;if(ak){am=ai=ao.shape.geom.getBoundary().getRightCenter()}if(!ak||OG.Constants.SELF_CONNECTABLE){h.drawEdge(new OG.Line(am,ai),OG.Util.apply(ae.geom.style.map,{"edge-direction":an+" "+aj}),ae.id,ak)}},stop:function(ag){var aj=n(ag),ai=$(Z).data("edge_terminal")||[aj.x,aj.y],ac=$(Z).data("to_terminal"),ae=OG.Util.isElement(ai)?i(ai):null,ah=OG.Util.isElement(ac)?i(ac):null,af=$(Z).data("edge"),ad;$(this).css({position:"absolute",left:"0px",top:"0px"});$(Z).removeData("to_terminal");$(Z).removeData("edge");$(Z).removeData("edge_terminal");$(Z).removeData("dragged_guide");h.remove(af);h.removeGuide(aa);if(ae){h.remove(ae.id+OG.Constants.DROP_OVER_BBOX_SUFFIX)}ad=ae&&ah&&ae.id===ah.id;if(!ad||OG.Constants.SELF_CONNECTABLE){aa=h.connect(ai,ac,aa,aa.shape.geom.style);if(aa){Y=h.drawGuide(aa);if(aa&&Y){k(aa,Y,true);h.toFront(Y.group)}}}}});$(Y.to).draggable({start:function(ah){var ae=aa.shape.geom.getVertices(),ad={},ac=$(aa).attr("_from"),af,ai=[ae[0].x,ae[0].y],ag=h.drawEdge(new OG.PolyLine(ae),OG.Util.apply(ad,OG.Constants.DEFAULT_STYLE.EDGE_SHADOW,aa.shape.geom.style.map));if(ac){af=i(ac);h.drawTerminal(af);ai=h.getElementById(ac)}$(Z).data("from_terminal",ai);$(Z).data("edge",ag);$(Z).data("dragged_guide","to");h.removeRubberBand(h.getRootElement());$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ak,aj){if(aj.id&&$(aj).attr("_shape")!==OG.Constants.SHAPE_TYPE.EDGE){h.removeGuide(aj)}})},drag:function(ac){var ag=n(ac),ae=$(Z).data("edge"),al=$(Z).data("from_terminal"),aq=$(Z).data("edge_terminal"),am=OG.Util.isElement(al)?[al.terminal.position.x,al.terminal.position.y]:al,ai=aq?[aq.terminal.position.x,aq.terminal.position.y]:[ag.x,ag.y],an=OG.Util.isElement(al)?al.terminal.direction.toLowerCase():"c",aj=aq?aq.terminal.direction.toLowerCase():"c",ao=OG.Util.isElement(al)?i(al):null,ah=aq?i(aq):null,ad,ap,af,ak;$(this).css({position:"",left:"",top:""});ad=am;ap=ai;if(ao&&an==="c"){af=h.intersectionEdge(ae.geom.style.get("edge-type"),ao,[ad[0],ad[1]],[ap[0],ap[1]],true);am=af.position;an=af.direction}if(ah&&aj==="c"){af=h.intersectionEdge(ae.geom.style.get("edge-type"),ah,[ad[0],ad[1]],[ap[0],ap[1]],false);ai=af.position;aj=af.direction}ak=(ao!==null)&&(ah!==null)&&ao.id===ah.id;if(ak){am=ai=ah.shape.geom.getBoundary().getRightCenter()}if(!ak||OG.Constants.SELF_CONNECTABLE){h.drawEdge(new OG.Line(am,ai),OG.Util.apply(ae.geom.style.map,{"edge-direction":an+" "+aj}),ae.id,ak)}},stop:function(ag){var aj=n(ag),ai=$(Z).data("from_terminal"),ac=$(Z).data("edge_terminal")||[aj.x,aj.y],ae=OG.Util.isElement(ai)?i(ai):null,ah=OG.Util.isElement(ac)?i(ac):null,af=$(Z).data("edge"),ad;$(this).css({position:"absolute",left:"0px",top:"0px"});$(Z).removeData("from_terminal");$(Z).removeData("edge");$(Z).removeData("edge_terminal");$(Z).removeData("dragged_guide");h.remove(af);h.removeGuide(aa);if(ah){h.remove(ah.id+OG.Constants.DROP_OVER_BBOX_SUFFIX)}ad=ae&&ah&&ae.id===ah.id;if(!ad||OG.Constants.SELF_CONNECTABLE){aa=h.connect(ai,ac,aa,aa.shape.geom.style);if(aa){Y=h.drawGuide(aa);if(Y){k(aa,Y,true);h.toFront(Y.group)}}}}});$.each(Y.controls,function(ac,ad){$(ad).draggable({start:function(ae){var af=n(ae);$(this).data("start",{x:af.x,y:af.y});$(this).data("offset",{x:af.x-U(h.getAttr(ad,"x")),y:af.y-U(h.getAttr(ad,"y"))});h.remove(Y.bBox);h.removeRubberBand(h.getRootElement())},drag:function(af){var ah=n(af),ag=$(this).data("start"),ai=$(this).data("offset"),ae=ah.x-ai.x,am=ah.y-ai.y,ak=aa.shape.geom.getVertices(),al=ad.id.indexOf(OG.Constants.GUIDE_SUFFIX.CTL_H)>=0,aj=al?parseInt(ad.id.replace(aa.id+OG.Constants.GUIDE_SUFFIX.CTL_H,""),10):parseInt(ad.id.replace(aa.id+OG.Constants.GUIDE_SUFFIX.CTL_V,""),10);$(this).css({position:"",left:"",top:""});if(al){ak[aj].x=ae;ak[aj+1].x=ae}else{ak[aj].y=am;ak[aj+1].y=am}aa=h.drawEdge(new OG.PolyLine(ak),aa.shape.geom.style,aa.id);h.drawGuide(aa);h.removeAllTerminal();h.drawLabel(aa);h.drawEdgeLabel(aa,null,"FROM");h.drawEdgeLabel(aa,null,"TO")},stop:function(af){var ah=n(af),ag=$(this).data("start"),ai=$(this).data("offset"),ae=ah.x-ai.x,am=ah.y-ai.y,ak=aa.shape.geom.getVertices(),al=ad.id.indexOf(OG.Constants.GUIDE_SUFFIX.CTL_H)>=0,aj=al?parseInt(ad.id.replace(aa.id+OG.Constants.GUIDE_SUFFIX.CTL_H,""),10):parseInt(ad.id.replace(aa.id+OG.Constants.GUIDE_SUFFIX.CTL_V,""),10);$(this).css({position:"absolute",left:"0px",top:"0px"});if(al){ak[aj].x=ae;ak[aj+1].x=ae}else{ak[aj].y=am;ak[aj+1].y=am}aa=h.drawEdge(new OG.PolyLine(ak),aa.shape.geom.style,aa.id);h.drawGuide(aa);h.drawLabel(aa);h.drawEdgeLabel(aa,null,"FROM");h.drawEdgeLabel(aa,null,"TO")}})})}else{$(Y.rc).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.rc,"x")),y:ad.y-U(h.getAttr(Y.rc,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ad){var ae=n(ad),ah=$(this).data("start"),ag=$(this).data("offset"),af=N(ae.x-ag.x),ac=N(af-U(h.getAttr(Y.lc,"x")));$(this).css({position:"",left:"",top:""});if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.rc,{x:af});h.setAttr(Y.ur,{x:af});h.setAttr(Y.lr,{x:af});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+af)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+af)/2)});h.setAttr(Y.bBox,{width:ac})}h.removeAllTerminal()},stop:function(ad){var ae=n(ad),af=$(this).data("start"),ac=ae.x-af.x;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}h.resize(aa,[0,0,0,N(ac)]);h.drawGuide(aa)}}});$(Y.lwc).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.lwc,"x")),y:ad.y-U(h.getAttr(Y.lwc,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ad){var ae=n(ad),ah=$(this).data("start"),ag=$(this).data("offset"),af=N(ae.y-ag.y),ac=N(af-U(h.getAttr(Y.uc,"y")));$(this).css({position:"",left:"",top:""});if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lwc,{y:af});h.setAttr(Y.ll,{y:af});h.setAttr(Y.lr,{y:af});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+af)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+af)/2)});h.setAttr(Y.bBox,{height:ac})}h.removeAllTerminal()},stop:function(ad){var ae=n(ad),af=$(this).data("start"),ac=ae.y-af.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[0,N(ac),0,0]);h.drawGuide(aa)}}});$(Y.lr).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.lr,"x")),y:ad.y-U(h.getAttr(Y.lr,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ae){var af=n(ae),aj=$(this).data("start"),ai=$(this).data("offset"),ah=N(af.x-ai.x),ad=N(ah-U(h.getAttr(Y.lc,"x"))),ag=N(af.y-ai.y),ac=N(ag-U(h.getAttr(Y.uc,"y")));$(this).css({position:"",left:"",top:""});if(ad>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.rc,{x:ah});h.setAttr(Y.ur,{x:ah});h.setAttr(Y.lr,{x:ah});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+ah)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+ah)/2)});h.setAttr(Y.bBox,{width:ad})}if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lwc,{y:ag});h.setAttr(Y.ll,{y:ag});h.setAttr(Y.lr,{y:ag});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+ag)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+ag)/2)});h.setAttr(Y.bBox,{height:ac})}h.removeAllTerminal()},stop:function(ae){var af=n(ae),ag=$(this).data("start"),ad=af.x-ag.x,ac=af.y-ag.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ad<OG.Constants.GUIDE_MIN_SIZE){ad=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[0,N(ac),0,N(ad)]);h.drawGuide(aa)}h.removeAllTerminal()}});$(Y.lc).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.lc,"x")),y:ad.y-U(h.getAttr(Y.lc,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ad){var ae=n(ad),ah=$(this).data("start"),ag=$(this).data("offset"),af=N(ae.x-ag.x),ac=N(U(h.getAttr(Y.rc,"x"))-af);$(this).css({position:"",left:"",top:""});if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lc,{x:af});h.setAttr(Y.ul,{x:af});h.setAttr(Y.ll,{x:af});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+af)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+af)/2)});h.setAttr(Y.bBox,{x:OG.Util.round(af+U(h.getAttr(Y.lc,"width"))/2),width:ac})}h.removeAllTerminal()},stop:function(ad){var ae=n(ad),af=$(this).data("start"),ac=af.x-ae.x;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}h.resize(aa,[0,0,N(ac),0]);h.drawGuide(aa)}}});$(Y.ll).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.ll,"x")),y:ad.y-U(h.getAttr(Y.ll,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ae){var af=n(ae),aj=$(this).data("start"),ai=$(this).data("offset"),ah=N(af.x-ai.x),ag=N(af.y-ai.y),ad=N(U(h.getAttr(Y.rc,"x"))-ah),ac=N(ag-U(h.getAttr(Y.uc,"y")));$(this).css({position:"",left:"",top:""});if(ad>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lc,{x:ah});h.setAttr(Y.ul,{x:ah});h.setAttr(Y.ll,{x:ah});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+ah)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+ah)/2)});h.setAttr(Y.bBox,{x:OG.Util.round(ah+U(h.getAttr(Y.lc,"width"))/2),width:ad})}if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lwc,{y:ag});h.setAttr(Y.ll,{y:ag});h.setAttr(Y.lr,{y:ag});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+ag)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.uc,"y"))+ag)/2)});h.setAttr(Y.bBox,{height:ac})}h.removeAllTerminal()},stop:function(ae){var af=n(ae),ag=$(this).data("start"),ad=ag.x-af.x,ac=af.y-ag.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ad<OG.Constants.GUIDE_MIN_SIZE){ad=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[0,N(ac),N(ad),0]);h.drawGuide(aa)}}});$(Y.uc).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.uc,"x")),y:ad.y-U(h.getAttr(Y.uc,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ad){var ae=n(ad),ah=$(this).data("start"),ag=$(this).data("offset"),af=N(ae.y-ag.y),ac=N(U(h.getAttr(Y.lwc,"y"))-af);$(this).css({position:"",left:"",top:""});if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.uc,{y:af});h.setAttr(Y.ul,{y:af});h.setAttr(Y.ur,{y:af});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+af)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+af)/2)});h.setAttr(Y.bBox,{y:OG.Util.round(af+U(h.getAttr(Y.uc,"width"))/2),height:ac})}h.removeAllTerminal()},stop:function(ad){var ae=n(ad),af=$(this).data("start"),ac=af.y-ae.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[N(ac),0,0,0]);h.drawGuide(aa)}}});$(Y.ul).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.ul,"x")),y:ad.y-U(h.getAttr(Y.ul,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ae){var af=n(ae),aj=$(this).data("start"),ai=$(this).data("offset"),ah=N(af.x-ai.x),ag=N(af.y-ai.y),ad=N(U(h.getAttr(Y.rc,"x"))-ah),ac=N(U(h.getAttr(Y.lwc,"y"))-ag);$(this).css({position:"",left:"",top:""});if(ad>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.lc,{x:ah});h.setAttr(Y.ul,{x:ah});h.setAttr(Y.ll,{x:ah});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+ah)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.rc,"x"))+ah)/2)});h.setAttr(Y.bBox,{x:OG.Util.round(ah+U(h.getAttr(Y.lc,"width"))/2),width:ad})}if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.uc,{y:ag});h.setAttr(Y.ul,{y:ag});h.setAttr(Y.ur,{y:ag});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+ag)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+ag)/2)});h.setAttr(Y.bBox,{y:OG.Util.round(ag+U(h.getAttr(Y.uc,"height"))/2),height:ac})}h.removeAllTerminal()},stop:function(ae){var af=n(ae),ag=$(this).data("start"),ad=ag.x-af.x,ac=ag.y-af.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ad<OG.Constants.GUIDE_MIN_SIZE){ad=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[N(ac),0,N(ad),0]);h.drawGuide(aa)}}});$(Y.ur).draggable({start:function(ac){var ad=n(ac);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(Y.ur,"x")),y:ad.y-U(h.getAttr(Y.ur,"y"))});h.removeRubberBand(h.getRootElement())},drag:function(ae){var af=n(ae),aj=$(this).data("start"),ai=$(this).data("offset"),ah=N(af.x-ai.x),ag=N(af.y-ai.y),ad=N(ah-U(h.getAttr(Y.lc,"x"))),ac=N(U(h.getAttr(Y.lwc,"y"))-ag);$(this).css({position:"",left:"",top:""});if(ad>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.rc,{x:ah});h.setAttr(Y.ur,{x:ah});h.setAttr(Y.lr,{x:ah});h.setAttr(Y.uc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+ah)/2)});h.setAttr(Y.lwc,{x:OG.Util.round((U(h.getAttr(Y.lc,"x"))+ah)/2)});h.setAttr(Y.bBox,{width:ad})}if(ac>=OG.Constants.GUIDE_MIN_SIZE){h.setAttr(Y.uc,{y:ag});h.setAttr(Y.ul,{y:ag});h.setAttr(Y.ur,{y:ag});h.setAttr(Y.lc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+ag)/2)});h.setAttr(Y.rc,{y:OG.Util.round((U(h.getAttr(Y.lwc,"y"))+ag)/2)});h.setAttr(Y.bBox,{y:OG.Util.round(ag+U(h.getAttr(Y.uc,"width"))/2),height:ac})}h.removeAllTerminal()},stop:function(ae){var af=n(ae),ag=$(this).data("start"),ad=af.x-ag.x,ac=ag.y-af.y;$(this).css({position:"absolute",left:"0px",top:"0px"});if(aa&&aa.shape.geom){if(aa.shape.geom.getBoundary().getWidth()+ad<OG.Constants.GUIDE_MIN_SIZE){ad=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getWidth()}if(aa.shape.geom.getBoundary().getHeight()+ac<OG.Constants.GUIDE_MIN_SIZE){ac=OG.Constants.GUIDE_MIN_SIZE-aa.shape.geom.getBoundary().getHeight()}h.resize(aa,[N(ac),0,0,N(ad)]);h.drawGuide(aa)}}})}}}else{if($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){h.setAttr(Y.from,{cursor:"default"});h.setAttr(Y.to,{cursor:"default"});$.each(Y.controls,function(ac,ad){h.setAttr(ad,{cursor:"default"})})}else{h.setAttr(Y.ul,{cursor:"default"});h.setAttr(Y.ur,{cursor:"default"});h.setAttr(Y.ll,{cursor:"default"});h.setAttr(Y.lr,{cursor:"default"});h.setAttr(Y.lc,{cursor:"default"});h.setAttr(Y.uc,{cursor:"default"});h.setAttr(Y.rc,{cursor:"default"});h.setAttr(Y.lwc,{cursor:"default"})}}};v=function(Z){var Y=Z.parentNode;if(Y){if(v(Y)){return true}if($(Y).attr("_type")===OG.Constants.NODE_TYPE.SHAPE&&$(Y).attr("_selected")==="true"){return true}}return false};L=function(Z){var Y=Z.childNodes;$.each(Y,function(aa,ab){if($(ab).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){if(ab.childNodes.length>0){L(ab)}if($(ab).attr("_selected")==="true"){h.removeGuide(ab);$(ab).draggable("destroy")}}})};A=function(Z,aa){var Y=Z.childNodes;$.each(Y,function(ab,ae){if($(ae).attr("_type")===OG.Constants.NODE_TYPE.SHAPE){var ag=ae.shape.geom.getBoundary(),ad,af,ac;ad=ae.shape.clone();if($(ae).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){ad.geom=new OG.PolyLine(ae.shape.geom.getVertices());ad.geom.style=ae.shape.geom.style;ad.geom.move(OG.Constants.COPY_PASTE_PADDING,OG.Constants.COPY_PASTE_PADDING);af=h.drawShape(null,ad,null,ae.shapeStyle)}else{af=h.drawShape([ag.getCentroid().x+OG.Constants.COPY_PASTE_PADDING,ag.getCentroid().y+OG.Constants.COPY_PASTE_PADDING],ad,[ag.getWidth(),ag.getHeight()],ae.shapeStyle)}af.data=ae.data;aa.appendChild(af);B.setClickSelectable(af,OG.Constants.SELECTABLE);B.setMovable(af,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);if(OG.Constants.GROUP_DROPABLE){B.enableDragAndDropGroup(af)}if(OG.Constants.GROUP_COLLAPSIBLE){B.enableCollapse(af)}if($(af).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.CONNECTABLE){B.enableConnect(af)}if(OG.Constants.LABEL_EDITABLE){B.enableEditLabel(af)}}if(ae.childNodes.length>0){A(ae,af)}}})};e=function(aa,Z){var Y=h.getRootBBox();if(OG.Constants.AUTO_EXTENSIONAL&&Y.width<aa*OG.Constants.SCALE){h.setCanvasSize([Y.width+OG.Constants.AUTO_EXTENSION_SIZE,Y.height])}if(OG.Constants.AUTO_EXTENSIONAL&&Y.height<Z*OG.Constants.SCALE){h.setCanvasSize([Y.width,Y.height+OG.Constants.AUTO_EXTENSION_SIZE])}};this.setResizable=k;this.deleteSelectedShape=M;this.selectShape=s;this.selectAll=T;this.copySelectedShape=z;this.cutSelectedShape=m;this.pasteSelectedShape=G;this.duplicateSelectedShape=F;this.groupSelectedShape=S;this.ungroupSelectedShape=o;this.rotateSelectedShape=I;this.setLineWidthSelectedShape=r;this.setLineColorSelectedShape=l;this.setLineTypeSelectedShape=D;this.setLineStyleSelectedShape=u;this.setArrowStartSelectedShape=E;this.setArrowEndSelectedShape=O;this.setFillColorSelectedShape=g;this.setFillOpacitySelectedShape=x;this.setFontFamilySelectedShape=H;this.setFontSizeSelectedShape=d;this.setFontColorSelectedShape=P;this.setFontWeightSelectedShape=b;this.setFontStyleSelectedShape=W;this.setTextDecorationSelectedShape=a;this.setLabelDirectionSelectedShape=X;this.setLabelAngleSelectedShape=c;this.setLabelPositionSelectedShape=V;this.setLabelVerticalSelectedShape=f;this.setLabelHorizontalSelectedShape=w;this.setLabelSelectedShape=y;this.setEdgeFromLabelSelectedShape=q;this.setEdgeToLabelSelectedShape=K;this.zoomIn=C;this.zoomOut=t;this.fitWindow=j;this.enableEditLabel=function(Y){if(($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.GEOM&&OG.Constants.LABEL_EDITABLE_GEOM)||($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.TEXT&&OG.Constants.LABEL_EDITABLE_TEXT)||($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.HTML&&OG.Constants.LABEL_EDITABLE_HTML)||($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.IMAGE&&OG.Constants.LABEL_EDITABLE_IMAGE)||($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE&&OG.Constants.LABEL_EDITABLE_EDGE)||($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP&&OG.Constants.LABEL_EDITABLE_GROUP)){$(Y).bind({dblclick:function(ac){var ad=h.getContainer(),aj=Y.shape.geom.getBoundary(),ab=aj.getUpperLeft(),an,ah=(ab.x-1)*OG.Constants.SCALE,al=(ab.y-1)*OG.Constants.SCALE,af=aj.getWidth()*OG.Constants.SCALE,am=aj.getHeight()*OG.Constants.SCALE,ag=Y.id+OG.Constants.LABEL_EDITOR_SUFFIX,aa,ae="center",ao,ai,ak=function(au){var ar,ap,av=0,at,aq;ar=au.shape.geom.getVertices();ap=au.shape.geom.getLength();for(at=0;at<ar.length-1;at++){av+=ar[at].distance(ar[at+1]);if(av>ap/2){aq=au.shape.geom.intersectCircleToLine(ar[at+1],av-ap/2,ar[at+1],ar[at]);break}}return aq[0]},Z;$(ad).append("<textarea id='"+Y.id+OG.Constants.LABEL_EDITOR_SUFFIX+"'></textarea>");aa=$("#"+ag);switch(Y.shape.geom.style.get("text-anchor")){case"start":ae="left";break;case"middle":ae="center";break;case"end":ae="right";break;default:ae="center";break}if($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.HTML){$(aa).css(OG.Util.apply(OG.Constants.DEFAULT_STYLE.LABEL_EDITOR,{left:ah,top:al,width:af,height:am,"text-align":"left",overflow:"hidden",resize:"none"}));$(aa).focus();$(aa).val(Y.shape.html);$(aa).bind({focusout:function(){Y.shape.html=this.value;if(Y.shape.html){h.redrawShape(Y);this.parentNode.removeChild(this)}else{h.removeShape(Y);this.parentNode.removeChild(this)}}})}else{if($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.TEXT){$(aa).css(OG.Util.apply(OG.Constants.DEFAULT_STYLE.LABEL_EDITOR,{left:ah,top:al,width:af,height:am,"text-align":ae,overflow:"hidden",resize:"none"}));$(aa).focus();$(aa).val(Y.shape.text);$(aa).bind({focusout:function(){Y.shape.text=this.value;if(Y.shape.text){h.redrawShape(Y);this.parentNode.removeChild(this)}else{h.removeShape(Y);this.parentNode.removeChild(this)}}})}else{if($(Y).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE){if(Y.shape.label&&h.isSVG()){$(Y).children("[id$=_LABEL]").each(function(ap,aq){$(aq).find("text").each(function(at,ar){an=h.getBBox(ar);ah=an.x-10;al=an.y;af=an.width+20;am=an.height})})}else{Z=ak(Y);ah=Z.x-OG.Constants.LABEL_EDITOR_WIDTH/2;al=Z.y-OG.Constants.LABEL_EDITOR_HEIGHT/2;af=OG.Constants.LABEL_EDITOR_WIDTH;am=OG.Constants.LABEL_EDITOR_HEIGHT}$(ac.srcElement).parents("[id$=_FROMLABEL]").each(function(ap,aq){$(aq).find("text").each(function(at,ar){an=h.getBBox(ar);ah=an.x-10;al=an.y;af=an.width+20;am=an.height;ao=Y.shape.fromLabel})});$(ac.srcElement).parents("[id$=_TOLABEL]").each(function(ap,aq){$(aq).find("text").each(function(at,ar){an=h.getBBox(ar);ah=an.x-10;al=an.y;af=an.width+20;am=an.height;ai=Y.shape.toLabel})});$(aa).css(OG.Util.apply(OG.Constants.DEFAULT_STYLE.LABEL_EDITOR,{left:ah*OG.Constants.SCALE,top:al*OG.Constants.SCALE,width:af*OG.Constants.SCALE,height:am*OG.Constants.SCALE,overflow:"hidden",resize:"none"}));$(aa).focus();if(ao||ai){$(aa).val(ao?Y.shape.fromLabel:Y.shape.toLabel)}else{$(aa).val(Y.shape.label)}$(aa).bind({focusout:function(){if(ao){h.drawEdgeLabel(Y,this.value,"FROM")}else{if(ai){h.drawEdgeLabel(Y,this.value,"TO")}else{h.drawLabel(Y,this.value)}}this.parentNode.removeChild(this)}})}else{$(aa).css(OG.Util.apply(OG.Constants.DEFAULT_STYLE.LABEL_EDITOR,{left:ah,top:al,width:af,height:am,"text-align":ae,overflow:"hidden",resize:"none"}));$(aa).focus();$(aa).val(Y.shape.label);$(aa).bind({focusout:function(){h.drawLabel(Y,this.value);this.parentNode.removeChild(this)}})}}}}})}};this.enableConnect=function(Z){var aa,Y=h.getRootGroup();if(Z&&$(Z).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){$(Z).bind({mouseover:function(){aa=h.drawTerminal(Z,$(Y).data("dragged_guide")==="to"?OG.Constants.TERMINAL_TYPE.IN:OG.Constants.TERMINAL_TYPE.OUT);if(aa&&aa.terminal&&aa.terminal.childNodes.length>0){if($(Y).data("edge")){$.each(aa.terminal.childNodes,function(ab,ae){var af=$(Y).data("from_terminal"),ad=af&&OG.Util.isElement(af)?i(af):null,ac=Z&&ad&&Z.id===ad.id;if(ae.terminal&&ae.terminal.direction.toLowerCase()==="c"&&(($(Y).data("dragged_guide")==="to"&&ae.terminal.inout.indexOf(OG.Constants.TERMINAL_TYPE.IN)>=0)||($(Y).data("dragged_guide")==="from"&&ae.terminal.inout.indexOf(OG.Constants.TERMINAL_TYPE.OUT)>=0))&&(!ac||OG.Constants.SELF_CONNECTABLE)){h.drawDropOverGuide(Z);$(Y).data("edge_terminal",ae);return false}})}$(aa.bBox).bind({mouseout:function(){if(!$(Y).data("edge")){h.removeTerminal(Z)}}});$.each(aa.terminal.childNodes,function(ab,ac){if(ac.terminal){$(ac).bind({mouseover:function(af){var ag=$(Y).data("from_terminal"),ae=ag&&OG.Util.isElement(ag)?i(ag):null,ad=Z&&ae&&Z.id===ae.id;if((($(Y).data("dragged_guide")==="to"&&ac.terminal.inout.indexOf(OG.Constants.TERMINAL_TYPE.IN)>=0)||($(Y).data("dragged_guide")==="from"&&ac.terminal.inout.indexOf(OG.Constants.TERMINAL_TYPE.OUT)>=0)||(!$(Y).data("dragged_guide")&&ac.terminal.inout.indexOf(OG.Constants.TERMINAL_TYPE.OUT)>=0))&&(!ad||OG.Constants.SELF_CONNECTABLE)){h.setAttr(ac,OG.Constants.DEFAULT_STYLE.TERMINAL_OVER);$(Y).data("edge_terminal",ac)}},mouseout:function(){h.setAttr(ac,OG.Constants.DEFAULT_STYLE.TERMINAL);$(Y).removeData("edge_terminal")}});$(ac).draggable({start:function(af){var ad=ac.terminal.position.x,ag=ac.terminal.position.y,ae=h.drawShape(null,new OG.EdgeShape([ad,ag],[ad,ag]),null,OG.Constants.DEFAULT_STYLE.EDGE_SHADOW);$(Y).data("edge",ae);$(Y).data("from_terminal",ac);$(Y).data("dragged_guide","to");h.removeRubberBand(h.getRootElement());$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ai,ah){if(ah.id){h.removeGuide(ah)}})},drag:function(ad){var ah=n(ad),af=$(Y).data("edge"),am=$(Y).data("from_terminal"),aq=$(Y).data("edge_terminal"),an=[am.terminal.position.x,am.terminal.position.y],aj=aq?[aq.terminal.position.x,aq.terminal.position.y]:[ah.x,ah.y],ao=am.terminal.direction.toLowerCase(),ak=aq?aq.terminal.direction.toLowerCase():"c",ai=aq?i(aq):null,ae,ap,ag,al;$(this).css({position:"",left:"",top:""});ae=an;ap=aj;if(!Z.shape.geom.getBoundary().isContains(aj)&&ao==="c"){ag=h.intersectionEdge(af.shape.geom.style.get("edge-type"),Z,[ae[0],ae[1]],[ap[0],ap[1]],true);an=ag.position;ao=ag.direction}if(ai&&ak==="c"){ag=h.intersectionEdge(af.shape.geom.style.get("edge-type"),ai,[ae[0],ae[1]],[ap[0],ap[1]],false);aj=ag.position;ak=ag.direction}al=Z&&ai&&Z.id===ai.id;if(al){an=aj=Z.shape.geom.getBoundary().getRightCenter()}if(!al||OG.Constants.SELF_CONNECTABLE){h.drawEdge(new OG.Line(an,aj),OG.Util.apply(af.shape.geom.style.map,{"edge-direction":ao+" "+ak}),af.id,al)}},stop:function(ad){var ao=n(ad),ag=$(Y).data("edge"),am=$(Y).data("from_terminal"),ap=$(Y).data("edge_terminal")||[ao.x,ao.y],ah=OG.Util.isElement(ap)?i(ap):null,af,ai,an,ak,ae,aj,al;$(this).css({position:"absolute",left:"0px",top:"0px"});if(!$(Y).data("edge_terminal")&&OG.Constants.CONNECT_CLONEABLE){af=Z.shape.geom.getBoundary();ai=h.drawShape([ao.x,ao.y],Z.shape.clone(),[af.getWidth(),af.getHeight()],Z.shapeStyle);B.setClickSelectable(ai,OG.Constants.SELECTABLE);B.setMovable(ai,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);if(OG.Constants.GROUP_DROPABLE){B.enableDragAndDropGroup(ai)}if(OG.Constants.GROUP_COLLAPSIBLE){B.enableCollapse(ai)}if($(ai).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.CONNECTABLE){B.enableConnect(ai)}if(OG.Constants.LABEL_EDITABLE){B.enableEditLabel(ai)}}an=h.drawTerminal(ai,OG.Constants.TERMINAL_TYPE.IN);ak=an.terminal.childNodes;ap=ak[0];for(aj=0;aj<ak.length;aj++){if(ak[aj].terminal&&ak[aj].terminal.direction.toLowerCase()==="c"){ap=ak[aj];break}}}al=Z&&ah&&Z.id===ah.id;if(ap&&(OG.Util.isElement(ap)||!OG.Constants.CONNECT_REQUIRED)&&(!al||OG.Constants.SELF_CONNECTABLE)){ag=h.connect(am,ap,ag);if(ag){ae=h.drawGuide(ag);if(ag&&ae){B.setClickSelectable(ag,OG.Constants.SELECTABLE);B.setMovable(ag,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);k(ag,ae,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);if($(ag).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.LABEL_EDITABLE){B.enableEditLabel(ag)}}h.toFront(ae.group)}}}else{h.removeShape(ag)}$(Y).removeData("edge");$(Y).removeData("from_terminal");$(Y).removeData("edge_terminal");$(Y).removeData("dragged_guide");if(ah){h.remove(ah.id+OG.Constants.DROP_OVER_BBOX_SUFFIX)}}})}})}else{h.removeTerminal(Z)}},mouseout:function(ab){if($(Z).attr("_shape")!==OG.Constants.SHAPE_TYPE.EDGE&&$(Y).data("edge")){h.remove(Z.id+OG.Constants.DROP_OVER_BBOX_SUFFIX);$(Y).removeData("edge_terminal")}}})}};this.enableDragAndDropGroup=function(aa){var Y=h.getRootGroup(),Z;if(aa&&$(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP){$(aa).bind({mouseover:function(){if($(Y).data("bBoxArray")){Z=false;$.each($(Y).data("bBoxArray"),function(ab,ac){if(aa.id===ac.id){Z=true}});if(!Z){$(Y).data("groupTarget",aa);h.drawDropOverGuide(aa)}}},mouseout:function(ab){h.remove(aa.id+OG.Constants.DROP_OVER_BBOX_SUFFIX);$(Y).removeData("groupTarget")}})}};this.enableCollapse=function(aa){var Z,Y;Y=function(ab,ac){if(ac&&ac.bBox&&ac.collapse){$(ac.collapse).bind("click",function(ad){if(ab.shape.isCollapsed===true){h.expand(ab);ac=h.drawCollapseGuide(ab);Y(ab,ac)}else{h.collapse(ab);ac=h.drawCollapseGuide(ab);Y(ab,ac)}});$(ac.bBox).bind("mouseout",function(ad){h.remove(ab.id+OG.Constants.COLLAPSE_BBOX);h.remove(ab.id+OG.Constants.COLLAPSE_SUFFIX)})}};if(aa&&$(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP){$(aa).bind({mouseover:function(){Z=h.drawCollapseGuide(this);if(Z&&Z.bBox&&Z.collapse){Y(aa,Z)}}})}};this.setMovable=function(aa,Z){var Y=h.getRootGroup();if(!aa){return}if(Z){if(($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GEOM&&OG.Constants.MOVABLE_GEOM)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.TEXT&&OG.Constants.MOVABLE_TEXT)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.HTML&&OG.Constants.MOVABLE_HTML)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.IMAGE&&OG.Constants.MOVABLE_IMAGE)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.EDGE&&OG.Constants.MOVABLE_EDGE)||($(aa).attr("_shape")===OG.Constants.SHAPE_TYPE.GROUP&&OG.Constants.MOVABLE_GROUP)){$(aa).draggable({start:function(ac){var ad=n(ac),ab;if(h.getElementById(aa.id+OG.Constants.GUIDE_SUFFIX.GUIDE)===null){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ae,af){if(OG.Util.isElement(af)&&af.id){h.removeGuide(af)}});h.removeAllTerminal()}h.removeGuide(aa);ab=h.drawGuide(aa);$(this).data("start",{x:ad.x,y:ad.y});$(this).data("offset",{x:ad.x-U(h.getAttr(ab.bBox,"x")),y:ad.y-U(h.getAttr(ab.bBox,"y"))});$(Y).data("bBoxArray",R());h.removeRubberBand(h.getRootElement());h.removeAllTerminal()},drag:function(ad){var ae=n(ad),ag=$(this).data("start"),af=$(Y).data("bBoxArray"),ac=N(ae.x-ag.x),ab=N(ae.y-ag.y);e(ae.x,ae.y);$(this).css({position:"",left:"",top:""});$.each(af,function(ah,ai){h.setAttr(ai.box,{transform:"t"+ac+","+ab})});h.removeAllTerminal()},stop:function(ab){var ae=n(ab),ac=$(this).data("start"),ah=$(Y).data("bBoxArray"),aj=N(ae.x-ac.x),ai=N(ae.y-ac.y),af=$(Y).data("groupTarget"),ag,ad;$(this).css({position:"",left:"",top:""});ag=p(ah,aj,ai);if(af&&OG.Util.isElement(af)){h.addToGroup(af,ag);$.each(ag,function(ak,al){h.removeGuide(al)});ad=h.drawGuide(af);k(af,ad,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.toFront(ad.group);h.remove(af.id+OG.Constants.DROP_OVER_BBOX_SUFFIX);$(Y).removeData("groupTarget")}else{h.addToGroup(Y,ag);$.each(ag,function(ak,al){h.removeGuide(al);ad=h.drawGuide(al);k(al,ad,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.toFront(ad.group)})}$(Y).removeData("bBoxArray")}});h.setAttr(aa,{cursor:"move"});OG.Util.apply(aa.shape.geom.style.map,{cursor:"move"})}}else{$(aa).draggable("destroy");h.setAttr(aa,{cursor:OG.Constants.SELECTABLE?"pointer":OG.Constants.DEFAULT_STYLE.SHAPE.cursor});OG.Util.apply(aa.shape.geom.style.map,{cursor:OG.Constants.SELECTABLE?"pointer":OG.Constants.DEFAULT_STYLE.SHAPE.cursor})}};this.setClickSelectable=function(Z,Y){if(Y){$(Z).bind("click",function(ab){var aa;$(h.getContainer()).focus();if(Z.shape){if(!ab.shiftKey&&!ab.ctrlKey){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ac,ad){if(ad.id){h.removeGuide(ad)}})}if($(Z).attr("_selected")==="true"){if(ab.shiftKey||ab.ctrlKey){h.removeGuide(Z)}}else{L(Z);if(!v(Z)){aa=h.drawGuide(Z);if(aa){k(Z,aa,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.removeAllTerminal();h.toFront(aa.group)}}}return false}});if(OG.Constants.ENABLE_CONTEXTMENU){$(Z).bind("contextmenu",function(ab){var aa;if(Z.shape){if($(Z).attr("_selected")!=="true"){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ac,ad){if(ad.id){h.removeGuide(ad)}});L(Z);if(!v(Z)){aa=h.drawGuide(Z);if(aa){k(Z,aa,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.removeAllTerminal();h.toFront(aa.group)}}}return true}})}if(Y&&OG.Constants.MOVABLE){h.setAttr(Z,{cursor:"move"});OG.Util.apply(Z.shape.geom.style.map,{cursor:"move"})}else{h.setAttr(Z,{cursor:"pointer"});OG.Util.apply(Z.shape.geom.style.map,{cursor:"pointer"})}}else{$(Z).click("destroy");h.setAttr(Z,{cursor:OG.Constants.DEFAULT_STYLE.SHAPE.cursor});OG.Util.apply(Z.shape.geom.style.map,{cursor:OG.Constants.DEFAULT_STYLE.SHAPE.cursor})}};this.setDragSelectable=function(Y){var Z=h.getRootElement();$(Z).bind("click",function(ab){var aa=$(this).data("dragBox");$(h.getContainer()).focus();if(!aa||(aa&&aa.width<1&&aa.height<1)){$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"][_selected=true]").each(function(ac,ad){if(OG.Util.isElement(ad)&&ad.id){h.removeGuide(ad)}});h.removeAllTerminal()}});if(Y){$(Z).bind("mousedown",function(aa){var ab=n(aa);$(this).data("dragBox_first",{x:ab.x,y:ab.y});h.drawRubberBand([ab.x,ab.y])});$(Z).bind("mousemove",function(ad){var af=$(this).data("dragBox_first"),ae,ac,ab,aa,ag;if(af){ae=n(ad);ac=ae.x-af.x;ab=ae.y-af.y;aa=ac<=0?af.x+ac:af.x;ag=ab<=0?af.y+ab:af.y;h.drawRubberBand([aa,ag],[Math.abs(ac),Math.abs(ab)])}});$(Z).bind("mouseup",function(aa){var ae=$(this).data("dragBox_first"),ad,ab,ai,ah,ag,af,ac;h.removeRubberBand(Z);if(ae){ad=n(aa);ab=ad.x-ae.x;ai=ad.y-ae.y;ah=ab<=0?ae.x+ab:ae.x;ag=ai<=0?ae.y+ai:ae.y;af=new OG.Envelope([ah,ag],Math.abs(ab),Math.abs(ai));$(h.getRootElement()).find("[_type="+OG.Constants.NODE_TYPE.SHAPE+"]").each(function(aj,ak){if(ak.shape.geom&&af.isContainsAll(ak.shape.geom.getVertices())){L(ak);if(!v(ak)){ac=h.drawGuide(ak);if(ac){k(ak,ac,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);h.removeAllTerminal()}}}});$(this).data("dragBox",{width:ab,height:ai,x:ah,y:ag})}});$(Z).bind("contextmenu",function(aa){h.removeRubberBand(Z)})}else{$(Z).unbind("mousedown");$(Z).unbind("mousemove");$(Z).unbind("mouseup");$(Z).unbind("contextmenu")}};this.setEnableHotKey=function(Y){if(Y){$(h.getContainer()).bind("keydown",function(Z){if(OG.Constants.ENABLE_HOTKEY_DELETE&&Z.keyCode===KeyEvent.DOM_VK_DELETE){M()}if(OG.Constants.ENABLE_HOTKEY_CTRL_A&&OG.Constants.SELECTABLE&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_A){T()}if(OG.Constants.ENABLE_HOTKEY_CTRL_C&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_C){z()}if(OG.Constants.ENABLE_HOTKEY_CTRL_V&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_V){G()}if(OG.Constants.ENABLE_HOTKEY_CTRL_D&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_D){F()}if(OG.Constants.ENABLE_HOTKEY_CTRL_G&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_G){S()}if(OG.Constants.ENABLE_HOTKEY_CTRL_U&&Z.ctrlKey&&Z.keyCode===KeyEvent.DOM_VK_U){o()}if(OG.Constants.ENABLE_HOTKEY_SHIFT_ARROW){if(Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_LEFT){p(R(),-1*(OG.Constants.DRAG_GRIDABLE?OG.Constants.MOVE_SNAP_SIZE:1),0)}if(Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_RIGHT){p(R(),(OG.Constants.DRAG_GRIDABLE?OG.Constants.MOVE_SNAP_SIZE:1),0)}if(Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_UP){p(R(),0,-1*(OG.Constants.DRAG_GRIDABLE?OG.Constants.MOVE_SNAP_SIZE:1))}if(Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_DOWN){p(R(),0,(OG.Constants.DRAG_GRIDABLE?OG.Constants.MOVE_SNAP_SIZE:1))}}if(OG.Constants.ENABLE_HOTKEY_ARROW){if(!Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_LEFT){p(R(),-1*OG.Constants.MOVE_SNAP_SIZE,0)}if(!Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_RIGHT){p(R(),OG.Constants.MOVE_SNAP_SIZE,0)}if(!Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_UP){p(R(),0,-1*OG.Constants.MOVE_SNAP_SIZE)}if(!Z.shiftKey&&Z.keyCode===KeyEvent.DOM_VK_DOWN){p(R(),0,OG.Constants.MOVE_SNAP_SIZE)}}})}else{$(h.getContainer()).unbind("keydown")}};this.enableRootContextMenu=function(){$.contextMenu({selector:"#"+h.getRootElement().id,build:function(Y,ab){var aa=h.getRootGroup(),Z=$(aa).data("copied");$(h.getContainer()).focus();return{items:{selectAll:{name:"Select All",callback:T},sep1:"---------",paste:{name:"Paste",callback:G,disabled:(Z?false:true)},sep2:"---------",view:{name:"View",items:{view_actualSize:{name:"Actual Size",callback:function(){h.setScale(1)}},sep2_1:"---------",view_fitWindow:{name:"Fit Window",callback:j},sep2_2:"---------",view_25:{name:"25%",callback:function(){h.setScale(0.25)}},view_50:{name:"50%",callback:function(){h.setScale(0.5)}},view_75:{name:"75%",callback:function(){h.setScale(0.75)}},view_100:{name:"100%",callback:function(){h.setScale(1)}},view_150:{name:"150%",callback:function(){h.setScale(1.5)}},view_200:{name:"200%",callback:function(){h.setScale(2)}},view_300:{name:"300%",callback:function(){h.setScale(3)}},view_400:{name:"400%",callback:function(){h.setScale(4)}},sep2_3:"---------",view_zoomin:{name:"Zoom In",callback:C},view_zoomout:{name:"Zoom Out",callback:t}}}}}}})};this.enableShapeContextMenu=function(){$.contextMenu({selector:"#"+h.getRootElement().id+" [_type=SHAPE]",build:function(Y,Z){$(h.getContainer()).focus();return{items:{"delete":{name:"Delete",callback:M},sep1:"---------",cut:{name:"Cut",callback:m},copy:{name:"Copy",callback:z},sep2:"---------",duplicate:{name:"Duplicate",callback:F},sep3:"---------",group:{name:"Group",callback:S},unGroup:{name:"UnGroup",callback:o},sep4:"---------",shapeRotate:{name:"Rotate",items:{rotate_select:{name:"Select",type:"select",options:{"0":"0","45":"45","90":"90","135":"135","180":"180","-45":"-45","-90":"-90","-135":"-135","-180":"-180"},selected:"0",events:{change:function(aa){I(aa.target.value)}}},sep5_6_1:"---------",rotate_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){I(aa.target.value)}}}}}},sep5:"---------",format:{name:"Format",items:{fillColor:{name:"Fill Color",items:{fillColor_select:{name:"Select",type:"select",options:{"":"",white:"white",gray:"gray",blue:"blue",red:"red",yellow:"yellow",orange:"orange",green:"green",black:"black"},selected:"",events:{change:function(aa){if(aa.target.value!==""){g(aa.target.value)}}}},sep5_1_1:"---------",fillColor_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){g(aa.target.value)}}}}}},fillOpacity:{name:"Fill Opacity",items:{fillOpacity_select:{name:"Select",type:"select",options:{"":"","0.0":"0%","0.1":"10%","0.2":"20%","0.3":"30%","0.4":"40%","0.5":"50%","0.6":"60%","0.7":"70%","0.8":"80%","0.9":"90%","1.0":"100%"},selected:"",events:{change:function(aa){if(aa.target.value!==""){x(aa.target.value)}}}}}},sep5_1:"---------",lineType:{name:"Line Type",items:{lineType_straight:{name:"Straight",type:"radio",radio:"lineType",value:"straight",events:{change:function(aa){D(aa.target.value)}}},lineType_plain:{name:"Plain",type:"radio",radio:"lineType",value:"plain",events:{change:function(aa){D(aa.target.value)}}}}},lineStyle:{name:"Line Style",items:{lineStyle_1:{name:"──────",type:"radio",radio:"lineStyle",value:"",events:{change:function(aa){u(aa.target.value)}}},lineStyle_2:{name:"---------",type:"radio",radio:"lineStyle",value:"-",events:{change:function(aa){u(aa.target.value)}}},lineStyle_3:{name:"············",type:"radio",radio:"lineStyle",value:".",events:{change:function(aa){u(aa.target.value)}}},lineStyle_4:{name:"-·-·-·-·-·",type:"radio",radio:"lineStyle",value:"-.",events:{change:function(aa){u(aa.target.value)}}},lineStyle_5:{name:"-··-··-··-",type:"radio",radio:"lineStyle",value:"-..",events:{change:function(aa){u(aa.target.value)}}},lineStyle_6:{name:"· · · · · ·",type:"radio",radio:"lineStyle",value:". ",events:{change:function(aa){u(aa.target.value)}}},lineStyle_7:{name:"- - - - -",type:"radio",radio:"lineStyle",value:"- ",events:{change:function(aa){u(aa.target.value)}}},lineStyle_8:{name:"─ ─ ─ ─",type:"radio",radio:"lineStyle",value:"--",events:{change:function(aa){u(aa.target.value)}}},lineStyle_9:{name:"- ·- ·- ·-",type:"radio",radio:"lineStyle",value:"- .",events:{change:function(aa){u(aa.target.value)}}},lineStyle_10:{name:"--·--·--·-",type:"radio",radio:"lineStyle",value:"--.",events:{change:function(aa){u(aa.target.value)}}},lineStyle_11:{name:"--··--··--",type:"radio",radio:"lineStyle",value:"--..",events:{change:function(aa){u(aa.target.value)}}}}},lineColor:{name:"Line Color",items:{lineColor_select:{name:"Select",type:"select",options:{"":"",white:"white",gray:"gray",blue:"blue",red:"red",yellow:"yellow",orange:"orange",green:"green",black:"black"},selected:"",events:{change:function(aa){if(aa.target.value!==""){l(aa.target.value)}}}},sep5_4_1:"---------",lineColor_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){l(aa.target.value)}}}}}},lineWidth:{name:"Line Width",items:{lineWidth_select:{name:"Select",type:"select",options:{0:"",1:"1px",2:"2px",3:"3px",4:"4px",5:"5px",6:"6px",8:"8px",10:"10px",12:"12px",16:"16px",24:"24px"},selected:0,events:{change:function(aa){if(aa.target.value!==0){r(aa.target.value)}}}},sep5_5_1:"---------",lineWidth_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){r(aa.target.value)}}}}}}}},sep6:"---------",text:{name:"Text",items:{fontFamily:{name:"Font Family",items:{fontFamily_1:{name:'<span style="font-family: Arial">Arial</span>',type:"radio",radio:"fontFamily",value:"Arial",events:{change:function(aa){H(aa.target.value)}}},fontFamily_2:{name:"<span style=\"font-family: 'Comic Sans MS'\">Comic Sans MS</span>",type:"radio",radio:"fontFamily",value:"Comic Sans MS",events:{change:function(aa){H(aa.target.value)}}},fontFamily_3:{name:"<span style=\"font-family: 'Courier New'\">Courier New</span>",type:"radio",radio:"fontFamily",value:"Courier New",events:{change:function(aa){H(aa.target.value)}}},fontFamily_4:{name:'<span style="font-family: Garamond">Garamond</span>',type:"radio",radio:"fontFamily",value:"Garamond",events:{change:function(aa){H(aa.target.value)}}},fontFamily_5:{name:'<span style="font-family: Georgia">Georgia</span>',type:"radio",radio:"fontFamily",value:"Georgia",events:{change:function(aa){H(aa.target.value)}}},fontFamily_6:{name:"<span style=\"font-family: 'Lucida Console'\">Lucida Console</span>",type:"radio",radio:"fontFamily",value:"Lucida Console",events:{change:function(aa){H(aa.target.value)}}},fontFamily_7:{name:"<span style=\"font-family: 'MS Gothic'\">MS Gothic</span>",type:"radio",radio:"fontFamily",value:"MS Gothic",events:{change:function(aa){H(aa.target.value)}}},fontFamily_8:{name:"<span style=\"font-family: 'MS Sans Serif'\">MS Sans Serif</span>",type:"radio",radio:"fontFamily",value:"MS Sans Serif",events:{change:function(aa){H(aa.target.value)}}},fontFamily_9:{name:'<span style="font-family: Verdana">Verdana</span>',type:"radio",radio:"fontFamily",value:"Verdana",events:{change:function(aa){H(aa.target.value)}}},fontFamily_10:{name:"<span style=\"font-family: 'Times New Roman'\">Times New Roman</span>",type:"radio",radio:"fontFamily",value:"Times New Roman",events:{change:function(aa){H(aa.target.value)}}},sep6_1_1:"---------",fontFamily_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){H(aa.target.value)}}}}}},fontColor:{name:"Font Color",items:{fontColor_select:{name:"Select",type:"select",options:{"":"",white:"white",gray:"gray",blue:"blue",red:"red",yellow:"yellow",orange:"orange",green:"green",black:"black"},selected:"",events:{change:function(aa){if(aa.target.value!==""){P(aa.target.value)}}}},sep6_1_2:"---------",fontColor_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){P(aa.target.value)}}}}}},fontSize:{name:"Font Size",items:{fontSize_select:{name:"Select",type:"select",options:{"":"","6":"6","8":"8","9":"9","10":"10","11":"11","12":"12","14":"14","18":"18","24":"24","36":"36","48":"48","72":"72"},selected:"",events:{change:function(aa){if(aa.target.value!==""){d(aa.target.value)}}}},sep6_1_3:"---------",fontSize_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){d(aa.target.value)}}}}}},sep6_1:"---------",fontWeight_bold:{name:'<span style="font-weight: bold">Bold</span>',type:"checkbox",events:{change:function(aa){if(aa.target.checked){b("bold")}else{b("normal")}}}},fontWeight_italic:{name:'<span style="font-style: italic">Italic</span>',type:"checkbox",events:{change:function(aa){if(aa.target.checked){W("italic")}else{W("normal")}}}},sep6_2:"---------",position:{name:"Text Position",items:{position_left:{name:"Left",type:"radio",radio:"position",value:"left",events:{change:function(aa){V(aa.target.value)}}},position_center:{name:"Center",type:"radio",radio:"position",value:"center",events:{change:function(aa){V(aa.target.value)}}},position_right:{name:"Right",type:"radio",radio:"position",value:"right",events:{change:function(aa){V(aa.target.value)}}},position_top:{name:"Top",type:"radio",radio:"position",value:"top",events:{change:function(aa){V(aa.target.value)}}},position_bottom:{name:"Bottom",type:"radio",radio:"position",value:"bottom",events:{change:function(aa){V(aa.target.value)}}}}},vertical:{name:"Vertical Align",items:{vertical_top:{name:"Top",type:"radio",radio:"vertical",value:"top",events:{change:function(aa){f(aa.target.value)}}},vertical_middle:{name:"Middle",type:"radio",radio:"vertical",value:"middle",events:{change:function(aa){f(aa.target.value)}}},vertical_bottom:{name:"Bottom",type:"radio",radio:"vertical",value:"bottom",events:{change:function(aa){f(aa.target.value)}}}}},horizontal:{name:"Horizontal Align",items:{vertical_start:{name:"Left",type:"radio",radio:"horizontal",value:"start",events:{change:function(aa){w(aa.target.value)}}},horizontal_middle:{name:"Middle",type:"radio",radio:"horizontal",value:"middle",events:{change:function(aa){w(aa.target.value)}}},horizontal_end:{name:"Right",type:"radio",radio:"horizontal",value:"end",events:{change:function(aa){w(aa.target.value)}}}}},sep6_5:"---------",textRotate:{name:"Text Rotate",items:{textRotate_select:{name:"Select",type:"select",options:{"0":"0","45":"45","90":"90","135":"135","180":"180","-45":"-45","-90":"-90","-135":"-135","-180":"-180"},selected:"0",events:{change:function(aa){c(aa.target.value)}}},sep6_6_1:"---------",textRotate_custom:{name:"Custom",type:"text",events:{keyup:function(aa){if(aa.target.value!==""){c(aa.target.value)}}}}}}}},sep7:"---------",label:{name:"Label",items:{label_shape:{name:"Cell Label",type:"text",events:{keyup:function(aa){y(aa.target.value)}}},sep7_1:"---------",label_from:{name:"Edge From",type:"text",events:{keyup:function(aa){q(aa.target.value)}}},label_to:{name:"Edge To",type:"text",events:{keyup:function(aa){K(aa.target.value)}}}}}}}}})}};OG.handler.EventHandler.prototype=new OG.handler.EventHandler();OG.handler.EventHandler.prototype.constructor=OG.handler.EventHandler;OG.EventHandler=OG.handler.EventHandler;OG.graph.Canvas=function(container,containerSize,backgroundColor,backgroundImage){var _RENDERER=container?new OG.RaphaelRenderer(container,containerSize,backgroundColor,backgroundImage):null,_HANDLER=new OG.EventHandler(_RENDERER),_CONTAINER=OG.Util.isElement(container)?container:document.getElementById(container);this.initConfig=function(config){if(config){OG.Constants.SELECTABLE=config.selectable===undefined?OG.Constants.SELECTABLE:config.selectable;OG.Constants.DRAG_SELECTABLE=config.dragSelectable===undefined?OG.Constants.DRAG_SELECTABLE:config.dragSelectable;OG.Constants.MOVABLE=config.movable===undefined?OG.Constants.MOVABLE:config.movable;OG.Constants.RESIZABLE=config.resizable===undefined?OG.Constants.RESIZABLE:config.resizable;OG.Constants.CONNECTABLE=config.connectable===undefined?OG.Constants.CONNECTABLE:config.connectable;OG.Constants.SELF_CONNECTABLE=config.selfConnectable===undefined?OG.Constants.SELF_CONNECTABLE:config.selfConnectable;OG.Constants.CONNECT_CLONEABLE=config.connectCloneable===undefined?OG.Constants.CONNECT_CLONEABLE:config.connectCloneable;OG.Constants.CONNECT_REQUIRED=config.connectRequired===undefined?OG.Constants.CONNECT_REQUIRED:config.connectRequired;OG.Constants.LABEL_EDITABLE=config.labelEditable===undefined?OG.Constants.LABEL_EDITABLE:config.labelEditable;OG.Constants.GROUP_DROPABLE=config.groupDropable===undefined?OG.Constants.GROUP_DROPABLE:config.groupDropable;OG.Constants.GROUP_COLLAPSIBLE=config.collapsible===undefined?OG.Constants.GROUP_COLLAPSIBLE:config.collapsible;OG.Constants.ENABLE_HOTKEY=config.enableHotKey===undefined?OG.Constants.ENABLE_HOTKEY:config.enableHotKey}_HANDLER.setDragSelectable(OG.Constants.SELECTABLE&&OG.Constants.DRAG_SELECTABLE);_HANDLER.setEnableHotKey(OG.Constants.ENABLE_HOTKEY);if(OG.Constants.ENABLE_CONTEXTMENU){_HANDLER.enableRootContextMenu();_HANDLER.enableShapeContextMenu()}this.CONFIG_INITIALIZED=true};this.getRenderer=function(){return _RENDERER};this.getContainer=function(){return _CONTAINER};this.getEventHandler=function(){return _HANDLER};this.drawShape=function(position,shape,size,style,id,parentId,gridable){if(OG.Constants.DRAG_GRIDABLE&&(!OG.Util.isDefined(gridable)||gridable===true)){if(position){position[0]=OG.Util.roundGrid(position[0]);position[1]=OG.Util.roundGrid(position[1])}if(size){size[0]=OG.Util.roundGrid(size[0],OG.Constants.MOVE_SNAP_SIZE*2);size[1]=OG.Util.roundGrid(size[1],OG.Constants.MOVE_SNAP_SIZE*2)}}var element=_RENDERER.drawShape(position,shape,size,style,id);if(position&&(shape.TYPE===OG.Constants.SHAPE_TYPE.EDGE)){element=_RENDERER.move(element,position)}if(parentId&&_RENDERER.getElementById(parentId)){_RENDERER.appendChild(element,parentId)}if(!this.CONFIG_INITIALIZED){this.initConfig()}_HANDLER.setClickSelectable(element,OG.Constants.SELECTABLE);_HANDLER.setMovable(element,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);if(OG.Constants.CONNECTABLE){_HANDLER.enableConnect(element)}if(OG.Constants.LABEL_EDITABLE){_HANDLER.enableEditLabel(element)}if(OG.Constants.GROUP_DROPABLE){_HANDLER.enableDragAndDropGroup(element)}if(OG.Constants.GROUP_COLLAPSIBLE){_HANDLER.enableCollapse(element)}return element};this.setShapeStyle=function(shapeElement,style){_RENDERER.setShapeStyle(shapeElement,style)};this.drawLabel=function(shapeElement,text,style){return _RENDERER.drawLabel(shapeElement,text,style)};this.redrawConnectedEdge=function(element,excludeEdgeId){_RENDERER.redrawConnectedEdge(element,excludeEdgeId)};this.connect=function(fromElement,toElement,style,label){var terminalGroup,childTerminals,fromTerminal,toTerminal,i,edge,guide;terminalGroup=_RENDERER.drawTerminal(fromElement,OG.Constants.TERMINAL_TYPE.OUT);childTerminals=terminalGroup.terminal.childNodes;fromTerminal=childTerminals[0];for(i=0;i<childTerminals.length;i++){if(childTerminals[i].terminal&&childTerminals[i].terminal.direction.toLowerCase()==="c"){fromTerminal=childTerminals[i];break}}_RENDERER.removeTerminal(fromElement);terminalGroup=_RENDERER.drawTerminal(toElement,OG.Constants.TERMINAL_TYPE.IN);childTerminals=terminalGroup.terminal.childNodes;toTerminal=childTerminals[0];for(i=0;i<childTerminals.length;i++){if(childTerminals[i].terminal&&childTerminals[i].terminal.direction.toLowerCase()==="c"){toTerminal=childTerminals[i];break}}_RENDERER.removeTerminal(toElement);edge=_RENDERER.drawShape(null,new OG.EdgeShape(fromTerminal.terminal.position,toTerminal.terminal.position));edge=_RENDERER.connect(fromTerminal,toTerminal,edge,style,label);if(edge){guide=_RENDERER.drawGuide(edge);if(edge&&guide){_HANDLER.setClickSelectable(edge,OG.Constants.SELECTABLE);_HANDLER.setMovable(edge,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);_HANDLER.setResizable(edge,guide,OG.Constants.SELECTABLE&&OG.Constants.RESIZABLE);if($(edge).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.LABEL_EDITABLE){_HANDLER.enableEditLabel(edge)}}_RENDERER.toFront(guide.group)}}return edge};this.disconnect=function(element){_RENDERER.disconnect(element)};this.group=function(elements){var group=_RENDERER.group(elements);_HANDLER.setClickSelectable(group,OG.Constants.SELECTABLE);_HANDLER.setMovable(group,OG.Constants.SELECTABLE&&OG.Constants.MOVABLE);if($(group).attr("_shape")!==OG.Constants.SHAPE_TYPE.GROUP){if(OG.Constants.LABEL_EDITABLE){_HANDLER.enableEditLabel(group)}}return group};this.ungroup=function(groupElements){return _RENDERER.ungroup(groupElements)};this.addToGroup=function(groupElement,elements){_RENDERER.addToGroup(groupElement,elements)};this.collapse=function(element){_RENDERER.collapse(element)};this.expand=function(element){_RENDERER.expand(element)};this.clear=function(){_RENDERER.clear()};this.removeShape=function(element){_RENDERER.removeShape(element)};this.removeChild=function(element){_RENDERER.removeChild(element)};this.removeGuide=function(element){_RENDERER.removeGuide(element)};this.removeAllGuide=function(){_RENDERER.removeAllGuide()};this.getRootElement=function(){return _RENDERER.getRootElement()};this.getRootGroup=function(){return _RENDERER.getRootGroup()};this.getElementByPoint=function(position){return _RENDERER.getElementByPoint(position)};this.getElementsByBBox=function(envelope){return _RENDERER.getElementsByBBox(envelope)};this.setAttr=function(element,attribute){_RENDERER.setAttr(element,attribute)};this.getAttr=function(element,attrName){return _RENDERER.getAttr(element,attrName)};this.toFront=function(element){_RENDERER.toFront(element)};this.toBack=function(element){_RENDERER.toBack(element)};this.getCanvasSize=function(){_RENDERER.getCanvasSize()};this.setCanvasSize=function(size){_RENDERER.setCanvasSize(size)};this.fitCanvasSize=function(minSize,fitScale){_RENDERER.fitCanvasSize(minSize,fitScale)};this.setViewBox=function(position,size,isFit){_RENDERER.setViewBox(position,size,isFit)};this.getScale=function(){_RENDERER.getScale()};this.setScale=function(scale){_RENDERER.setScale(scale)};this.show=function(element){_RENDERER.show(element)};this.hide=function(element){_RENDERER.hide(element)};this.appendChild=function(srcElement,targetElement){return _RENDERER.appendChild(srcElement,targetElement)};this.insertAfter=function(srcElement,targetElement){return _RENDERER.insertAfter(srcElement,targetElement)};this.insertBefore=function(srcElement,targetElement){return _RENDERER.insertBefore(srcElement,targetElement)};this.move=function(element,offset,excludeEdgeId){return _RENDERER.move(element,offset,excludeEdgeId)};this.moveCentroid=function(element,position,excludeEdgeId){return _RENDERER.moveCentroid(element,position,excludeEdgeId)};this.rotate=function(element,angle,excludeEdgeId){return _RENDERER.rotate(element,angle,excludeEdgeId)};this.resize=function(element,offset,excludeEdgeId){return _RENDERER.resize(element,offset,excludeEdgeId)};this.resizeBox=function(element,size){return _RENDERER.resizeBox(element,size)};this.clone=function(element){return _RENDERER.clone(element)};this.getElementById=function(id){return _RENDERER.getElementById(id)};this.getElementsByType=function(shapeType,excludeType){return _RENDERER.getElementsByType(shapeType,excludeType)};this.getElementsByShapeId=function(shapeId){var root=this.getRootGroup();return $(root).find("[_type=SHAPE][_shape_id='"+shapeId+"']")};this.getBBox=function(element){return _RENDERER.getBBox(element)};this.getRootBBox=function(){return _RENDERER.getRootBBox()};this.getRealRootBBox=function(){return _RENDERER.getRealRootBBox()};this.isSVG=function(){return _RENDERER.isSVG()};this.isVML=function(){return _RENDERER.isVML()};this.setCustomData=function(shapeElement,data){var element=OG.Util.isElement(shapeElement)?shapeElement:document.getElementById(shapeElement);element.data=data};this.getCustomData=function(shapeElement){var element=OG.Util.isElement(shapeElement)?shapeElement:document.getElementById(shapeElement);return element.data};this.toXML=function(){return OG.Util.jsonToXml(this.toJSON())};this.toJSON=function(){var CANVAS=this,rootBBox=_RENDERER.getRootBBox(),rootGroup=_RENDERER.getRootGroup(),jsonObj={opengraph:{"@width":rootBBox.width,"@height":rootBBox.height,cell:[]}},childShape;childShape=function(node,isRoot){$(node).children("[_type=SHAPE]").each(function(idx,item){var shape=item.shape,style=item.shapeStyle,geom=shape.geom,envelope=geom.getBoundary(),cell={},vertices,from,to;cell["@id"]=$(item).attr("id");if(!isRoot){cell["@parent"]=$(node).attr("id")}cell["@shapeType"]=shape.TYPE;cell["@shapeId"]=shape.SHAPE_ID;cell["@x"]=envelope.getCentroid().x;cell["@y"]=envelope.getCentroid().y;cell["@width"]=envelope.getWidth();cell["@height"]=envelope.getHeight();if(style){cell["@style"]=escape(OG.JSON.encode(style))}if($(item).attr("_from")){cell["@from"]=$(item).attr("_from")}else{if(shape.TYPE!==OG.Constants.SHAPE_TYPE.EDGE){cell["@from"]=CANVAS.getPrevShapeIds(item).toString()}}if($(item).attr("_to")){cell["@to"]=$(item).attr("_to")}else{if(shape.TYPE!==OG.Constants.SHAPE_TYPE.EDGE){cell["@to"]=CANVAS.getNextShapeIds(item).toString()}}if($(item).attr("_fromedge")){cell["@fromEdge"]=$(item).attr("_fromedge")}if($(item).attr("_toedge")){cell["@toEdge"]=$(item).attr("_toedge")}if(shape.label){cell["@label"]=escape(shape.label)}if(shape.fromLabel){cell["@fromLabel"]=escape(shape.fromLabel)}if(shape.toLabel){cell["@toLabel"]=escape(shape.toLabel)}if(shape.angle&&shape.angle!==0){cell["@angle"]=shape.angle}if(shape instanceof OG.shape.ImageShape){cell["@value"]=shape.image}else{if(shape instanceof OG.shape.HtmlShape){cell["@value"]=escape(shape.html)}else{if(shape instanceof OG.shape.TextShape){cell["@value"]=escape(shape.text)}else{if(shape instanceof OG.shape.EdgeShape){vertices=geom.getVertices();from=vertices[0];to=vertices[vertices.length-1];cell["@value"]=from+","+to}}}}if(geom){cell["@geom"]=escape(geom.toString())}if(item.data){cell["@data"]=escape(OG.JSON.encode(item.data))}jsonObj.opengraph.cell.push(cell);childShape(item,false)})};if(rootGroup.data){jsonObj.opengraph["@data"]=escape(OG.JSON.encode(rootGroup.data))}childShape(rootGroup,true);return jsonObj};this.loadXML=function(xml){if(!OG.Util.isElement(xml)){xml=OG.Util.parseXML(xml)}return this.loadJSON(OG.Util.xmlToJson(xml))};this.loadJSON=function(json){var canvasWidth,canvasHeight,rootGroup,minX=Number.MAX_VALUE,minY=Number.MAX_VALUE,maxX=Number.MIN_VALUE,maxY=Number.MIN_VALUE,i,cell,shape,id,parent,shapeType,shapeId,x,y,width,height,style,geom,from,to,fromEdge,toEdge,label,fromLabel,toLabel,angle,value,data,element;_RENDERER.clear();if(json&&json.opengraph&&json.opengraph.cell&&OG.Util.isArray(json.opengraph.cell)){canvasWidth=json.opengraph["@width"];canvasHeight=json.opengraph["@height"];data=json.opengraph["@data"];if(data){rootGroup=this.getRootGroup();rootGroup.data=OG.JSON.decode(unescape(data))}cell=json.opengraph.cell;for(i=0;i<cell.length;i++){id=cell[i]["@id"];parent=cell[i]["@parent"];shapeType=cell[i]["@shapeType"];shapeId=cell[i]["@shapeId"];x=parseInt(cell[i]["@x"],10);y=parseInt(cell[i]["@y"],10);width=parseInt(cell[i]["@width"],10);height=parseInt(cell[i]["@height"],10);style=unescape(cell[i]["@style"]);geom=unescape(cell[i]["@geom"]);from=cell[i]["@from"];to=cell[i]["@to"];fromEdge=cell[i]["@fromEdge"];toEdge=cell[i]["@toEdge"];label=cell[i]["@label"];fromLabel=cell[i]["@fromLabel"];toLabel=cell[i]["@toLabel"];angle=cell[i]["@angle"];value=cell[i]["@value"];data=cell[i]["@data"];label=label?unescape(label):label;minX=(minX>(x-width/2))?(x-width/2):minX;minY=(minY>(y-height/2))?(y-height/2):minY;maxX=(maxX<(x+width/2))?(x+width/2):maxX;maxY=(maxY<(y+height/2))?(y+height/2):maxY;switch(shapeType){case OG.Constants.SHAPE_TYPE.GEOM:case OG.Constants.SHAPE_TYPE.GROUP:shape=eval("new "+shapeId+"()");if(label){shape.label=label}element=this.drawShape([x,y],shape,[width,height],OG.JSON.decode(style),id,parent,false);break;case OG.Constants.SHAPE_TYPE.EDGE:shape=eval("new "+shapeId+"("+value+")");if(label){shape.label=label}if(fromLabel){shape.fromLabel=unescape(fromLabel)}if(toLabel){shape.toLabel=unescape(toLabel)}if(geom){geom=OG.JSON.decode(geom);if(geom.type===OG.Constants.GEOM_NAME[OG.Constants.GEOM_TYPE.POLYLINE]){geom=new OG.geometry.PolyLine(geom.vertices);shape.geom=geom}else{if(geom.type===OG.Constants.GEOM_NAME[OG.Constants.GEOM_TYPE.CURVE]){geom=new OG.geometry.Curve(geom.controlPoints);shape.geom=geom}}}element=this.drawShape(null,shape,null,OG.JSON.decode(style),id,parent,false);break;case OG.Constants.SHAPE_TYPE.HTML:shape=eval("new "+shapeId+"()");if(value){shape.html=unescape(value)}if(label){shape.label=label}element=this.drawShape([x,y],shape,[width,height,angle],OG.JSON.decode(style),id,parent,false);break;case OG.Constants.SHAPE_TYPE.IMAGE:shape=eval("new "+shapeId+"('"+value+"')");if(label){shape.label=label}element=this.drawShape([x,y],shape,[width,height,angle],OG.JSON.decode(style),id,parent,false);break;case OG.Constants.SHAPE_TYPE.TEXT:shape=eval("new "+shapeId+"()");if(value){shape.text=unescape(value)}element=this.drawShape([x,y],shape,[width,height,angle],OG.JSON.decode(style),id,parent,false);break}if(from){$(element).attr("_from",from)}if(to){$(element).attr("_to",to)}if(fromEdge){$(element).attr("_fromedge",fromEdge)}if(toEdge){$(element).attr("_toedge",toEdge)}if(data){element.data=OG.JSON.decode(unescape(data))}}this.setCanvasSize([canvasWidth,canvasHeight]);return{width:maxX-minX,height:maxY-minY,x:minX,y:minY,x2:maxX,y2:maxY}}return{width:0,height:0,x:0,y:0,x2:0,y2:0}};this.getPrevEdges=function(element){var prevEdgeIds=$(element).attr("_fromedge"),edgeArray=[],edgeIds,edge,i;if(prevEdgeIds){edgeIds=prevEdgeIds.split(",");for(i=0;i<edgeIds.length;i++){edge=this.getElementById(edgeIds[i]);if(edge){edgeArray.push(edge)}}}return edgeArray};this.getNextEdges=function(element){var nextEdgeIds=$(element).attr("_toedge"),edgeArray=[],edgeIds,edge,i;if(nextEdgeIds){edgeIds=nextEdgeIds.split(",");for(i=0;i<edgeIds.length;i++){edge=this.getElementById(edgeIds[i]);if(edge){edgeArray.push(edge)}}}return edgeArray};this.getPrevShapes=function(element){var prevEdges=this.getPrevEdges(element),shapeArray=[],prevShapeId,shape,i;for(i=0;i<prevEdges.length;i++){prevShapeId=$(prevEdges[i]).attr("_from");if(prevShapeId){prevShapeId=prevShapeId.substring(0,prevShapeId.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP));shape=this.getElementById(prevShapeId);if(shape){shapeArray.push(shape)}}}return shapeArray};this.getPrevShapeIds=function(element){var prevEdges=this.getPrevEdges(element),shapeArray=[],prevShapeId,i;for(i=0;i<prevEdges.length;i++){prevShapeId=$(prevEdges[i]).attr("_from");if(prevShapeId){prevShapeId=prevShapeId.substring(0,prevShapeId.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP));shapeArray.push(prevShapeId)}}return shapeArray};this.getNextShapes=function(element){var nextEdges=this.getNextEdges(element),shapeArray=[],nextShapeId,shape,i;for(i=0;i<nextEdges.length;i++){nextShapeId=$(nextEdges[i]).attr("_to");if(nextShapeId){nextShapeId=nextShapeId.substring(0,nextShapeId.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP));shape=this.getElementById(nextShapeId);if(shape){shapeArray.push(shape)}}}return shapeArray};this.getNextShapeIds=function(element){var nextEdges=this.getNextEdges(element),shapeArray=[],nextShapeId,i;for(i=0;i<nextEdges.length;i++){nextShapeId=$(nextEdges[i]).attr("_to");if(nextShapeId){nextShapeId=nextShapeId.substring(0,nextShapeId.indexOf(OG.Constants.TERMINAL_SUFFIX.GROUP));shapeArray.push(nextShapeId)}}return shapeArray};this.onDrawShape=function(callbackFunc){$(this.getRootElement()).bind("drawShape",function(event,shapeElement){callbackFunc(event,shapeElement)})};this.onDrawLabel=function(callbackFunc){$(this.getRootElement()).bind("drawLabel",function(event,shapeElement,labelText){callbackFunc(event,shapeElement,labelText)})};this.onLabelChanged=function(callbackFunc){$(this.getRootElement()).bind("labelChanged",function(event,shapeElement,afterText,beforeText){callbackFunc(event,shapeElement,afterText,beforeText)})};this.onRedrawShape=function(callbackFunc){$(this.getRootElement()).bind("redrawShape",function(event,shapeElement){callbackFunc(event,shapeElement)})};this.onRemoveShape=function(callbackFunc){$(this.getRootElement()).bind("removeShape",function(event,shapeElement){callbackFunc(event,shapeElement)})};this.onRotateShape=function(callbackFunc){$(this.getRootElement()).bind("rotateShape",function(event,element,angle){callbackFunc(event,element,angle)})};this.onMoveShape=function(callbackFunc){$(this.getRootElement()).bind("moveShape",function(event,shapeElement,offset){callbackFunc(event,shapeElement,offset)})};this.onResizeShape=function(callbackFunc){$(this.getRootElement()).bind("resizeShape",function(event,shapeElement,offset){callbackFunc(event,shapeElement,offset)})};this.onBeforeConnectShape=function(callbackFunc){$(this.getRootElement()).bind("beforeConnectShape",function(event){if(callbackFunc(event,event.edge,event.fromShape,event.toShape)===false){event.stopPropagation()}})};this.onBeforeRemoveShape=function(callbackFunc){$(this.getRootElement()).bind("beforeRemoveShape",function(event){if(callbackFunc(event,event.element)===false){event.stopPropagation()}})};this.onConnectShape=function(callbackFunc){$(this.getRootElement()).bind("connectShape",function(event,edgeElement,fromElement,toElement){callbackFunc(event,edgeElement,fromElement,toElement)})};this.onDisconnectShape=function(callbackFunc){$(this.getRootElement()).bind("disconnectShape",function(event,edgeElement,fromElement,toElement){callbackFunc(event,edgeElement,fromElement,toElement)})};this.onGroup=function(callbackFunc){$(this.getRootElement()).bind("group",function(event,groupElement){callbackFunc(event,groupElement)})};this.onUnGroup=function(callbackFunc){$(this.getRootElement()).bind("ungroup",function(event,ungroupedElements){callbackFunc(event,ungroupedElements)})};this.onCollapsed=function(callbackFunc){$(this.getRootElement()).bind("collapsed",function(event,element){callbackFunc(event,element)})};this.onExpanded=function(callbackFunc){$(this.getRootElement()).bind("expanded",function(event,element){callbackFunc(event,element)})}};OG.graph.Canvas.prototype=new OG.graph.Canvas();OG.graph.Canvas.prototype.constructor=OG.graph.Canvas;OG.Canvas=OG.graph.Canvas;